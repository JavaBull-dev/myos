
<!-- saved from url=(0014)about:internet -->
<html lang="zh-CN" class="translated-ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="google" content="notranslate">
<script>(function(){/*

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
(function(){function e(g){this.t={};this.tick=function(h,k,f){this.t[h]=[void 0!=f?f:(new Date).getTime(),k];if(void 0==f)try{window.console.timeStamp("CSI/"+h)}catch(m){}};this.getStartTickTime=function(){return this.t.start[0]};this.tick("start",null,g)}var a;if(window.performance)var d=(a=window.performance.timing)&&a.responseStart;var l=0<d?new e(d):new e;window.jstiming={Timer:e,load:l};if(a){var b=a.navigationStart;0<b&&d>=b&&(window.jstiming.srt=d-b)}if(a){var c=window.jstiming.load;0<b&&d>=
b&&(c.tick("_wtsrt",void 0,b),c.tick("wtsrt_","_wtsrt",d),c.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),c&&0<b&&(c.tick("_tbnd",void 0,window.chrome.csi().startE),c.tick("tbnd_","_tbnd",b))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,c&&0<b&&(c.tick("_tbnd",void 0,window.external.startE),c.tick("tbnd_","_tbnd",b))),a&&(window.jstiming.pt=a)}catch(g){}})();}).call(window);
</script><script src="./从头开始编写一个简单的操作系统_files/translate_c.js.下载"></script><script>_intlStrings._originalText = "英语原文:";_intlStrings._interfaceDirection="ltr";_intlStrings._interfaceAlign="left";_intlStrings._langpair="en|zh-CN";_intlStrings._feedbackUrl="https://translate.google.com/translate_suggestion";_intlStrings._currentBy="当前的翻译是由%2$s在 %1$s完成的";_intlStrings._unknown="佚名译者";_intlStrings._suggestTranslation="更好的翻译建议"  ;_intlStrings._submit="贡献力量";_intlStrings._suggestThanks="感谢您为 Google 翻译提供翻译建议。";_intlStrings._reverse=false;_intlStrings._staticContentPath="https://www.gstatic.com/translate/infowindow/";</script><style type="text/css">.google-src-text {display: none !important} .google-src-active-text {display: block!important;color:black!important; font-size:12px!important;font-family:arial,sans-serif!important}.google-src-active-text a {font-size:12px!important}.google-src-active-text a:link {color:#00c!important;text-decoration:underline!important}.google-src-active-text a:visited {color:purple!important;text-decoration:underline!important}.google-src-active-text a:active {color:red!important;text-decoration:underline!important}</style><meta http-equiv="X-Translated-By" content="Google"><link href="https://translate.googleusercontent.com/os-dev.pdf" hreflang="en" rel="alternate machine-translated-from"><link href="./从头开始编写一个简单的操作系统_files/css" rel="stylesheet" type="text/css"><!--<base href="" target="_top">--><base href="." target="_top">

<meta name="Creator" content="LaTeX with hyperref package">
<meta name="Producer" content="pdfTeX-1.40.11">
<meta name="CreationDate" content="D:20101202102201Z">
<meta name="ModDate" content="D:20101202102201Z">
<meta name="Fullbanner" content="This is pdfTeX, Version 3.1415926-1.40.11-2.2 (TeX Live 2010/Arch Linux) kpathsea version 6.0.0">
<title>从头开始编写一个简单的操作系统</title>
<link type="text/css" rel="stylesheet" charset="UTF-8" href="./从头开始编写一个简单的操作系统_files/translateelement.css"><script type="text/javascript" charset="UTF-8" src="./从头开始编写一个简单的操作系统_files/main_zh-CN.js.下载"></script><script type="text/javascript" charset="UTF-8" src="./从头开始编写一个简单的操作系统_files/element_main.js.下载"></script><link rel="stylesheet" type="text/css" href="./从头开始编写一个简单的操作系统_files/iw_sprite.css"></head><body bgcolor="#ffffff" vlink="blue" link="blue">
        <style>
          .spinner-container {
            width:25%;
            top:20px;
            left:50%;
            margin-left:-12.5%;
            border-radius:8px;
            position:fixed;
            text-align:center;
            box-shadow:0 0 10px rgba(0,0,0,0.24);
            background:#fff;
            overflow:hidden;
          }

          .spinner-container p{
            font-family:'Roboto', Arial, sans-serif;
            color:rgba(0,0,0,0.87);
            margin:12px 0 16px 0;
            padding:0;
            font-size:12px;
          }

          .spinner-container img{
            width:22px;
            height:22px;
            margin:16px 0 0;
            padding:0;
          }
        </style>
        <div class="spinner-container notranslate" id="gt-dt-spinner" style="display: none;">
         <img src="./从头开始编写一个简单的操作系统_files/progress_spinner_color_20dp@2x.gif">
         <p>正在翻译...</p>
        </div>
      <iframe src="./从头开始编写一个简单的操作系统_files/translate_un.html" width="0" height="0" frameborder="0" style="width:0px;height:0px;border:0px;display:none;"></iframe>
<table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="1"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第1页</font></font></b></a></font></td></tr></tbody></table><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:319;left:726"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一世</font></font></nobr></div>
</span></font>
<font size="5" color="#2b57a3" face="Times"><span style="font-size:35px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:367;left:162"><nobr><font style="vertical-align: inherit;"><font class="" style="vertical-align: inherit;">编写一个简单的操作系统-</font></font></nobr></div>
<div style="position:absolute;top:401;left:350"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从头开始</font></font></nobr></div>
</span></font>
<font size="4" color="#2b57a3" face="Times"><span style="font-size:23px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:772;left:434"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">经过</font></font></nobr></div>
<div style="position:absolute;top:796;left:377"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尼克·布伦德尔</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:1148;left:162"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">伯明翰大学计算机科学学院，</font></font></nobr></div>
<div style="position:absolute;top:1172;left:428"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">英国</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:1199;left:350"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">草案：2010年12月2日</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:1238;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有c 2009–2010 Nick Blundell</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:1437;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="2"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2页</font></font></b></a></font></td></tr></tbody></table></div><font size="5" color="#2b57a3" face="Times"><span style="font-size:35px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:1799;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:1924;left:159"><nobr><a href="https://translate.googleusercontent.com/translate_f#2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容</font></font></a></nobr></div>
<div style="position:absolute;top:1924;left:722"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ii</font></font></nobr></div>
<div style="position:absolute;top:1960;left:159"><nobr><a href="https://translate.googleusercontent.com/translate_f#5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1引言</font></font></a></nobr></div>
<div style="position:absolute;top:1960;left:723"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1个</font></font></nobr></div>
<div style="position:absolute;top:1995;left:159"><nobr><a href="https://translate.googleusercontent.com/translate_f#7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2计算机体系结构和引导过程</font></font></a></nobr></div>
<div style="position:absolute;top:1995;left:723"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></nobr></div>
<div style="position:absolute;top:2013;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1</font></font></a></nobr></div>
<div style="position:absolute;top:2013;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引导过程。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:2013;left:724"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></nobr></div>
<div style="position:absolute;top:2031;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2</font></font></a></nobr></div>
<div style="position:absolute;top:2031;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BIOS，引导块和幻数。</font><font style="vertical-align: inherit;">。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:2031;left:724"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></nobr></div>
<div style="position:absolute;top:2049;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3</font></font></a></nobr></div>
<div style="position:absolute;top:2049;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU仿真。</font><font style="vertical-align: inherit;">。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:2049;left:724"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></nobr></div>
<div style="position:absolute;top:2067;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3.1</font></font></a></nobr></div>
<div style="position:absolute;top:2067;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bochs：x86 CPU仿真器。</font><font style="vertical-align: inherit;">。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:2067;left:724"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></nobr></div>
<div style="position:absolute;top:2085;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3.2</font></font></a></nobr></div>
<div style="position:absolute;top:2085;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QEmu。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:2085;left:724"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></nobr></div>
<div style="position:absolute;top:2103;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.4</font></font></a></nobr></div>
<div style="position:absolute;top:2103;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">十六进制符号的有用性。</font><font style="vertical-align: inherit;">。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:2103;left:724"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></nobr></div>
<div style="position:absolute;top:2138;left:159"><nobr><a href="https://translate.googleusercontent.com/translate_f#12"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3引导扇区编程（16位实模式）</font></font></a></nobr></div>
<div style="position:absolute;top:2138;left:723"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></nobr></div>
<div style="position:absolute;top:2156;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#12"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1</font></font></a></nobr></div>
<div style="position:absolute;top:2156;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#12"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新访问引导扇区。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:2156;left:724"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></nobr></div>
<div style="position:absolute;top:2174;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#14"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2</font></font></a></nobr></div>
<div style="position:absolute;top:2174;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#14"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16位实模式。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">10</font></font></nobr></div>
<div style="position:absolute;top:2192;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#14"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3</font></font></a></nobr></div>
<div style="position:absolute;top:2192;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#14"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">恩，你好？</font><font style="vertical-align: inherit;">。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">10</font></font></nobr></div>
<div style="position:absolute;top:2210;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#15"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3.1</font></font></a></nobr></div>
<div style="position:absolute;top:2210;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#15"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中断</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">11</font></font></nobr></div>
<div style="position:absolute;top:2228;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#15"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3.2</font></font></a></nobr></div>
<div style="position:absolute;top:2228;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#15"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU寄存器。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">11</font></font></nobr></div>
<div style="position:absolute;top:2246;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#15"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3.3</font></font></a></nobr></div>
<div style="position:absolute;top:2246;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#15"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全部放在一起</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">11</font></font></nobr></div>
<div style="position:absolute;top:2264;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#17"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4</font></font></a></nobr></div>
<div style="position:absolute;top:2264;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#17"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">你好，世界！</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">13</font></font></nobr></div>
<div style="position:absolute;top:2282;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#17"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.1</font></font></a></nobr></div>
<div style="position:absolute;top:2282;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#17"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存，地址和标签。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">13</font></font></nobr></div>
<div style="position:absolute;top:2300;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#17"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.2</font></font></a></nobr></div>
<div style="position:absolute;top:2300;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#17"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ X”标记为Spot。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">13</font></font></nobr></div>
<div style="position:absolute;top:2318;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#20"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题1。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">16</font></font></nobr></div>
<div style="position:absolute;top:2336;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#20"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.3</font></font></a></nobr></div>
<div style="position:absolute;top:2336;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#20"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义字符串</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">16</font></font></nobr></div>
<div style="position:absolute;top:2354;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#21"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.4</font></font></a></nobr></div>
<div style="position:absolute;top:2354;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#21"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用堆栈。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">17</font></font></nobr></div>
<div style="position:absolute;top:2372;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#21"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题2 。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">17</font></font></nobr></div>
<div style="position:absolute;top:2389;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#21"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.5</font></font></a></nobr></div>
<div style="position:absolute;top:2389;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#21"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制结构</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">17</font></font></nobr></div>
<div style="position:absolute;top:2407;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#23"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题3。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">19</font></font></nobr></div>
<div style="position:absolute;top:2425;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#23"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.6</font></font></a></nobr></div>
<div style="position:absolute;top:2425;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#23"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用函数。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">19</font></font></nobr></div>
<div style="position:absolute;top:2443;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#25"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.7</font></font></a></nobr></div>
<div style="position:absolute;top:2443;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#25"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括文件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">21岁</font></font></nobr></div>
<div style="position:absolute;top:2461;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#25"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.8</font></font></a></nobr></div>
<div style="position:absolute;top:2461;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#25"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全部放在一起</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">21岁</font></font></nobr></div>
<div style="position:absolute;top:2479;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#25"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题4。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">21岁</font></font></nobr></div>
<div style="position:absolute;top:2497;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#26"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.9</font></font></a></nobr></div>
<div style="position:absolute;top:2497;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#26"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概括 。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">22</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:2546;left:440"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ii</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:2699;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="3"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3页</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:2843;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容</font></font></nobr></div>
<div style="position:absolute;top:2843;left:717"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iii</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:2898;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#26"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.5</font></font></a></nobr></div>
<div style="position:absolute;top:2898;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#26"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">护士，给我拿我的Steth-o-scope。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">22</font></font></nobr></div>
<div style="position:absolute;top:2916;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#27"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.5.1</font></font></a></nobr></div>
<div style="position:absolute;top:2916;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#27"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题5（高级）。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">23</font></font></nobr></div>
<div style="position:absolute;top:2934;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#27"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.6</font></font></a></nobr></div>
<div style="position:absolute;top:2934;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#27"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取磁盘。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">23</font></font></nobr></div>
<div style="position:absolute;top:2952;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#27"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.6.1</font></font></a></nobr></div>
<div style="position:absolute;top:2952;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#27"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用段扩展的内存访问。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">23</font></font></nobr></div>
<div style="position:absolute;top:2970;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#28"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.6.2</font></font></a></nobr></div>
<div style="position:absolute;top:2970;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#28"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘驱动器如何工作。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">24</font></font></nobr></div>
<div style="position:absolute;top:2988;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#31"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.6.3</font></font></a></nobr></div>
<div style="position:absolute;top:2988;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#31"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用BIOS读取磁盘。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">27</font></font></nobr></div>
<div style="position:absolute;top:3006;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#32"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.6.4</font></font></a></nobr></div>
<div style="position:absolute;top:3006;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#32"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全部放在一起</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">28岁</font></font></nobr></div>
<div style="position:absolute;top:3041;left:159"><nobr><a href="https://translate.googleusercontent.com/translate_f#34"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4进入32位保护模式</font></font></a></nobr></div>
<div style="position:absolute;top:3041;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></nobr></div>
<div style="position:absolute;top:3059;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#35"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1</font></font></a></nobr></div>
<div style="position:absolute;top:3059;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#35"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有BIOS就能适应生活。</font><font style="vertical-align: inherit;">。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">31</font></font></nobr></div>
<div style="position:absolute;top:3077;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#36"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2</font></font></a></nobr></div>
<div style="position:absolute;top:3077;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#36"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解全局描述符表。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">32</font></font></nobr></div>
<div style="position:absolute;top:3095;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#39"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3</font></font></a></nobr></div>
<div style="position:absolute;top:3095;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#39"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在组装中定义GDT。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">35</font></font></nobr></div>
<div style="position:absolute;top:3113;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#40"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4</font></font></a></nobr></div>
<div style="position:absolute;top:3113;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#40"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行切换。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">36</font></font></nobr></div>
<div style="position:absolute;top:3131;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#43"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5</font></font></a></nobr></div>
<div style="position:absolute;top:3131;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#43"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全部放在一起</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">39</font></font></nobr></div>
<div style="position:absolute;top:3166;left:159"><nobr><a href="https://translate.googleusercontent.com/translate_f#45"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5编写，构建和加载内核</font></font></a></nobr></div>
<div style="position:absolute;top:3166;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">41</font></font></nobr></div>
<div style="position:absolute;top:3184;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#45"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1</font></font></a></nobr></div>
<div style="position:absolute;top:3184;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#45"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解C编译。</font><font style="vertical-align: inherit;">。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">41</font></font></nobr></div>
<div style="position:absolute;top:3202;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#45"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.1</font></font></a></nobr></div>
<div style="position:absolute;top:3202;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#45"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成原始机器代码。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">41</font></font></nobr></div>
<div style="position:absolute;top:3220;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#48"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.2</font></font></a></nobr></div>
<div style="position:absolute;top:3220;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#48"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">局部变量</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">44</font></font></nobr></div>
<div style="position:absolute;top:3238;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#50"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.3</font></font></a></nobr></div>
<div style="position:absolute;top:3238;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#50"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用函数。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">46</font></font></nobr></div>
<div style="position:absolute;top:3256;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#51"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.4</font></font></a></nobr></div>
<div style="position:absolute;top:3256;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#51"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指针，地址和数据。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">47</font></font></nobr></div>
<div style="position:absolute;top:3274;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#53"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2</font></font></a></nobr></div>
<div style="position:absolute;top:3274;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#53"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行我们的内核代码。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">49</font></font></nobr></div>
<div style="position:absolute;top:3292;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#54"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.1</font></font></a></nobr></div>
<div style="position:absolute;top:3292;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#54"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写我们的内核。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">50</font></font></nobr></div>
<div style="position:absolute;top:3310;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#54"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.2</font></font></a></nobr></div>
<div style="position:absolute;top:3310;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#54"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一个引导扇区来引导我们的内核</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">50</font></font></nobr></div>
<div style="position:absolute;top:3328;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#57"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.3</font></font></a></nobr></div>
<div style="position:absolute;top:3328;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#57"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寻找通往内核的路。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">53</font></font></nobr></div>
<div style="position:absolute;top:3346;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#58"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3</font></font></a></nobr></div>
<div style="position:absolute;top:3346;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#58"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用Make自动化构建。</font><font style="vertical-align: inherit;">。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">54</font></font></nobr></div>
<div style="position:absolute;top:3364;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#61"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3.1</font></font></a></nobr></div>
<div style="position:absolute;top:3364;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#61"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整理我们的操作系统的代码库</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">57</font></font></nobr></div>
<div style="position:absolute;top:3381;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#63"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4</font></font></a></nobr></div>
<div style="position:absolute;top:3381;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#63"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C入门。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">59</font></font></nobr></div>
<div style="position:absolute;top:3399;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#63"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4.1</font></font></a></nobr></div>
<div style="position:absolute;top:3399;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#63"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预处理程序和指令。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">59</font></font></nobr></div>
<div style="position:absolute;top:3417;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#64"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4.2</font></font></a></nobr></div>
<div style="position:absolute;top:3417;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#64"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数声明和头文件。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">60</font></font></nobr></div>
<div style="position:absolute;top:3453;left:159"><nobr><a href="https://translate.googleusercontent.com/translate_f#66"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6开发基本设备驱动程序和文件系统</font></font></a></nobr></div>
<div style="position:absolute;top:3453;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">62</font></font></nobr></div>
<div style="position:absolute;top:3471;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#66"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1</font></font></a></nobr></div>
<div style="position:absolute;top:3471;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#66"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">硬件输入/输出。</font><font style="vertical-align: inherit;">。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">62</font></font></nobr></div>
<div style="position:absolute;top:3489;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#67"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.1</font></font></a></nobr></div>
<div style="position:absolute;top:3489;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#67"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I / O总线。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">63</font></font></nobr></div>
<div style="position:absolute;top:3507;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#67"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2</font></font></a></nobr></div>
<div style="position:absolute;top:3507;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#67"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I / O编程。</font><font style="vertical-align: inherit;">。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">63</font></font></nobr></div>
<div style="position:absolute;top:3525;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#69"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.3</font></font></a></nobr></div>
<div style="position:absolute;top:3525;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#69"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接内存访问。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">65岁</font></font></nobr></div>
<div style="position:absolute;top:3543;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#69"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2</font></font></a></nobr></div>
<div style="position:absolute;top:3543;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#69"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕驱动程序。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">65岁</font></font></nobr></div>
<div style="position:absolute;top:3560;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#69"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.1</font></font></a></nobr></div>
<div style="position:absolute;top:3560;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#69"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解显示设备。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">65岁</font></font></nobr></div>
<div style="position:absolute;top:3578;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#69"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.2</font></font></a></nobr></div>
<div style="position:absolute;top:3578;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#69"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本屏幕驱动程序的实现。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">65岁</font></font></nobr></div>
<div style="position:absolute;top:3596;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#73"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.3</font></font></a></nobr></div>
<div style="position:absolute;top:3596;left:282"><nobr><a href="https://translate.googleusercontent.com/translate_f#73"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">滚动屏幕</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">69</font></font></nobr></div>
<div style="position:absolute;top:3614;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#74"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3</font></font></a></nobr></div>
<div style="position:absolute;top:3614;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#74"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理中断。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">70</font></font></nobr></div>
<div style="position:absolute;top:3632;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#74"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4</font></font></a></nobr></div>
<div style="position:absolute;top:3632;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#74"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键盘驱动程序。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">70</font></font></nobr></div>
<div style="position:absolute;top:3650;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#74"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5</font></font></a></nobr></div>
<div style="position:absolute;top:3650;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#74"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">硬盘驱动器。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">70</font></font></nobr></div>
<div style="position:absolute;top:3668;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#74"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.6</font></font></a></nobr></div>
<div style="position:absolute;top:3668;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#74"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件系统 。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">70</font></font></nobr></div>
<div style="position:absolute;top:3704;left:159"><nobr><a href="https://translate.googleusercontent.com/translate_f#75"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7实施过程</font></font></a></nobr></div>
<div style="position:absolute;top:3704;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">71</font></font></nobr></div>
<div style="position:absolute;top:3721;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#75"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.1</font></font></a></nobr></div>
<div style="position:absolute;top:3721;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#75"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单一加工。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">71</font></font></nobr></div>
<div style="position:absolute;top:3739;left:185"><nobr><a href="https://translate.googleusercontent.com/translate_f#75"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.2</font></font></a></nobr></div>
<div style="position:absolute;top:3739;left:226"><nobr><a href="https://translate.googleusercontent.com/translate_f#75"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多重处理。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">71</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:3961;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="4"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4页</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:4105;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容</font></font></nobr></div>
<div style="position:absolute;top:4105;left:717"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iv</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:4160;left:159"><nobr><a href="https://translate.googleusercontent.com/translate_f#76"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8小结</font></font></a></nobr></div>
<div style="position:absolute;top:4160;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">72</font></font></nobr></div>
<div style="position:absolute;top:4196;left:159"><nobr><a href="https://translate.googleusercontent.com/translate_f#77"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考书目</font></font></a></nobr></div>
<div style="position:absolute;top:4196;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">73</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:5223;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="5"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5页</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:5534;left:389"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一章</font></font><font style="font-size:35px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></font></nobr></div>
</span></font>
<font size="5" color="#2b57a3" face="Times"><span style="font-size:35px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:5609;left:340"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:5718;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们以前都使用过操作系统（OS）（例如Windows XP，Linux等），并且</font></font></nobr></div>
<div style="position:absolute;top:5736;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也许我们甚至编写了一些程序来运行；</font><font style="vertical-align: inherit;">但是实际上是什么操作系统</font></font></nobr></div>
<div style="position:absolute;top:5754;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有什么用 </font><font style="vertical-align: inherit;">使用计算机时，我看到的大部分内容是由硬件完成的，以及如何</font></font></nobr></div>
<div style="position:absolute;top:5772;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">软件完成了多少工作？</font><font style="vertical-align: inherit;">以及计算机实际上是如何工作的？</font></font></nobr></div>
<div style="position:absolute;top:5790;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">兰卡斯特大学的一位活跃老师，已故的道格·谢泼德教授（Doug Shepherd）</font></font></nobr></div>
<div style="position:absolute;top:5808;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">曾经在我抱怨一些烦人的编程问题时提醒我，</font></font></nobr></div>
<div style="position:absolute;top:5825;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回到那天，在他甚至无法开始任何研究之前，他就不得不写</font></font></nobr></div>
<div style="position:absolute;top:5843;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从头开始拥有自己的操作系统。</font><font style="vertical-align: inherit;">因此，今天看来，我们花了很多时间</font></font></nobr></div>
<div style="position:absolute;top:5861;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些出色的机器在所有这些层下的实际工作方式都得到了认可</font></font></nobr></div>
<div style="position:absolute;top:5879;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常与它们捆绑在一起的软件，并且它们是必需的</font></font></nobr></div>
<div style="position:absolute;top:5897;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日常实用性。</font></font></nobr></div>
<div style="position:absolute;top:5915;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里，集中讨论广泛使用的x86架构CPU，我们将裸露我们的</font></font></nobr></div>
<div style="position:absolute;top:5933;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有软件的计算机，并遵循Doug的早期脚步，沿途学习</font></font></nobr></div>
<div style="position:absolute;top:5951;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于：</font></font></nobr></div>
<div style="position:absolute;top:5977;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•电脑的启动方式</font></font></nobr></div>
<div style="position:absolute;top:6003;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•如何在没有操作的荒芜环境中编写低级程序</font></font></nobr></div>
<div style="position:absolute;top:6022;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统尚未存在</font></font></nobr></div>
<div style="position:absolute;top:6047;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•如何配置CPU，以便我们可以开始使用其扩展功能</font></font></nobr></div>
<div style="position:absolute;top:6074;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•如何引导使用高级语言编写的代码，以便我们能够真正</font></font></nobr></div>
<div style="position:absolute;top:6093;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始在我们自己的操作系统上取得一些进展</font></font></nobr></div>
<div style="position:absolute;top:6118;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•如何创建一些基本的操作系统服务，例如设备驱动程序，</font></font></nobr></div>
<div style="position:absolute;top:6137;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件系统，多任务处理。</font></font></nobr></div>
<div style="position:absolute;top:6163;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，就实用的操作系统功能而言，本指南并不</font></font></nobr></div>
<div style="position:absolute;top:6181;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">旨在扩大范围，但旨在将来自以下方面的信息摘要集中到一起</font></font></nobr></div>
<div style="position:absolute;top:6199;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">许多资源都包含在一个独立且连贯的文档中，可以助您一臂之力</font></font></nobr></div>
<div style="position:absolute;top:6217;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低级编程经验，操作系统编写方式以及种类</font></font></nobr></div>
<div style="position:absolute;top:6235;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他们必须解决的问题。</font><font style="vertical-align: inherit;">本指南采用的方法的独特之处在于</font></font></nobr></div>
<div style="position:absolute;top:6253;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定的语言和工具（例如汇编，C，Make等）不是重点，而是</font></font></nobr></div>
<div style="position:absolute;top:6271;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相反，它们被视为达到目的的一种手段：我们将学习我们需要的这些知识</font></font></nobr></div>
<div style="position:absolute;top:6289;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有助于我们实现主要目标的事物。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:6332;left:441"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1个</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:6485;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="6"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6页</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:6629;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第1章简介</font></font></nobr></div>
<div style="position:absolute;top:6629;left:722"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2个</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:6684;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这项工作不是要替代，而是要成为卓越的垫脚石。</font></font></nobr></div>
<div style="position:absolute;top:6702;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">诸如Minix项目[？]之类的工作，以及一般而言的操作系统开发。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:7747;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="7"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7页</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:8058;left:389"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">章</font></font><font style="font-size:35px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></font></nobr></div>
</span></font>
<font size="5" color="#2b57a3" face="Times"><span style="font-size:35px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:8133;left:177"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算机体系结构与</font></font></nobr></div>
<div style="position:absolute;top:8178;left:331"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开机程序</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:8286;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1引导过程</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:8329;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们开始我们的旅程。</font></font></nobr></div>
<div style="position:absolute;top:8347;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们重新启动计算机时，它必须再次启动，最初没有任何关于</font></font></nobr></div>
<div style="position:absolute;top:8365;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个操作系统。</font><font style="vertical-align: inherit;">无论如何，它都必须加载操作系统---</font></font></nobr></div>
<div style="position:absolute;top:8383;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能是---来自当前连接到</font></font></nobr></div>
<div style="position:absolute;top:8401;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算机（例如软盘，硬盘，USB加密狗等）。</font></font></nobr></div>
<div style="position:absolute;top:8419;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们很快就会发现，您的计算机的pre-OS环境几乎无法提供</font></font></nobr></div>
<div style="position:absolute;top:8437;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">丰富服务的方式：在此阶段，即使是简单的文件系统也将是奢侈的（例如，</font></font></nobr></div>
<div style="position:absolute;top:8455;left:159"><nobr><font style="vertical-align: inherit;"><font class="" style="vertical-align: inherit;">读取和写入逻辑文件到磁盘），但是我们没有。</font><font style="vertical-align: inherit;">幸运的是，我们所拥有的</font></font></nobr></div>
<div style="position:absolute;top:8473;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是基本输入/输出软件（BIOS），它是</font></font></nobr></div>
<div style="position:absolute;top:8491;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初从芯片加载到内存中，并在切换计算机时进行初始化</font></font></nobr></div>
<div style="position:absolute;top:8508;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上。</font><font style="vertical-align: inherit;">BIOS提供了对计算机基本设备的自动检测和基本控制，</font></font></nobr></div>
<div style="position:absolute;top:8526;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如屏幕，键盘和硬盘。</font></font></nobr></div>
<div style="position:absolute;top:8544;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BIOS完成对硬件的一些低级测试后，尤其是是否</font></font></nobr></div>
<div style="position:absolute;top:8562;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并非已安装的内存工作正常，则必须启动存储的操作系统</font></font></nobr></div>
<div style="position:absolute;top:8580;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在您的其中一台设备上。</font><font style="vertical-align: inherit;">在此提醒我们，BIOS不能简单地加载一个</font></font></nobr></div>
<div style="position:absolute;top:8598;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从磁盘代表您的操作系统的文件，因为BIOS没有文件的概念-</font></font></nobr></div>
<div style="position:absolute;top:8616;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统。</font><font style="vertical-align: inherit;">BIOS必须从特定的区域读取特定的数据扇区（通常为512字节大小）</font></font></nobr></div>
<div style="position:absolute;top:8634;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘设备的物理位置，例如圆柱2，磁头3，扇区5（详细信息</font></font></nobr></div>
<div style="position:absolute;top:8652;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘寻址将在后面的XXX节中介绍。</font></font></nobr></div>
<div style="position:absolute;top:8670;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，BIOS最容易找到我们的操作系统的位置是其中一个磁盘的第一个扇区</font></font></nobr></div>
<div style="position:absolute;top:8688;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（即圆柱0，缸头0，扇区0），称为引导扇区。</font><font style="vertical-align: inherit;">由于我们的某些磁盘可能</font></font></nobr></div>
<div style="position:absolute;top:8706;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不包含操作系统（它们可能只是连接起来以用于其他存储），</font></font></nobr></div>
<div style="position:absolute;top:8724;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那么重要的是BIOS可以确定特定引导区是否</font></font></nobr></div>
<div style="position:absolute;top:8742;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘是用于执行或仅用于数据的引导代码。</font><font style="vertical-align: inherit;">请注意，CPU</font></font></nobr></div>
<div style="position:absolute;top:8759;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能区分代码和数据：两者都可以解释为CPU指令，</font></font></nobr></div>
<div style="position:absolute;top:8777;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其中的代码只是程序员已经编写成一些指令的简单指令</font></font></nobr></div>
<div style="position:absolute;top:8795;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有用的算法。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:8856;left:441"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:9009;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="8"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8页</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:9153;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2章计算机体系结构和引导</font></font></nobr></div>
<div style="position:absolute;top:9174;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程</font></font></nobr></div>
<div style="position:absolute;top:9174;left:722"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:9208;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同样，BIOS在这里采用了一种简单的方法，其中最后两个</font></font></nobr></div>
<div style="position:absolute;top:9226;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预期的引导扇区的字节必须设置为幻数</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xaa55</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，BIOS</font></font></nobr></div>
<div style="position:absolute;top:9244;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">遍历每个存储设备（例如软盘驱动器，硬盘，CD驱动器等），读取</font></font></nobr></div>
<div style="position:absolute;top:9262;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引导扇区进入内存，并指示CPU开始执行第一次引导</font></font></nobr></div>
<div style="position:absolute;top:9280;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它发现以幻数结尾的扇区。</font></font></nobr></div>
<div style="position:absolute;top:9298;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是我们抓住计算机的控制权的地方。</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:9350;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2 BIOS，启动块和魔术</font></font></nobr></div>
<div style="position:absolute;top:9383;left:225"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数字</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:9426;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们使用二进制编辑器，例如TextPad [？]或GHex [？]，那将使我们能够写入原始字节</font></font></nobr></div>
<div style="position:absolute;top:9444;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值到文件---而不是标准的文本编辑器，它将转换字符，例如</font></font></nobr></div>
<div style="position:absolute;top:9462;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将“ A”转换为ASCII值---然后我们可以为自己设计一个简单而有效的引导扇区。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:9522;left:181"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e9 fd ff 00 00 00 00 00 00 00 00 00 00 00 00 00</font></font></nobr></div>
<div style="position:absolute;top:9536;left:181"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</font></font></nobr></div>
<div style="position:absolute;top:9550;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></nobr></div>
<div style="position:absolute;top:9564;left:181"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 55 aa</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:9634;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图2.1：机器代码启动扇区，每个字节显示在</font></font></nobr></div>
<div style="position:absolute;top:9655;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">十六进制。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:9704;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，在图</font></font><a href="https://translate.googleusercontent.com/translate_f#8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，三个重要功能是：</font></font></nobr></div>
<div style="position:absolute;top:9730;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•最初的三个字节，以十六进制的</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xe9</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xfd</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xFF的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，实际上是</font></font></nobr></div>
<div style="position:absolute;top:9749;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由CPU制造商定义的机器代码指令，以执行</font></font></nobr></div>
<div style="position:absolute;top:9767;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无尽的跳跃。</font></font></nobr></div>
<div style="position:absolute;top:9793;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•最后两个字节</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x55</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xaa</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组成了幻数，它告诉BIOS</font></font></nobr></div>
<div style="position:absolute;top:9812;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这确实是一个启动块，而不仅仅是驱动器上的数据</font></font></nobr></div>
<div style="position:absolute;top:9830;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引导扇区。</font></font></nobr></div>
<div style="position:absolute;top:9856;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•文件用零填充（“ *”表示为简洁起见省略了零），基本上是</font></font></nobr></div>
<div style="position:absolute;top:9874;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将魔术BIOS编号放在512字节磁盘扇区的末尾。</font></font></nobr></div>
<div style="position:absolute;top:9901;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关字节序的重要说明。</font><font style="vertical-align: inherit;">您可能想知道为什么神奇的BIOS</font></font></nobr></div>
<div style="position:absolute;top:9919;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数字先前被描述为16位值</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xaa55，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但在我们的引导扇区中为</font></font></nobr></div>
<div style="position:absolute;top:9937;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写入为连续字节</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x55</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xaa</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是因为x86架构</font></font></nobr></div>
<div style="position:absolute;top:9955;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理小字节序格式的多字节值，从而减少有效字节</font></font></nobr></div>
<div style="position:absolute;top:9973;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更高的字节，这与我们熟悉的编号系统相反---尽管</font></font></nobr></div>
<div style="position:absolute;top:9991;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的系统曾经切换过，我的银行帐户中有0000005英镑，我可以</font></font></nobr></div>
<div style="position:absolute;top:10009;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在退休，也许向有需要的前百万富翁基金会捐赠几英镑。</font></font></nobr></div>
<div style="position:absolute;top:10027;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编译器和汇编器可以通过允许对我们隐藏许多字节序问题</font></font></nobr></div>
<div style="position:absolute;top:10045;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们定义数据类型，例如自动将16位值序列化</font></font></nobr></div>
<div style="position:absolute;top:10063;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转换为机器代码，其字节顺序正确。</font><font style="vertical-align: inherit;">但是，有时它很有用，</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:10271;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="9"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9页</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:10415;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2章计算机体系结构和引导</font></font></nobr></div>
<div style="position:absolute;top:10436;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程</font></font></nobr></div>
<div style="position:absolute;top:10436;left:722"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:10470;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特别是在寻找错误时，要确切知道单个字节的存储位置</font></font></nobr></div>
<div style="position:absolute;top:10488;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在存储设备或内存中，因此字节序非常重要。</font></font></nobr></div>
<div style="position:absolute;top:10506;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这可能是计算机可以运行的最小程序，但它是有效的</font></font></nobr></div>
<div style="position:absolute;top:10524;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管如此，我们可以通过两种方式对此进行测试，其中第二种更为安全</font></font></nobr></div>
<div style="position:absolute;top:10542;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并更适合我们的实验类型：</font></font></nobr></div>
<div style="position:absolute;top:10568;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•使用当前操作系统允许的任何方式编写此引导</font></font></nobr></div>
<div style="position:absolute;top:10587;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阻塞到非必需存储设备（例如软盘或闪存）的第一个扇区</font></font></nobr></div>
<div style="position:absolute;top:10605;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动器），然后重新启动计算机。</font></font></nobr></div>
<div style="position:absolute;top:10631;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•使用虚拟机软件，例如VMWare或VirtualBox，并设置启动</font></font></nobr></div>
<div style="position:absolute;top:10649;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块代码作为虚拟机的磁盘映像，然后启动虚拟机。</font></font></nobr></div>
<div style="position:absolute;top:10676;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您的计算机只是简单的，您可以确定此代码已被加载并执行</font></font></nobr></div>
<div style="position:absolute;top:10694;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引导后挂起，没有诸如“找不到操作系统”之类的消息。</font><font style="vertical-align: inherit;">这是</font></font></nobr></div>
<div style="position:absolute;top:10712;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在代码的开头放置了无限循环。</font><font style="vertical-align: inherit;">没有此循环，CPU</font></font></nobr></div>
<div style="position:absolute;top:10730;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将会中断，执行内存中的每个后续指令，其中大多数将</font></font></nobr></div>
<div style="position:absolute;top:10748;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是随机的，未初始化的字节，直到它自身陷入某种无效状态为止，或者</font></font></nobr></div>
<div style="position:absolute;top:10766;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新启动，或者偶然地偶然发现并运行BIOS例程以格式化您的主计算机</font></font></nobr></div>
<div style="position:absolute;top:10784;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘。</font></font></nobr></div>
<div style="position:absolute;top:10802;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请记住，是我们对计算机进行编程，并且计算机遵循我们的要求</font></font></nobr></div>
<div style="position:absolute;top:10820;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">盲目地获取指令并执行它们，直到关闭指令；</font><font style="vertical-align: inherit;">所以我们需要</font></font></nobr></div>
<div style="position:absolute;top:10838;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确保它执行的是我们精心制作的代码，而不是执行某些操作时保存的随机字节数据，</font></font></nobr></div>
<div style="position:absolute;top:10856;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存中的位置。</font><font style="vertical-align: inherit;">在这个低水平上，我们对自己有很多权力和责任</font></font></nobr></div>
<div style="position:absolute;top:10874;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算机，因此我们需要学习如何控制它。</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:10926;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3 CPU仿真</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:10969;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还有第三种更方便的选项可用于测试这些低级程序，而无需</font></font></nobr></div>
<div style="position:absolute;top:10987;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连续不得不重新启动计算机，否则可能会擦掉重要数据的风险</font></font></nobr></div>
<div style="position:absolute;top:11005;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘，即使用诸如Bochs或QEmu之类的CPU仿真器。</font><font style="vertical-align: inherit;">不像机器</font></font></nobr></div>
<div style="position:absolute;top:11023;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟化（例如VMware，VirtualBox），它尝试针对性能和性能进行优化</font></font></nobr></div>
<div style="position:absolute;top:11041;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，通过直接在计算机上运行来宾指令来使用托管操作系统</font></font></nobr></div>
<div style="position:absolute;top:11059;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在CPU中，仿真涉及行为类似于特定CPU体系结构的程序，</font></font></nobr></div>
<div style="position:absolute;top:11077;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用变量表示CPU寄存器并使用高级控制结构进行仿真</font></font></nobr></div>
<div style="position:absolute;top:11095;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">较低级别的跳跃等，因此速度较慢，但​​通常更适合开发</font></font></nobr></div>
<div style="position:absolute;top:11113;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并调试此类系统。</font></font></nobr></div>
<div style="position:absolute;top:11131;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，为了对模拟器执行任何有用的操作，您需要给它一些</font></font></nobr></div>
<div style="position:absolute;top:11148;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码以磁盘映像文件的形式运行。</font><font style="vertical-align: inherit;">图像文件只是原始数据（即</font></font></nobr></div>
<div style="position:absolute;top:11166;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器代码和数据），否则这些内容将被写入硬介质中</font></font></nobr></div>
<div style="position:absolute;top:11184;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘，软盘，CDROM，U盘等。的确，某些仿真器将成功</font></font></nobr></div>
<div style="position:absolute;top:11202;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从下载的映像文件或从中提取的映像文件引导并运行实际的操作系统</font></font></nobr></div>
<div style="position:absolute;top:11220;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装CDROM-尽管虚拟化更适合这种使用。</font></font></nobr></div>
<div style="position:absolute;top:11238;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仿真器将低级显示设备指令转换为像素渲染</font></font></nobr></div>
<div style="position:absolute;top:11256;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">桌面窗口，这样您就可以准确看到在真实显示器上呈现的内容。</font></font></nobr></div>
<div style="position:absolute;top:11274;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常，对于本文档中的练习，可以得出任何机器代码</font></font></nobr></div>
<div style="position:absolute;top:11292;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在模拟器下正确运行的软件将在实际架构上正确运行-</font></font></nobr></div>
<div style="position:absolute;top:11310;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管显然必须更快。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:11533;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="10"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第10章</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:11677;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2章计算机体系结构和引导</font></font></nobr></div>
<div style="position:absolute;top:11698;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程</font></font></nobr></div>
<div style="position:absolute;top:11698;left:722"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:11727;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3.1 Bochs：x86 CPU仿真器</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:11762;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bochs要求我们</font><font style="vertical-align: inherit;">在本地目录中</font><font style="vertical-align: inherit;">设置一个简单的配置文件</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bochsrc</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:11780;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述如何使用真实设备（例如屏幕和键盘）的详细信息</font></font></nobr></div>
<div style="position:absolute;top:11797;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仿真，重要的是，仿真时要引导哪个软盘映像</font></font></nobr></div>
<div style="position:absolute;top:11815;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算机启动。</font></font></nobr></div>
<div style="position:absolute;top:11833;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font><a href="https://translate.googleusercontent.com/translate_f#10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了一个示例Bochs配置文件，我们可以使用它来测试启动</font></font></nobr></div>
<div style="position:absolute;top:11851;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扇区写在XXX节中，并另存为文件</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">boot sect.bin</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:11908;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃告诉bochs使用我们的引导扇区代码，就像</font></font></nobr></div>
<div style="position:absolute;top:11922;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃在引导时插入计算机的软盘。</font></font></nobr></div>
<div style="position:absolute;top:11937;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">floppya：1_44 = boot_sect.bin，状态=已插入</font></font></nobr></div>
<div style="position:absolute;top:11951;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">靴子：一个</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:12020;left:266"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图2.2：一个简单的Bochs配置文件。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:12075;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要在Bochs中测试我们的引导扇区，只需键入：</font></font></nobr></div>
<div style="position:absolute;top:12103;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ bochs</font></font></nobr></div>
<div style="position:absolute;top:12129;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为一个简单的实验，请尝试将我们引导区中的BIOS幻数更改为</font></font></nobr></div>
<div style="position:absolute;top:12147;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无效的东西，然后重新运行Bochs。</font></font></nobr></div>
<div style="position:absolute;top:12165;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于Bochs对CPU的仿真接近真实，因此在测试代码之后</font></font></nobr></div>
<div style="position:absolute;top:12183;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Bochs中，您应该能够将其引导到可在其上运行很多功能的真实计算机上</font></font></nobr></div>
<div style="position:absolute;top:12201;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快点。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:12248;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3.2 QEmu</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:12282;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QEmu与Bochs类似，但效率更高，并且还可以模拟</font></font></nobr></div>
<div style="position:absolute;top:12300;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86以外的其他体系结构。</font><font style="vertical-align: inherit;">尽管QEmu的文档记录不如Bochs好，但这是一个需要</font></font></nobr></div>
<div style="position:absolute;top:12318;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有配置文件意味着更容易运行，如下所示：</font></font></nobr></div>
<div style="position:absolute;top:12346;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ qemu &lt;您的操作系统引导磁盘映像文件&gt;</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:12397;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.4十六进制的有用性</font></font></nobr></div>
<div style="position:absolute;top:12430;left:225"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">符号</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:12473;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们已经看到了十六进制的一些示例，因此了解为什么很重要</font></font></nobr></div>
<div style="position:absolute;top:12491;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在较低级别的编程中经常使用十六进制。</font></font></nobr></div>
<div style="position:absolute;top:12509;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，考虑一下为什么对我们来说十分自然地计数十分有用，</font></font></nobr></div>
<div style="position:absolute;top:12527;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为当我们第一次看到十六进制时，我们总是问自己：为什么不</font></font></nobr></div>
<div style="position:absolute;top:12545;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单地数到十？</font><font style="vertical-align: inherit;">我不是这个问题的专家，我会假设</font></font></nobr></div>
<div style="position:absolute;top:12563;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数到十与大多数人的十根手指有关</font></font></nobr></div>
<div style="position:absolute;top:12581;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他们的双手，导致数字的想法被表示为10个不同的符号：</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:12600;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,1,2，... 8,9</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:12795;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="11"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第11页</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:12939;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2章计算机体系结构和引导</font></font></nobr></div>
<div style="position:absolute;top:12960;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程</font></font></nobr></div>
<div style="position:absolute;top:12960;left:722"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:12994;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">十进制的底数是十（即有十个不同的数字符号），而十六进制的底数是十</font></font></nobr></div>
<div style="position:absolute;top:13012;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以16为底的数字，因此我们必须发明一些新的数字符号；</font><font style="vertical-align: inherit;">而懒惰的方式只是</font></font></nobr></div>
<div style="position:absolute;top:13030;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用几个字母，给我们：</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,1,2，...... 8,9，A，B，C，d，E，F</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中单位</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，对</font></font></nobr></div>
<div style="position:absolute;top:13048;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，代表计数为13。</font></font></nobr></div>
<div style="position:absolute;top:13066;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了区分十六进制系统和其他数字系统，我们经常使用前缀</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:13085;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或后缀</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，对于十六进制数字尤为重要</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:13102;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">碰巧不包含任何字母数字，例如：</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x50</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不等于（十进制）</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:13121;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50 </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0x50</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际上</font></font></font><font style="vertical-align: inherit;"><font color="#000000"><font style="vertical-align: inherit;">是十进制的</font></font><font style="vertical-align: inherit;">80 </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:13138;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题是，计算机将数字表示为位序列（二进制数字），</font></font></nobr></div>
<div style="position:absolute;top:13155;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为从根本上说，其电路只能区分两种电状态：</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:13175;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---就像计算机总共只有两个手指一样。</font><font style="vertical-align: inherit;">所以，代表一个数字</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:13191;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大于</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1时</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，计算机可以将一系列位组合在一起，就像我们可以数</font></font></nobr></div>
<div style="position:absolute;top:13209;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高于</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由具有两个或更多个数字（例如</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">456</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，等等）。</font></font></nobr></div>
<div style="position:absolute;top:13227;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">某些长度的位系列采用了名称，以使其更易于交谈</font></font></nobr></div>
<div style="position:absolute;top:13245;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于并处理我们要处理的数字的大小。</font><font style="vertical-align: inherit;">的说明</font></font></nobr></div>
<div style="position:absolute;top:13263;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大多数计算机至少处理8位值，这些值称为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bytes</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">其他</font></font></nobr></div>
<div style="position:absolute;top:13281;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分组为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">short</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">long</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它们通常代表16位，32位和64位</font></font></nobr></div>
<div style="position:absolute;top:13299;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。</font><font style="vertical-align: inherit;">我们还看到了</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单词word</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它用来</font><font color="#2b57a3"><font style="vertical-align: inherit;">形容词</font></font><font style="vertical-align: inherit;">的大小。</font></font></nobr></div>
<div style="position:absolute;top:13317;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU当前模式的最大处理单位：因此在16位实模式下，</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:13336;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是指16位值；</font><font style="vertical-align: inherit;">在32位保护模式下，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单词</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是指32位值；</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:13353;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等等。</font></font></nobr></div>
<div style="position:absolute;top:13371;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，回到十六进制的好处是：比特串相当冗长，</font></font></nobr></div>
<div style="position:absolute;top:13389;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写出来，但更容易与更简写的十六进制进行相互转换</font></font></nobr></div>
<div style="position:absolute;top:13407;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示法，而不是往返于我们的自然十进制系统，主要是因为我们可以打破</font></font></nobr></div>
<div style="position:absolute;top:13424;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转换成较小的二进制数的4位段，而不是尝试</font></font></nobr></div>
<div style="position:absolute;top:13442;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将所有组件位加起来成为一个总计，这对于更大的组件来说会变得更加困难</font></font></nobr></div>
<div style="position:absolute;top:13460;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位字符串（例如16、32、64等）。</font><font style="vertical-align: inherit;">十进制转换的困难已清楚显示</font></font></nobr></div>
<div style="position:absolute;top:13478;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过图</font><a href="https://translate.googleusercontent.com/translate_f#11"><font style="vertical-align: inherit;">2.3中</font></a><font style="vertical-align: inherit;">给出的示例</font></font><a href="https://translate.googleusercontent.com/translate_f#11"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></a></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:13814;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图2.3：将1101111010110110转换为十进制和十六进制</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:14057;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="12"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12章</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:14368;left:389"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">章</font></font><font style="font-size:35px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></font></nobr></div>
</span></font>
<font size="5" color="#2b57a3" face="Times"><span style="font-size:35px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:14445;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引导扇区编程（在</font></font></nobr></div>
<div style="position:absolute;top:14490;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16位实模式）</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:14607;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即使提供了示例代码，您无疑也会发现它令人沮丧</font></font></nobr></div>
<div style="position:absolute;top:14625;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二进制编辑器中的计算机代码。</font><font style="vertical-align: inherit;">您必须记住或不断参考，</font></font></nobr></div>
<div style="position:absolute;top:14643;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在许多可能的机器代码中，哪一个会导致CPU执行某些功能。</font><font style="vertical-align: inherit;">幸运的是</font></font></nobr></div>
<div style="position:absolute;top:14661;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您并不孤单，因此编写了汇编程序以翻译更人性化的语言</font></font></nobr></div>
<div style="position:absolute;top:14679;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">友好的指令转换为特定CPU的机器代码。</font></font></nobr></div>
<div style="position:absolute;top:14697;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本章中，我们将探讨一些日益复杂的引导扇区程序</font></font></nobr></div>
<div style="position:absolute;top:14715;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使自己熟悉组装和我们之前在贫瘠的OS之前的环境中</font></font></nobr></div>
<div style="position:absolute;top:14733;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序将运行。</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:14785;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1重新访问引导扇区</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:14828;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们将使用XXX节重新创建二进制编辑的引导扇区，而不是使用</font></font></nobr></div>
<div style="position:absolute;top:14846;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇编语言，这样即使是非常底层的语言，我们也可以真正体会到它的价值</font></font></nobr></div>
<div style="position:absolute;top:14864;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语。</font></font></nobr></div>
<div style="position:absolute;top:14882;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以将其汇编成实际的机器代码（CPU的字节序列）。</font></font></nobr></div>
<div style="position:absolute;top:14900;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以解释为说明），如下所示：</font></font></nobr></div>
<div style="position:absolute;top:14928;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ nasm引导sect.asm -f bin -o引导sect.bin</font></font></nobr></div>
<div style="position:absolute;top:14954;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开机sect.asm</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是为我们在图中保存的源代码文件</font></font><a href="https://translate.googleusercontent.com/translate_f#13"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1</font></font></a></nobr></div>
<div style="position:absolute;top:14972;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动sect.bin</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是组装机的代码，我们可以安装一个引导扇区</font></font></nobr></div>
<div style="position:absolute;top:14990;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在磁盘上。</font></font></nobr></div>
<div style="position:absolute;top:15008;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，我们使用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-f bin</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项来指示nasm生成原始机器代码，</font></font></nobr></div>
<div style="position:absolute;top:15026;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是包含附加元信息以链接到其他例程的代码包。</font></font></nobr></div>
<div style="position:absolute;top:15044;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们希望在更典型的操作系统中进行编程时使用的尖齿</font></font></nobr></div>
<div style="position:absolute;top:15061;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">环境。</font><font style="vertical-align: inherit;">我们不需要这些东西。</font><font style="vertical-align: inherit;">除了底层的BIOS例程外，我们</font></font></nobr></div>
<div style="position:absolute;top:15079;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是目前在这台计算机上运行的唯一软件。</font><font style="vertical-align: inherit;">我们现在是操作系统，</font></font></nobr></div>
<div style="position:absolute;top:15097;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管在这个阶段除了无休止的循环外没有什么可提供的，但是我们很快就会</font></font></nobr></div>
<div style="position:absolute;top:15115;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从此建立起来。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:15166;left:441"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:15319;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="13"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13页</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:15463;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:15484;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:15484;left:722"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:15536;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></nobr></div>
<div style="position:absolute;top:15550;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">一个永久循环的简单启动扇区程序。</font></font></nobr></div>
<div style="position:absolute;top:15565;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></nobr></div>
<div style="position:absolute;top:15593;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循环</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></font></nobr></div>
<div style="position:absolute;top:15593;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">定义一个标签“ loop”，它将允许</font></font></nobr></div>
<div style="position:absolute;top:15607;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">我们永远跳回去。</font></font></nobr></div>
<div style="position:absolute;top:15636;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp循环</font></font></nobr></div>
<div style="position:absolute;top:15636;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">使用跳转的简单CPU指令</font></font></nobr></div>
<div style="position:absolute;top:15650;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">到新的内存地址以继续执行。</font></font></nobr></div>
<div style="position:absolute;top:15664;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在我们的情况下，跳转到当前地址</font></font></nobr></div>
<div style="position:absolute;top:15678;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">操作说明。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:15707;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">乘以510-（$-$$）</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0 </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">编译后，我们的程序必须适合512个字节，</font></font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:15721;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">最后两个字节是幻数，</font></font></nobr></div>
<div style="position:absolute;top:15735;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">所以在这里，告诉我们的汇编编译器填充我们的</font></font></nobr></div>
<div style="position:absolute;top:15749;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">具有足够零字节（db 0）的程序以将我们带到</font></font></nobr></div>
<div style="position:absolute;top:15763;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">第510个字节。</font></font></nobr></div>
<div style="position:absolute;top:15792;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xaa55</font></font></font></nobr></div>
<div style="position:absolute;top:15792;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">最后两个字节（一个字）构成了幻数，</font></font></nobr></div>
<div style="position:absolute;top:15806;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">因此BIOS知道我们是引导扇区。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:15875;left:199"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图3.1：一个用汇编语言编写的简单引导扇区。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:15939;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与其将其保存到软盘的引导扇区并重新启动计算机，不如说是，</font></font></nobr></div>
<div style="position:absolute;top:15957;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以通过运行Bochs方便地测试该程序：</font></font></nobr></div>
<div style="position:absolute;top:15985;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ bochs</font></font></nobr></div>
<div style="position:absolute;top:16011;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，根据我们的偏好和仿真器的可用性，我们可以使用</font></font></nobr></div>
<div style="position:absolute;top:16029;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QEmu，如下：</font></font></nobr></div>
<div style="position:absolute;top:16057;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ qemu引导区</font></font></nobr></div>
<div style="position:absolute;top:16083;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，您可以将映像文件加载到虚拟化软件中或将其写入</font></font></nobr></div>
<div style="position:absolute;top:16101;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到一些可启动媒体上，然后从真实计算机启动它。</font><font style="vertical-align: inherit;">请注意，当您</font></font></nobr></div>
<div style="position:absolute;top:16119;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将映像文件写入一些可引导媒体，这并不意味着您将文件添加到了</font></font></nobr></div>
<div style="position:absolute;top:16136;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介质的文件系统：您必须使用适当的工具直接写入介质</font></font></nobr></div>
<div style="position:absolute;top:16154;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在低级意义上（例如，直接指向磁盘的扇区）。</font></font></nobr></div>
<div style="position:absolute;top:16172;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们想更轻松地准确了解汇编程序创建的字节，则可以运行</font></font></nobr></div>
<div style="position:absolute;top:16190;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下命令，以易于阅读的方式显示文件的二进制内容</font></font></nobr></div>
<div style="position:absolute;top:16208;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">十六进制格式：</font></font></nobr></div>
<div style="position:absolute;top:16236;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ od -t x1 -A n启动sect.bin</font></font></nobr></div>
<div style="position:absolute;top:16262;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该命令的输出应该看起来很熟悉。</font></font></nobr></div>
<div style="position:absolute;top:16280;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">恭喜，您刚刚用汇编语言编写了一个引导扇区。</font><font style="vertical-align: inherit;">如我们所见，</font></font></nobr></div>
<div style="position:absolute;top:16298;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有操作系统都必须以这种方式启动，然后再将自己提升到更高的层次</font></font></nobr></div>
<div style="position:absolute;top:16316;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">抽象（例如，高级语言，例如C / C ++）</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:16581;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="14"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14页</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:16725;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:16746;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:16746;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:16773;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2 16位实模式</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:16816;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU制造商必须竭尽全力来保持其CPU（即特定的CPU）</font></font></nobr></div>
<div style="position:absolute;top:16834;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令集）与较早的CPU兼容，因此较旧的软件，尤其是</font></font></nobr></div>
<div style="position:absolute;top:16852;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">较旧的操作系统，仍然可以在大多数现代CPU上运行。</font></font></nobr></div>
<div style="position:absolute;top:16870;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">英特尔和兼容CPU实施的解决方案是模仿最旧的</font></font></nobr></div>
<div style="position:absolute;top:16887;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">家族中的CPU：Intel 8086，它支持16位指令，并且没有</font></font></nobr></div>
<div style="position:absolute;top:16905;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存保护的概念：内存保护对于现代的稳定性至关重要</font></font></nobr></div>
<div style="position:absolute;top:16923;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统，因为它允许操作系统限制用户的进程</font></font></nobr></div>
<div style="position:absolute;top:16941;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如访问内核内存，无论是偶然还是有意进行，</font></font></nobr></div>
<div style="position:absolute;top:16959;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许这样的过程规避安全机制，甚至破坏整个机制</font></font></nobr></div>
<div style="position:absolute;top:16977;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统。</font></font></nobr></div>
<div style="position:absolute;top:16995;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，为了向后兼容，CPU最初以16位启动很重要</font></font></nobr></div>
<div style="position:absolute;top:17013;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实模式，需要现代操作系统明确切换到更多模式</font></font></nobr></div>
<div style="position:absolute;top:17031;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">先进的32位（或64位）保护模式，但允许较旧的操作系统执行以下操作：</font></font></nobr></div>
<div style="position:absolute;top:17049;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">继续进行，非常高兴地没有意识到它们正在现代CPU上运行。</font><font style="vertical-align: inherit;">稍后，我们将</font></font></nobr></div>
<div style="position:absolute;top:17067;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">详细了解从16位实模式到32位保护模式的这一重要步骤。</font></font></nobr></div>
<div style="position:absolute;top:17085;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常，当我们说CPU是16位时，是指它的指令可以工作</font></font></nobr></div>
<div style="position:absolute;top:17103;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一次最多可包含16位，例如：16位CPU将具有特定的</font></font></nobr></div>
<div style="position:absolute;top:17121;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以在一个CPU周期中将两个16位数字加在一起的指令；</font><font style="vertical-align: inherit;">如果需要的话-</font></font></nobr></div>
<div style="position:absolute;top:17139;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个进程将两个32位数字相加会很麻烦，那么这将需要更多的周期，</font></font></nobr></div>
<div style="position:absolute;top:17156;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用16位加法</font></font></nobr></div>
<div style="position:absolute;top:17174;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们将探索这个16位实模式环境，因为所有操作系统</font></font></nobr></div>
<div style="position:absolute;top:17192;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须从这里开始，那么稍后我们将看到如何切换到32位保护模式，</font></font></nobr></div>
<div style="position:absolute;top:17210;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样做的主要好处。</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:17263;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3 Erm，您好？</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:17306;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们将编写一个看似简单的启动扇区程序，该程序将打印简短的内容。</font></font></nobr></div>
<div style="position:absolute;top:17324;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕上显示消息。</font><font style="vertical-align: inherit;">为此，我们必须学习一些有关如何</font></font></nobr></div>
<div style="position:absolute;top:17342;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU的工作原理以及如何使用BIOS来帮助我们操纵屏幕设备。</font></font></nobr></div>
<div style="position:absolute;top:17360;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，让我们考虑一下我们要在这里做什么。</font><font style="vertical-align: inherit;">我们想打印一个字符</font></font></nobr></div>
<div style="position:absolute;top:17378;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在屏幕上显示，但我们不知道如何与屏幕设备进行通讯，</font></font></nobr></div>
<div style="position:absolute;top:17396;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为可能有很多不同类型的屏幕设备，并且它们可能有不同的</font></font></nobr></div>
<div style="position:absolute;top:17413;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口。</font><font style="vertical-align: inherit;">这就是为什么我们需要使用BIOS的原因，因为BIOS已经完成了一些自动操作</font></font></nobr></div>
<div style="position:absolute;top:17431;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检测硬件，显然是因为BIOS较早打印了信息</font></font></nobr></div>
<div style="position:absolute;top:17449;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕上有关自我测试的信息等等，因此可以为我们提供帮助。</font></font></nobr></div>
<div style="position:absolute;top:17467;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，接下来，我们想让BIOS为我们打印一个字符，但是我们如何询问BIOS</font></font></nobr></div>
<div style="position:absolute;top:17485;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要做到这一点？</font><font style="vertical-align: inherit;">没有Java库可以在屏幕上打印---这是一个梦想</font></font></nobr></div>
<div style="position:absolute;top:17503;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">离开。</font><font style="vertical-align: inherit;">但是，我们可以确定计算机内存中的某个位置</font></font></nobr></div>
<div style="position:absolute;top:17521;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将是一些知道如何写入屏幕的BIOS机器代码。</font><font style="vertical-align: inherit;">事实是</font></font></nobr></div>
<div style="position:absolute;top:17539;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可能会在内存中找到BIOS代码并以某种方式执行它，但这</font></font></nobr></div>
<div style="position:absolute;top:17557;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">麻烦多于其应有的价值，并且在存在差异时会容易出错</font></font></nobr></div>
<div style="position:absolute;top:17575;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在不同计算机上的BIOS例程内部之间。</font></font></nobr></div>
<div style="position:absolute;top:17593;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里，我们可以利用计算机的基本机制：中断。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:17843;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="15"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第15章</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:17987;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:18008;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:18008;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:18037;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3.1中断</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:18072;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中断是一种机制，可以使CPU暂时中止正在执行的操作，并且</font></font></nobr></div>
<div style="position:absolute;top:18090;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回原始任务之前，请运行其他一些更高优先级的指令。</font><font style="vertical-align: inherit;">一个</font></font></nobr></div>
<div style="position:absolute;top:18107;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中断可以通过软件指令（例如</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int 0x10</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）或某些</font><font style="vertical-align: inherit;">方式引发</font></font></nobr></div>
<div style="position:absolute;top:18125;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要高优先级操作的硬件设备（例如，从中读取一些传入数据</font></font></nobr></div>
<div style="position:absolute;top:18143;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络设备）。</font></font></nobr></div>
<div style="position:absolute;top:18161;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个中断都由一个唯一的数字表示，该数字是该中断的索引</font></font></nobr></div>
<div style="position:absolute;top:18179;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向量，BIOS最初在内存起始处（即在物理地址处）建立的表</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:18198;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x0 </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），其中包含指向中断服务程序（ISR）的地址指针。</font><font style="vertical-align: inherit;">一个ISR就是</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:18215;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一系列机器指令，非常类似于我们的引导扇区代码，它处理</font></font></nobr></div>
<div style="position:absolute;top:18233;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定中断（例如，可能从磁盘驱动器或网络读取新数据</font></font></nobr></div>
<div style="position:absolute;top:18251;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卡片）。</font></font></nobr></div>
<div style="position:absolute;top:18269;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，简而言之，BIOS将自己的一些ISR添加到了中断向量中，从而</font></font></nobr></div>
<div style="position:absolute;top:18287;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专攻计算机的某些方面，例如：中断</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导致</font></font></nobr></div>
<div style="position:absolute;top:18305;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与屏幕相关的ISR被调用；</font><font style="vertical-align: inherit;">并中断</font><font style="vertical-align: inherit;">与磁盘相关的I / O ISR </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x13</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:18323;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，为每个BIOS例程分配一个中断很浪费，因此BIOS</font></font></nobr></div>
<div style="position:absolute;top:18341;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常通过基于</font><font style="vertical-align: inherit;">我们可以想象为大</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">切换</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的ISR来复用ISR</font></font></nobr></div>
<div style="position:absolute;top:18358;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">提高</font><font style="vertical-align: inherit;">CPU的通用寄存器之一</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ax中</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置的值</font><font style="vertical-align: inherit;">之前</font></font></nobr></div>
<div style="position:absolute;top:18376;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打断。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:18424;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3.2 CPU寄存器</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:18458;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如我们在高级语言中使用变量一样，如果我们可以存储数据项，这将非常有用。</font></font></nobr></div>
<div style="position:absolute;top:18476;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在特定的例行程序中 </font><font style="vertical-align: inherit;">所有x86 CPU都有四个通用寄存器，</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:18495;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ax </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cx</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dx</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正是出于这个目的。</font><font style="vertical-align: inherit;">而且，这些寄存器可以各自保存</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:18511;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU可以读写一个字（两个字节，16位）的数据，而忽略不计</font></font></nobr></div>
<div style="position:absolute;top:18529;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与访问主内存相比延迟。</font><font style="vertical-align: inherit;">在汇编程序中，</font></font></nobr></div>
<div style="position:absolute;top:18547;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常见的操作是在这些寄存器之间移动（或更准确地说，是复制）数据：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:18577;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机斧</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，1234</font></font></font></nobr></div>
<div style="position:absolute;top:18577;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将十进制数字1234存储在斧头中</font></font></nobr></div>
<div style="position:absolute;top:18591;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov cx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x234</font></font></font></nobr></div>
<div style="position:absolute;top:18591;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将十六进制数0x234存储在cx中</font></font></nobr></div>
<div style="position:absolute;top:18606;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov dx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，'t'</font></font></font></nobr></div>
<div style="position:absolute;top:18606;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将字母“ t”的ASCII代码存储在dx中</font></font></nobr></div>
<div style="position:absolute;top:18620;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV BX </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AX</font></font></nobr></div>
<div style="position:absolute;top:18620;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将ax的值复制到bx，所以现在bx == 1234</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:18652;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，目的地是</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作</font><font style="vertical-align: inherit;">的第一个参数，而不是第二个参数</font><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:18670;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是该约定因不同的汇编器而异。</font></font></nobr></div>
<div style="position:absolute;top:18687;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有时使用单个字节更方便，因此这些寄存器让我们</font></font></nobr></div>
<div style="position:absolute;top:18705;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别设置其高字节和低字节：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:18735;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移动斧头</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0</font></font></font></nobr></div>
<div style="position:absolute;top:18735;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">斧头-&gt; 0x0000，或二进制0000000000000000</font></font></nobr></div>
<div style="position:absolute;top:18750;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ah </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x56</font></font></font></nobr></div>
<div style="position:absolute;top:18750;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">斧头-&gt; 0x5600</font></font></nobr></div>
<div style="position:absolute;top:18764;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV人</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0×23</font></font></font></nobr></div>
<div style="position:absolute;top:18764;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">斧头-&gt; 0x5623</font></font></nobr></div>
<div style="position:absolute;top:18778;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ah </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x16</font></font></font></nobr></div>
<div style="position:absolute;top:18778;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">斧头-&gt; 0x1623</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:18810;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[？]</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:18857;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3.3整合在一起</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:18891;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，回想一下，我们希望BIOS在屏幕上为我们打印一个字符，并且我们</font></font></nobr></div>
<div style="position:absolute;top:18909;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过将</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ax</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">为某些BIOS定义的值</font><font style="vertical-align: inherit;">来调用特定的BIOS例程</font><font style="vertical-align: inherit;">，然后</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:19105;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="16"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16页</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:19249;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:19270;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:19270;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:19304;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">触发特定的中断。</font><font style="vertical-align: inherit;">我们想要的特定例程是BIOS滚动电话-</font></font></nobr></div>
<div style="position:absolute;top:19322;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键入例程，该例程将在屏幕上打印一个字符并向前移动光标，</font></font></nobr></div>
<div style="position:absolute;top:19340;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">准备下一个角色。</font><font style="vertical-align: inherit;">有完整的BIOS例程列表显示</font></font></nobr></div>
<div style="position:absolute;top:19358;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用哪个中断，以及如何在中断之前设置寄存器。</font><font style="vertical-align: inherit;">在这里，我们</font></font></nobr></div>
<div style="position:absolute;top:19376;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要中断</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并将</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ah</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x0e</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（指示远程输入模式），将</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">al</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为</font></font></nobr></div>
<div style="position:absolute;top:19394;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们希望打印的字符的ASCII码。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:19454;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></nobr></div>
<div style="position:absolute;top:19468;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">一个简单的引导扇区，使用BIOS例程将消息打印到屏幕上。</font></font></nobr></div>
<div style="position:absolute;top:19482;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></nobr></div>
<div style="position:absolute;top:19510;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ah </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x0e</font></font></font></nobr></div>
<div style="position:absolute;top:19510;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">int 10 / ah = 0eh-&gt;滚动电传BIOS例程</font></font></nobr></div>
<div style="position:absolute;top:19539;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动词</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'H'</font></font></font></nobr></div>
<div style="position:absolute;top:19553;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:19567;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动词</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'e'</font></font></font></nobr></div>
<div style="position:absolute;top:19581;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:19596;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动词</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'l'</font></font></font></nobr></div>
<div style="position:absolute;top:19610;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:19624;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动词</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'l'</font></font></font></nobr></div>
<div style="position:absolute;top:19638;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:19652;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动词</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'o'</font></font></font></nobr></div>
<div style="position:absolute;top:19667;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:19695;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></font></nobr></div>
<div style="position:absolute;top:19695;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">跳转到当前地址（即永远）。</font></font></nobr></div>
<div style="position:absolute;top:19723;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></nobr></div>
<div style="position:absolute;top:19738;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">填充和魔术BIOS编号。</font></font></nobr></div>
<div style="position:absolute;top:19752;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:19780;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">乘以510-（$-$$）</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0 </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">用零填充引导扇区</font></font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:19808;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xaa55</font></font></font></nobr></div>
<div style="position:absolute;top:19808;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">最后两个字节构成幻数，</font></font></nobr></div>
<div style="position:absolute;top:19823;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">因此BIOS知道我们是引导扇区。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:19892;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图3.2：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:19944;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font><a href="https://translate.googleusercontent.com/translate_f#16"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了整个引导扇区程序。</font><font style="vertical-align: inherit;">请注意，在这种情况下，我们仅</font></font></nobr></div>
<div style="position:absolute;top:19962;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要设置</font><font style="vertical-align: inherit;">一次</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ah</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后只是将</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">al</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改</font><font style="vertical-align: inherit;">为不同的字符。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:20022;left:181"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b4 0e b0 48 cd 10 b0 65 cd 10 b0 6c cd 10 b0 6c</font></font></nobr></div>
<div style="position:absolute;top:20036;left:181"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd 10 b0 6f cd 10 e9 fd ff 00 00 00 00 00 00 00</font></font></nobr></div>
<div style="position:absolute;top:20050;left:181"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</font></font></nobr></div>
<div style="position:absolute;top:20064;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></nobr></div>
<div style="position:absolute;top:20079;left:181"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 55 aa</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:20148;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图3.3：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:20367;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="17"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第17页</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:20511;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:20532;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:20532;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:20566;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅出于完整性考虑，图</font></font><a href="https://translate.googleusercontent.com/translate_f#16"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了该引导扇区的原始机器代码。</font></font></nobr></div>
<div style="position:absolute;top:20584;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些是实际字节，可以告诉CPU确切的操作。</font><font style="vertical-align: inherit;">如果你是</font></font></nobr></div>
<div style="position:absolute;top:20602;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对编写这样的文章所付出的努力和理解感到惊讶</font></font></nobr></div>
<div style="position:absolute;top:20620;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">几乎---如果根本没有---有用的程序，那么请记住，这些说明非常适合</font></font></nobr></div>
<div style="position:absolute;top:20638;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与CPU电路紧密相关，因此它们一定很简单，但也非常快。</font></font></nobr></div>
<div style="position:absolute;top:20656;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您现在已经真正了解了您的计算机。</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:20708;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4您好，世界！</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:20751;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们将尝试使用“ hello”程序的稍微高级的版本，</font></font></nobr></div>
<div style="position:absolute;top:20769;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍了更多的CPU基础知识和对环境的了解</font></font></nobr></div>
<div style="position:absolute;top:20787;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BIOS将我们的引导扇区存储在内存中的数量。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:20834;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.1内存，地址和标签</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:20868;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面我们说过CPU如何从内存中获取并执行指令，以及如何执行</font></font></nobr></div>
<div style="position:absolute;top:20886;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是将我们的512字节启动扇区加载到内存中的BIOS，然后完成了</font></font></nobr></div>
<div style="position:absolute;top:20904;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它的初始化，告诉CPU跳到我们代码的开头，于是它开始了</font></font></nobr></div>
<div style="position:absolute;top:20921;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行我们的第一条指令，然后执行下一条指令，然后执行下一条指令，依此类推。</font></font></nobr></div>
<div style="position:absolute;top:20939;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，我们的引导扇区代码位于内存中的某个位置。</font><font style="vertical-align: inherit;">但是哪里？</font><font style="vertical-align: inherit;">我们可以想象</font></font></nobr></div>
<div style="position:absolute;top:20957;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主存储器为字节的长序列，可以由一个地址单独访问</font></font></nobr></div>
<div style="position:absolute;top:20975;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（即索引），因此，如果我们要找出内存的第54个字节中的内容，则54为</font></font></nobr></div>
<div style="position:absolute;top:20993;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的地址，通常更方便地以十六进制表示：</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x36</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:21011;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，我们的引导扇区代码（第一个机器代码字节）的开头大约是</font></font></nobr></div>
<div style="position:absolute;top:21029;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地址在内存中，而BIOS则将我们带到了那里。</font><font style="vertical-align: inherit;">我们可以假设，除非我们</font></font></nobr></div>
<div style="position:absolute;top:21047;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否则，BIOS就会在内存的起始地址</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x0</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处加载我们的代码</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它的</font></font></nobr></div>
<div style="position:absolute;top:21065;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并不是那么简单，因为我们知道BIOS已经在做</font></font></nobr></div>
<div style="position:absolute;top:21083;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">早在计算机上加载代码之前就在计算机上进行初始化工作，并且实际上</font></font></nobr></div>
<div style="position:absolute;top:21101;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">继续为时钟，磁盘驱动器等提供硬件中断服务。</font><font style="vertical-align: inherit;">所以这些</font></font></nobr></div>
<div style="position:absolute;top:21119;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BIOS例程（例如ISR，丝网印刷服务等）本身必须存储</font></font></nobr></div>
<div style="position:absolute;top:21137;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在内存中的某个位置，并且在存储时必须保留（即不覆盖）</font></font></nobr></div>
<div style="position:absolute;top:21155;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仍在使用。</font><font style="vertical-align: inherit;">此外，我们之前注意到，中断向量位于</font></font></nobr></div>
<div style="position:absolute;top:21172;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存，然后将BIOS加载到那里，我们的代码将遍历表，然后</font></font></nobr></div>
<div style="position:absolute;top:21190;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在发生下一个中断时，计算机可能会崩溃并重新启动：映射</font></font></nobr></div>
<div style="position:absolute;top:21208;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中断号和ISR之间的有效距离将被有效切断。</font></font></nobr></div>
<div style="position:absolute;top:21226;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事实证明，BIOS总是喜欢将引导扇区加载到地址</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7c00</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:21244;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定不会被重要的例程占用的地方。</font><font style="vertical-align: inherit;">图</font></font><a href="https://translate.googleusercontent.com/translate_f#18"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给出了一个例子</font></font></nobr></div>
<div style="position:absolute;top:21262;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的启动扇区刚刚被占用时计算机的典型低内存布局</font></font></nobr></div>
<div style="position:absolute;top:21280;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已加载[？]。</font><font style="vertical-align: inherit;">因此，尽管我们可能指示CPU将数据写入内存中的任何地址，</font></font></nobr></div>
<div style="position:absolute;top:21298;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于其他例程正在使用某些内存，因此可能会导致不良情况的发生，</font></font></nobr></div>
<div style="position:absolute;top:21316;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如计时器中断和磁盘设备。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:21363;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.2'X'标记位置</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:21397;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们将玩一个名为“查找字节”的游戏，该游戏将演示内存</font></font></nobr></div>
<div style="position:absolute;top:21415;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用，汇编代码中标签的使用以及知道在哪里的重要性</font></font></nobr></div>
<div style="position:absolute;top:21433;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BIOS将我们加载到。</font><font style="vertical-align: inherit;">我们将要编写一个汇编程序，该程序保留一个字节的</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:21629;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="18"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第18页</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:21773;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:21794;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:21794;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14</font></font></nobr></div>
<div style="position:absolute;top:22252;left:240"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图3.4：引导后的典型较低内存布局。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:22315;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符的数据，然后我们将尝试在屏幕上打印出该字符。</font><font style="vertical-align: inherit;">去做</font></font></nobr></div>
<div style="position:absolute;top:22333;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们需要找出它的绝对内存地址，以便将其加载到</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">al中</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并获取</font></font></nobr></div>
<div style="position:absolute;top:22351;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">像上一个练习一样，使用BIOS进行打印。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:22410;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></nobr></div>
<div style="position:absolute;top:22424;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">一个简单的引导扇区程序，用于演示寻址。</font></font></nobr></div>
<div style="position:absolute;top:22438;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></nobr></div>
<div style="position:absolute;top:22452;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ah </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x0e</font></font></font></nobr></div>
<div style="position:absolute;top:22452;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">int 10 / ah = 0eh-&gt;滚动电传BIOS例程</font></font></nobr></div>
<div style="position:absolute;top:22481;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">第一次尝试</font></font></nobr></div>
<div style="position:absolute;top:22495;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV人</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，the_secret</font></font></font></nobr></div>
<div style="position:absolute;top:22509;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:22509;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">这会打印X吗？</font></font></nobr></div>
<div style="position:absolute;top:22538;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">第二次尝试</font></font></nobr></div>
<div style="position:absolute;top:22552;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运动</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[the_secret]</font></font></font></nobr></div>
<div style="position:absolute;top:22566;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:22566;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">这会打印X吗？</font></font></nobr></div>
<div style="position:absolute;top:22594;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">第三次尝试</font></font></nobr></div>
<div style="position:absolute;top:22609;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，the_secret</font></font></font></nobr></div>
<div style="position:absolute;top:22623;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x7c00</font></font></font></nobr></div>
<div style="position:absolute;top:22637;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运动</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]</font></font></font></nobr></div>
<div style="position:absolute;top:22651;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:22651;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">这会打印X吗？</font></font></nobr></div>
<div style="position:absolute;top:22680;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">第四次尝试</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:22891;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="19"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第19页</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:23035;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:23056;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:23056;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:23108;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV人</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，[0x7c1e]</font></font></font></nobr></div>
<div style="position:absolute;top:23122;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:23122;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">这会打印X吗？</font></font></nobr></div>
<div style="position:absolute;top:23151;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></font></nobr></div>
<div style="position:absolute;top:23151;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">永远跳。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:23179;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the_secret：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:23193;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ X”</font></font></font></nobr></div>
<div style="position:absolute;top:23222;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">填充和魔术BIOS编号。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:23250;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">倍510-（$-$$）</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:23264;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xaa55</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:23321;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，当我们在程序中声明某些数据时，将在其前面加上标签（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">secret</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></nobr></div>
<div style="position:absolute;top:23339;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以将标签放在程序的任何位置，其唯一目的是给我们一个标签。</font></font></nobr></div>
<div style="position:absolute;top:23357;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从代码开头到特定指令或数据的便捷偏移量。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:23417;left:181"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b4 0e b0 1e cd 10 a0 1e 00 cd 10 bb 1e 00 81 c3</font></font></nobr></div>
<div style="position:absolute;top:23431;left:181"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00 7c 8a 07 cd 10 a0 1e 7c cd 10 e9 fd ff 58 00</font></font></nobr></div>
<div style="position:absolute;top:23445;left:181"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</font></font></nobr></div>
<div style="position:absolute;top:23459;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></nobr></div>
<div style="position:absolute;top:23473;left:181"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 55 aa</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:23542;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图3.5：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:23595;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们看一下图3 </font></font><a href="https://translate.googleusercontent.com/translate_f#19"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的汇编机器代码</font><a href="https://translate.googleusercontent.com/translate_f#19"><font style="vertical-align: inherit;">，</font></a><font style="vertical-align: inherit;">我们可以看到我们的“ X”</font></font></nobr></div>
<div style="position:absolute;top:23613;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其具有十六进制ASCII代码</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x58</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">与十六进制ASCII</font><font style="vertical-align: inherit;">偏移30（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x1e</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）个字节</font></font></nobr></div>
<div style="position:absolute;top:23631;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们以零填充引导扇区之前的代码开始。</font></font></nobr></div>
<div style="position:absolute;top:23649;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果运行该程序，我们将看到仅后两次尝试成功打印</font></font></nobr></div>
<div style="position:absolute;top:23667;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个“ X”。</font></font></nobr></div>
<div style="position:absolute;top:23684;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一次尝试的问题是它尝试将立即偏移量加载到</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:23704;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">al</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为要打印的字符，但实际上我们想在偏移处打印字符</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:23720;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是接下来要尝试的偏移量本身，即方括号指示</font></font></nobr></div>
<div style="position:absolute;top:23738;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU要做这件事-存储地址的内容。</font></font></nobr></div>
<div style="position:absolute;top:23756;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那么，为什么第二次尝试失败了？</font><font style="vertical-align: inherit;">问题是，CPU处理偏移量</font></font></nobr></div>
<div style="position:absolute;top:23774;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">好像是从内存的起始位置开始，而不是从加载的起始地址开始</font></font></nobr></div>
<div style="position:absolute;top:23792;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码，将其放置在中断向量中。</font><font style="vertical-align: inherit;">在第三次尝试中，</font></font></nobr></div>
<div style="position:absolute;top:23810;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将偏移量</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">秘密</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加</font><font style="vertical-align: inherit;">到我们相信BIOS已加载我们地址的地址</font></font></nobr></div>
<div style="position:absolute;top:23828;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7c00</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使用CPU</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加法</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令。</font><font style="vertical-align: inherit;">我们可以认为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是更高的级别</font></font></nobr></div>
<div style="position:absolute;top:23846;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言陈述</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bx = bx + 0x7c00</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">现在我们已经计算出正确的内存</font></font></nobr></div>
<div style="position:absolute;top:23864;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ X”的地址，可以将该地址的内容存储在</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">al中</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以备BIOS</font></font></nobr></div>
<div style="position:absolute;top:23882;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印功能，指令为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov al [bx]</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:23900;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第四次尝试中，我们通过预先计算</font></font></nobr></div>
<div style="position:absolute;top:23918;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引导扇区由BIOS加载到内存后为“ X”。</font><font style="vertical-align: inherit;">我们到达地址</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7c1e</font></font></font></nobr></div>
<div style="position:absolute;top:23936;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据我们之前对二进制代码的检查（参见图</font></font><a href="https://translate.googleusercontent.com/translate_f#19"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），该</font><font style="vertical-align: inherit;">代码</font><font style="vertical-align: inherit;">表明</font></font></nobr></div>
<div style="position:absolute;top:23953;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从启动扇区开始，</font><font style="vertical-align: inherit;">“ X”为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x1e</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（30）字节。</font><font style="vertical-align: inherit;">最后一个例子提醒</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:24153;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="20"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第20话</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:24297;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:24318;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:24318;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:24352;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们为什么标签会很有用，因为没有标签，我们将不得不计算相对于标签的偏移量</font></font></nobr></div>
<div style="position:absolute;top:24370;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编译的代码，然后在代码更改导致这些偏移量更改时更新这些代码。</font></font></nobr></div>
<div style="position:absolute;top:24388;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，现在我们已经了解了BIOS是如何确实将引导扇区加载到该地址的</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:24407;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7c00 </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们还看到了地址和汇编代码标签之间的关系。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:24424;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总是不得不考虑这个标签是不方便的-您的内存偏移量</font></font></nobr></div>
<div style="position:absolute;top:24442;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码，因此如果您包含以下内容，那么许多汇编程序将在汇编过程中更正标签引用</font></font></nobr></div>
<div style="position:absolute;top:24460;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码顶部的以下说明，准确告诉您期望的位置</font></font></nobr></div>
<div style="position:absolute;top:24478;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要加载到内存中的代码：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:24508;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">org</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0x7c00]</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:24559;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:24590;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将这个</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">org</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令添加到该启动后</font><font style="vertical-align: inherit;">，您期望得到的结果将立即打印出来。</font></font></nobr></div>
<div style="position:absolute;top:24608;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部门计划？</font><font style="vertical-align: inherit;">为了获得好成绩，请解释为什么会这样。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:24656;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.3定义字符串</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:24690;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设您要在屏幕上打印预定义的消息（例如“引导操作系统”）</font></font></nobr></div>
<div style="position:absolute;top:24708;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某一点; </font><font style="vertical-align: inherit;">您将如何在汇编程序中定义这样的字符串？</font><font style="vertical-align: inherit;">我们有</font></font></nobr></div>
<div style="position:absolute;top:24726;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提醒自己，我们的计算机对字符串一无所知，并且字符串</font></font></nobr></div>
<div style="position:absolute;top:24744;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只是存储在内存中某处的一系列数据单元（例如字节，字等）。</font></font></nobr></div>
<div style="position:absolute;top:24762;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在汇编器中，我们可以定义一个字符串，如下所示：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:24792;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_string：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:24807;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“启动操作系统”</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:24839;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们实际上已经看过</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它转换为“声明数据的字节”，这表明</font></font></nobr></div>
<div style="position:absolute;top:24857;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇编程序将后续字节直接写到二进制输出文件中（即不要</font></font></nobr></div>
<div style="position:absolute;top:24875;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将其解释为处理器指令）。</font><font style="vertical-align: inherit;">由于我们将数据用引号引起来，</font></font></nobr></div>
<div style="position:absolute;top:24893;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇编器知道将每个字符转换为其ASCII字节码。</font><font style="vertical-align: inherit;">注意，我们</font></font></nobr></div>
<div style="position:absolute;top:24911;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常使用标签（例如</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my string</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）标记数据的开始，否则我们会</font></font></nobr></div>
<div style="position:absolute;top:24929;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的代码中没有简单的方法来引用它。</font></font></nobr></div>
<div style="position:absolute;top:24947;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此示例中我们忽略的一件事是知道字符串多长时间</font></font></nobr></div>
<div style="position:absolute;top:24965;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知道它在哪里同样重要。</font><font style="vertical-align: inherit;">因为是我们必须写所有</font></font></nobr></div>
<div style="position:absolute;top:24983;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理字符串的代码，重要的是要有一个一致的策略来知道如何</font></font></nobr></div>
<div style="position:absolute;top:25001;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">长字符串。</font><font style="vertical-align: inherit;">有几种可能，但是约定是声明字符串</font></font></nobr></div>
<div style="position:absolute;top:25019;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为null终止，这意味着我们始终将字符串的最后一个字节声明为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:25037;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:25067;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_string：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:25082;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'启动OS'，0</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:25114;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当稍后遍历字符串时，也许依次打印其每个字符，我们</font></font></nobr></div>
<div style="position:absolute;top:25132;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以轻松确定何时到达终点。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:25415;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="21"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第21话</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:25559;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:25580;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:25580;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:25609;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.4使用堆栈</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:25644;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在讨论低级计算时，我们经常听到人们谈论堆栈</font></font></nobr></div>
<div style="position:absolute;top:25662;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就像这是一些特别的事情。</font><font style="vertical-align: inherit;">堆栈实际上只是以下内容的简单解决方案</font></font></nobr></div>
<div style="position:absolute;top:25679;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不便之处：CPU的寄存器数量有限，无法临时存储</font></font></nobr></div>
<div style="position:absolute;top:25697;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们例程的局部变量，但是我们经常需要更多的临时存储，</font></font></nobr></div>
<div style="position:absolute;top:25715;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些寄存器；</font><font style="vertical-align: inherit;">现在，我们可以明显地利用主内存，但是要指定特定的</font></font></nobr></div>
<div style="position:absolute;top:25733;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读写不方便时的内存地址，尤其是因为我们不这样做</font></font></nobr></div>
<div style="position:absolute;top:25751;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确切地关心数据的存储位置，只是我们可以很容易地检索它。</font></font></nobr></div>
<div style="position:absolute;top:25769;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而且，正如我们将在后面看到的，堆栈对于传递参数以实现功能也很有用</font></font></nobr></div>
<div style="position:absolute;top:25787;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电话。</font></font></nobr></div>
<div style="position:absolute;top:25805;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，CPU提供了两个指令</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">push</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pop</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，分别允许我们存储</font></font></nobr></div>
<div style="position:absolute;top:25823;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个值并从堆栈的顶部检索一个值，因此不必担心</font></font></nobr></div>
<div style="position:absolute;top:25841;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它们存储的位置。</font><font style="vertical-align: inherit;">但是请注意，我们不能将单个字节压入并弹出</font></font></nobr></div>
<div style="position:absolute;top:25859;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并退出堆栈：在16位模式下，堆栈仅在16位边界上工作。</font></font></nobr></div>
<div style="position:absolute;top:25877;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈由两个特殊的CPU寄存器</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bp</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sp实现</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它们保持</font></font></nobr></div>
<div style="position:absolute;top:25895;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈底部（即堆栈底部）和堆栈顶部的地址。</font></font></nobr></div>
<div style="position:absolute;top:25913;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于堆栈是在将数据推送到其中时扩展的，因此通常将堆栈的底部设置得很远</font></font></nobr></div>
<div style="position:absolute;top:25930;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自内存的重要区域（例如BIOS代码或我们的代码），因此它们不是</font></font></nobr></div>
<div style="position:absolute;top:25948;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果堆栈太大，则有覆盖的危险。</font><font style="vertical-align: inherit;">关于堆栈的一件令人困惑的事情</font></font></nobr></div>
<div style="position:absolute;top:25966;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是它实际上从基本指针向下增长，所以当我们发出</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">push时</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:25984;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该值实际上存储在</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bp</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地址的---而不是---的上方</font><font style="vertical-align: inherit;">，而</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sp</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font></nobr></div>
<div style="position:absolute;top:26002;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按值的大小递减。</font></font></nobr></div>
<div style="position:absolute;top:26020;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font><a href="https://translate.googleusercontent.com/translate_f#22"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.6中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的以下引导扇区程序</font><font style="vertical-align: inherit;">演示了堆栈的用法。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:26065;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题2</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:26096;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font><a href="https://translate.googleusercontent.com/translate_f#22"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6中</font><font style="vertical-align: inherit;">的代码将以什么顺序打印什么</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">而绝对</font></font></nobr></div>
<div style="position:absolute;top:26114;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储器地址是否将存储ASCII字符“ C”？</font><font style="vertical-align: inherit;">您可能会发现修改很有用</font></font></nobr></div>
<div style="position:absolute;top:26132;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该代码可确认您的期望，但请务必解释为什么是此地址。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:26180;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.5控制结构</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:26214;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们不知道如何使用编程语言，我们将永远不会感到自在</font></font></nobr></div>
<div style="position:absolute;top:26232;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写一些基本的控制结构，例如</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if..then..elseif..else</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:26250;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些结构允许执行的替代分支，并构成任何有用的基础</font></font></nobr></div>
<div style="position:absolute;top:26268;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常规。</font></font></nobr></div>
<div style="position:absolute;top:26286;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编译后，这些高级控制结构将简化为简单的跳转状态-</font></font></nobr></div>
<div style="position:absolute;top:26303;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ments。</font><font style="vertical-align: inherit;">实际上，我们已经看到了最简单的循环示例：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:26334;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">some_label：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:26348;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">some_label</font></font></font></nobr></div>
<div style="position:absolute;top:26348;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">跳转到标签地址</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:26381;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，具有相同的效果：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:26412;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></font></nobr></div>
<div style="position:absolute;top:26412;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">跳转到当前指令的地址</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:26445;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，该指令为我们提供了无条件的跳转（即它将始终跳转）。</font><font style="vertical-align: inherit;">但我们</font></font></nobr></div>
<div style="position:absolute;top:26463;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常需要根据某些条件跳转（例如，进行循环直到我们循环</font></font></nobr></div>
<div style="position:absolute;top:26481;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">十次，依此类推）。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:26677;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="22"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22话</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:26821;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:26842;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:26842;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18岁</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:26894;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></nobr></div>
<div style="position:absolute;top:26908;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">一个简单的启动扇区程序，用于演示堆栈。</font></font></nobr></div>
<div style="position:absolute;top:26923;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></nobr></div>
<div style="position:absolute;top:26937;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ah </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x0e</font></font></font></nobr></div>
<div style="position:absolute;top:26937;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">int 10 / ah = 0eh-&gt;滚动电传BIOS例程</font></font></nobr></div>
<div style="position:absolute;top:26965;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov bp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x8000</font></font></font></nobr></div>
<div style="position:absolute;top:26965;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将堆栈的底部设置为高于BIOS的位置</font></font></nobr></div>
<div style="position:absolute;top:26979;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV SP </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> BP</font></font></nobr></div>
<div style="position:absolute;top:26979;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">加载我们的引导扇区-这样就不会覆盖我们。</font></font></nobr></div>
<div style="position:absolute;top:27008;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ A”</font></font></font></nobr></div>
<div style="position:absolute;top:27008;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将某些字符压入堆栈，以备后用</font></font></nobr></div>
<div style="position:absolute;top:27022;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">推</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ B”</font></font></font></nobr></div>
<div style="position:absolute;top:27022;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">复兴。</font></font></nobr></div>
<div style="position:absolute;top:27022;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意，这些按</font></font></nobr></div>
<div style="position:absolute;top:27036;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">推</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ C”</font></font></font></nobr></div>
<div style="position:absolute;top:27036;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">16位值，因此是最高有效字节</font></font></nobr></div>
<div style="position:absolute;top:27050;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将由我们的汇编器添加为0x00。</font></font></nobr></div>
<div style="position:absolute;top:27079;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流行bx</font></font></nobr></div>
<div style="position:absolute;top:27079;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">注意，我们只能弹出16位，所以弹出到bx</font></font></nobr></div>
<div style="position:absolute;top:27093;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV人</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> BL</font></font></nobr></div>
<div style="position:absolute;top:27093;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">然后将bl（即8位字符）复制到al</font></font></nobr></div>
<div style="position:absolute;top:27107;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:27107;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">打印（al）</font></font></nobr></div>
<div style="position:absolute;top:27135;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流行bx</font></font></nobr></div>
<div style="position:absolute;top:27135;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">弹出下一个值</font></font></nobr></div>
<div style="position:absolute;top:27150;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV人</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> BL</font></font></nobr></div>
<div style="position:absolute;top:27164;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:27164;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">打印（al）</font></font></nobr></div>
<div style="position:absolute;top:27192;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV人</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，[0x7ffe]</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">为了证明我们的筹码量从bp向下增长，</font></font></nobr></div>
<div style="position:absolute;top:27206;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">以0x8000-0x2（即16位）的形式获取字符</font></font></nobr></div>
<div style="position:absolute;top:27221;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:27221;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">打印（al）</font></font></nobr></div>
<div style="position:absolute;top:27249;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></font></nobr></div>
<div style="position:absolute;top:27249;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">永远跳。</font></font></nobr></div>
<div style="position:absolute;top:27277;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">填充和魔术BIOS编号。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:27306;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">倍510-（$-$$）</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:27320;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xaa55</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:27389;left:221"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图3.6：使用</font></font><font color="#2b57a3" style="font-size:12px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">推入</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font color="#2b57a3" style="font-size:12px"><font style="vertical-align: inherit;">弹出</font></font><font style="vertical-align: inherit;">操作堆栈</font></font><font color="#2b57a3" style="font-size:12px"><font style="vertical-align: inherit;"></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:27453;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过首先运行比较，可以使用汇编语言实现条件跳转</font></font></nobr></div>
<div style="position:absolute;top:27471;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令，然后发出特定的条件跳转指令。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:27502;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">斧头斧</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，4</font></font></font></nobr></div>
<div style="position:absolute;top:27502;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将ax中的值与4进行比较</font></font></nobr></div>
<div style="position:absolute;top:27516;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">je </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">then_block</font></font></font></nobr></div>
<div style="position:absolute;top:27516;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">如果相等则跳转到then_block</font></font></nobr></div>
<div style="position:absolute;top:27530;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动画bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，45</font></font></font></nobr></div>
<div style="position:absolute;top:27530;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">否则，执行此代码</font></font></nobr></div>
<div style="position:absolute;top:27545;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the_end</font></font></font></nobr></div>
<div style="position:absolute;top:27545;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">重要：跳过“ then”框，</font></font></nobr></div>
<div style="position:absolute;top:27559;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">因此我们也不执行该代码。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:27573;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">then_block：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:27587;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动画bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，23</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:27601;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:27634;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在诸如C或Java的语言中，这看起来像这样：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:27665;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（ax == 4）{</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:27679;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bx = 23;</font></font></nobr></div>
<div style="position:absolute;top:27693;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
<div style="position:absolute;top:27707;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bx = 45;</font></font></nobr></div>
<div style="position:absolute;top:27722;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:27939;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="23"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第23话</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:28083;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:28104;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:28104;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:28138;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从汇编示例中我们可以看到，</font></font></nobr></div>
<div style="position:absolute;top:28156;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmp</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令与</font><font style="vertical-align: inherit;">它进行</font><font style="vertical-align: inherit;">的</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">je</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令</font><font style="vertical-align: inherit;">相关联的场景</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是一</font></font></nobr></div>
<div style="position:absolute;top:28174;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU的特殊</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寄存器用于捕获以下结果的</font><font style="vertical-align: inherit;">示例</font></font></nobr></div>
<div style="position:absolute;top:28192;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMP</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令，因此随后的条件跳转指令能够确定</font></font></nobr></div>
<div style="position:absolute;top:28210;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是否跳转到指定地址。</font></font></nobr></div>
<div style="position:absolute;top:28228;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据先前的</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmp x，y</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令</font><font color="#2b57a3"><font style="vertical-align: inherit;">，</font></font><font style="vertical-align: inherit;">可以使用以下跳转</font><font style="vertical-align: inherit;">说明：</font></font></nobr></div>
<div style="position:absolute;top:28246;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位置：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:28276;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">je</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:28276;left:234"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:28276;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">如果相等则跳</font></font></nobr></div>
<div style="position:absolute;top:28276;left:539"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（即x == y）</font></font></nobr></div>
<div style="position:absolute;top:28290;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JNE</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标</font></font></font></nobr></div>
<div style="position:absolute;top:28290;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">如果不相等则跳</font></font></nobr></div>
<div style="position:absolute;top:28290;left:539"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（即x！= y）</font></font></nobr></div>
<div style="position:absolute;top:28304;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:28304;left:234"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:28304;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">如果小于则跳</font></font></nobr></div>
<div style="position:absolute;top:28304;left:539"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（即x &lt;y）</font></font></nobr></div>
<div style="position:absolute;top:28319;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JLE</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标</font></font></font></nobr></div>
<div style="position:absolute;top:28319;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">小于或等于时跳转</font></font></nobr></div>
<div style="position:absolute;top:28319;left:539"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（即x &lt;= y）</font></font></nobr></div>
<div style="position:absolute;top:28333;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:28333;left:234"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:28333;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">大于则跳</font></font></nobr></div>
<div style="position:absolute;top:28333;left:539"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（即x&gt; y）</font></font></nobr></div>
<div style="position:absolute;top:28347;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JGE</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标</font></font></font></nobr></div>
<div style="position:absolute;top:28347;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">如果大于或等于（即x&gt; = y），则跳转</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:28397;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题3</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:28429;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用高级语言计划条件代码总是很有用的，然后</font></font></nobr></div>
<div style="position:absolute;top:28447;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将其替换为组装说明。</font><font style="vertical-align: inherit;">可以转换此伪程序集</font></font></nobr></div>
<div style="position:absolute;top:28465;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmp</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和适当的跳转指令将</font><font style="vertical-align: inherit;">代码转换为完整的汇编代码</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">用它测试</font></font></nobr></div>
<div style="position:absolute;top:28483;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同的</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bx</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">用您自己的话完全注释您的代码。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:28513;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动画bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，30</font></font></font></nobr></div>
<div style="position:absolute;top:28541;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;= 4）{</font></font></font></nobr></div>
<div style="position:absolute;top:28556;left:234"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电影</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'A'</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:28570;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否则，如果</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bx</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &lt;40）{</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:28584;left:234"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动词</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'B'</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:28598;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:28612;left:234"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动词</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'C'</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:28627;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:28655;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ah </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x0e</font></font></font></nobr></div>
<div style="position:absolute;top:28655;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">int = 10 / ah = 0x0e-&gt; BIOS远程输出</font></font></nobr></div>
<div style="position:absolute;top:28669;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:28669;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在al中打印字符</font></font></nobr></div>
<div style="position:absolute;top:28698;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></font></nobr></div>
<div style="position:absolute;top:28726;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">填充和魔术数字。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:28740;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">倍510-（$-$$）</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:28754;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xaa55</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:28807;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.6调用函数</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:28841;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在高级语言中，我们将大问题分解为函数，这些函数本质上是</font></font></nobr></div>
<div style="position:absolute;top:28859;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是我们使用的通用例程（例如，打印消息，写入文件等）</font></font></nobr></div>
<div style="position:absolute;top:28877;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一遍又一遍地遍历整个程序，通常更改我们传递的参数</font></font></nobr></div>
<div style="position:absolute;top:28895;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能以某种方式改变结果。</font><font style="vertical-align: inherit;">在CPU级别上，一个功能是</font></font></nobr></div>
<div style="position:absolute;top:28913;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无非就是跳到一个有用的例程的地址，然后又跳回到</font></font></nobr></div>
<div style="position:absolute;top:28931;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一次跳转后立即执行该指令。</font></font></nobr></div>
<div style="position:absolute;top:28949;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以像这样模拟一个函数调用：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:28979;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:28994;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:29008;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动词</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'H'</font></font></font></nobr></div>
<div style="position:absolute;top:29008;left:371"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将'H'存储在al中，以便我们的函数将其打印出来。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:29201;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="24"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第24话</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:29345;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:29366;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:29366;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:29403;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_print_function</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:29417;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return_to_here：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:29417;left:371"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">这个标签是我们的生命线，所以我们可以回来。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:29432;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:29446;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:29474;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_print_function：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:29488;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ah </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x0e</font></font></font></nobr></div>
<div style="position:absolute;top:29488;left:371"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">int = 10 / ah = 0x0e-&gt; BIOS远程输出</font></font></nobr></div>
<div style="position:absolute;top:29503;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:29503;left:371"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在al中打印字符</font></font></nobr></div>
<div style="position:absolute;top:29517;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return_to_here</font></font></font></nobr></div>
<div style="position:absolute;top:29517;left:371"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">从函数调用返回。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:29549;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，请注意我们如何</font><font style="vertical-align: inherit;">通过设置</font><font style="vertical-align: inherit;">寄存器</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">al</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为参数来使用它</font></font></nobr></div>
<div style="position:absolute;top:29567;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用的功能。</font><font style="vertical-align: inherit;">这是使参数传递在更高级别上成为可能的方式</font></font></nobr></div>
<div style="position:absolute;top:29585;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言，呼叫者和被呼叫者必须在何处以及如何达成协议</font></font></nobr></div>
<div style="position:absolute;top:29603;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">许多参数将被传递。</font></font></nobr></div>
<div style="position:absolute;top:29621;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可悲的是，这种方法的主要缺陷是我们需要明确说出在何处</font></font></nobr></div>
<div style="position:absolute;top:29639;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在调用我们的函数后返回，因此将无法调用此函数</font></font></nobr></div>
<div style="position:absolute;top:29657;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从程序中的任意点开始执行功能---它将始终返回相同的地址，</font></font></nobr></div>
<div style="position:absolute;top:29675;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，标签</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回到此处</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:29693;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从参数传递思想中借用，调用者代码可以存储正确的</font></font></nobr></div>
<div style="position:absolute;top:29711;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某个知名位置的返回地址（即通话后的地址），</font></font></nobr></div>
<div style="position:absolute;top:29729;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那么被调用的代码可能会跳回到该存储的地址。</font><font style="vertical-align: inherit;">CPU跟踪</font></font></nobr></div>
<div style="position:absolute;top:29747;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前指令正在特殊寄存器</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（指令指针）中执行，</font></font></nobr></div>
<div style="position:absolute;top:29765;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">遗憾的是，我们无法直接访问。</font><font style="vertical-align: inherit;">但是，CPU提供了一对指令，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用</font></font></font></nobr></div>
<div style="position:absolute;top:29783;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ret</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它们正是我们想要的：</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行为类似于</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但除此之外，</font></font></nobr></div>
<div style="position:absolute;top:29801;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际跳跃，将返回地址压入堆栈；</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ret</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后弹出返回</font></font></nobr></div>
<div style="position:absolute;top:29818;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从堆栈中寻址并跳转到堆栈，如下所示：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:29849;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:29863;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:29878;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动词</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'H'</font></font></font></nobr></div>
<div style="position:absolute;top:29878;left:371"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将'H'存储在al中，以便我们的函数将其打印出来。</font></font></nobr></div>
<div style="position:absolute;top:29892;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_print_function</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:29906;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:29920;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:29949;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_print_function：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:29963;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ah </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x0e</font></font></font></nobr></div>
<div style="position:absolute;top:29963;left:371"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">int = 10 / ah = 0x0e-&gt; BIOS远程输出</font></font></nobr></div>
<div style="position:absolute;top:29977;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:29977;left:371"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在al中打印字符</font></font></nobr></div>
<div style="position:absolute;top:29991;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退回</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:30024;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们的功能几乎是独立的，但是仍然存在一个丑陋的问题</font></font></nobr></div>
<div style="position:absolute;top:30042;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们现在麻烦考虑一下，稍后将感谢我们。</font><font style="vertical-align: inherit;">当我们称呼</font></font></nobr></div>
<div style="position:absolute;top:30060;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇编程序内部的函数（例如打印函数）内部</font></font></nobr></div>
<div style="position:absolute;top:30078;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会更改几个寄存器的值以执行其工作（实际上，</font></font></nobr></div>
<div style="position:absolute;top:30096;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">稀缺的资源，几乎可以肯定会做到这一点），所以当我们的程序从</font></font></nobr></div>
<div style="position:absolute;top:30114;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该函数调用可能并不安全，例如，假设我们存储在</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dx中</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">仍然是</font></font></nobr></div>
<div style="position:absolute;top:30132;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那里。</font></font></nobr></div>
<div style="position:absolute;top:30149;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，立即执行某项功能通常是明智的（和礼貌的）</font></font></nobr></div>
<div style="position:absolute;top:30167;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注册它计划更改到堆栈上，然后再次弹出它们（即恢复</font></font></nobr></div>
<div style="position:absolute;top:30185;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寄存器的原始值）返回之前。</font><font style="vertical-align: inherit;">由于一个函数可能会使用许多</font></font></nobr></div>
<div style="position:absolute;top:30203;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在通用寄存器中，CPU实现了两个方便的指令：</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pusha</font></font></font></nobr></div>
<div style="position:absolute;top:30221;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">popa</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，分别方便地将所有寄存器分别从堆栈中压入和弹出，</font></font></nobr></div>
<div style="position:absolute;top:30239;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:30270;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:30463;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="25"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第25话</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:30607;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:30628;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:30628;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21岁</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:30665;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:30694;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">some_function：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:30708;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></nobr></div>
<div style="position:absolute;top:30708;left:371"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将所有寄存器值压入堆栈</font></font></nobr></div>
<div style="position:absolute;top:30722;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动画bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，10</font></font></font></nobr></div>
<div style="position:absolute;top:30736;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，20</font></font></font></nobr></div>
<div style="position:absolute;top:30750;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ah </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x0e</font></font></font></nobr></div>
<div style="position:absolute;top:30750;left:371"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">int = 10 / ah = 0x0e-&gt; BIOS远程输出</font></font></nobr></div>
<div style="position:absolute;top:30765;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:30765;left:371"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在al中打印字符</font></font></nobr></div>
<div style="position:absolute;top:30779;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">波帕</font></font></nobr></div>
<div style="position:absolute;top:30779;left:371"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">恢复原始寄存器值</font></font></nobr></div>
<div style="position:absolute;top:30793;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退回</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:30846;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.7包含文件</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:30880;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">甚至在看似最简单的汇编例程上都放弃了工作之后，您可能会</font></font></nobr></div>
<div style="position:absolute;top:30898;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">想要在多个程序中重用您的代码。</font><font style="vertical-align: inherit;">nasm允许您包含外部文件</font></font></nobr></div>
<div style="position:absolute;top:30916;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从字面上看如下：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:30947;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ my_print_function.asm”</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:30947;left:470"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">这将被替换为</font></font></nobr></div>
<div style="position:absolute;top:30961;left:432"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">文件内容</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:30989;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:31004;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动词</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'H'</font></font></font></nobr></div>
<div style="position:absolute;top:31004;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将'H'存储在al中，以便我们的函数将其打印出来。</font></font></nobr></div>
<div style="position:absolute;top:31018;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_print_function</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:31071;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.8全部放在一起</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:31105;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们对CPU和汇编语言有了足够的了解，可以编写更加复杂的代码-</font></font></nobr></div>
<div style="position:absolute;top:31123;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理了“ Hello，World”引导扇区程序。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:31168;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题4</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:31199;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇集本节中的所有想法，以形成一个自包含的打印功能</font></font></nobr></div>
<div style="position:absolute;top:31217;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空终止的字符串，可以按如下方式使用：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:31271;left:217"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></nobr></div>
<div style="position:absolute;top:31286;left:217"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">使用我们的函数打印字符串的引导扇区。</font></font></nobr></div>
<div style="position:absolute;top:31300;left:217"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:31314;left:217"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">org</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0x7c00]</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:31314;left:332"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">告诉汇编器此代码将在哪里加载</font></font></nobr></div>
<div style="position:absolute;top:31342;left:233"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，HELLO_MSG</font></font></font></nobr></div>
<div style="position:absolute;top:31342;left:385"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">使用BX作为我们函数的参数，因此</font></font></nobr></div>
<div style="position:absolute;top:31357;left:233"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼叫</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_string</font></font></font></nobr></div>
<div style="position:absolute;top:31357;left:385"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">我们可以指定一个字符串的地址。</font></font></nobr></div>
<div style="position:absolute;top:31385;left:233"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，GOODBYE_MSG</font></font></font></nobr></div>
<div style="position:absolute;top:31399;left:233"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼叫</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_string</font></font></font></nobr></div>
<div style="position:absolute;top:31428;left:233"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></font></nobr></div>
<div style="position:absolute;top:31428;left:385"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">悬挂</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:31456;left:217"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ print_string.asm”</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:31484;left:217"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">数据</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:31499;left:218"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HELLO_MSG：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:31513;left:233"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db'Hello </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，World！'，0</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">&lt;-末尾的零告诉我们的常规</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:31725;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="26"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">26页</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:31869;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:31890;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:31890;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:31942;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></nobr></div>
<div style="position:absolute;top:31942;left:446"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何时停止打印字符。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:31956;left:218"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GOODBYE_MSG：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:31971;left:233"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'再见！'，0</font></font></font></nobr></div>
<div style="position:absolute;top:31999;left:217"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">填充和魔术数字。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:32013;left:233"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">倍510-（$-$$）</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:32027;left:233"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xaa55</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:32110;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了获得良好的标记，请确保在修改寄存器时谨慎使用该功能，并且</font></font></nobr></div>
<div style="position:absolute;top:32128;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您完全注释了代码以证明您的理解。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:32175;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.9小结</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:32209;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不过，感觉我们还没有走的很远。</font><font style="vertical-align: inherit;">没关系，这很正常，因为</font></font></nobr></div>
<div style="position:absolute;top:32227;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们一直在工作的原始环境。如果您了解了所有内容，</font></font></nobr></div>
<div style="position:absolute;top:32245;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直到这里，然后我们才能顺利进行。</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:32297;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.5护士，请给我拿我的Steth-o-scope</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:32341;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目前为止，我们已经设法使计算机打印出我们可以输入的字符和字符串</font></font></nobr></div>
<div style="position:absolute;top:32359;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经加载到内存中，但是很快我们将尝试从磁盘加载一些数据，</font></font></nobr></div>
<div style="position:absolute;top:32377;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，如果我们可以显示任意存储的十六进制值，将非常有帮助</font></font></nobr></div>
<div style="position:absolute;top:32395;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存地址，以确认我们是否确实加载了任何内容。</font><font style="vertical-align: inherit;">记住，</font></font></nobr></div>
<div style="position:absolute;top:32412;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们没有出色的开发GUI所提供的奢侈，它带有调试器，该调试器会</font></font></nobr></div>
<div style="position:absolute;top:32430;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们仔细检查并检查我们的代码，并最好地反馈计算机</font></font></nobr></div>
<div style="position:absolute;top:32448;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们犯错时可以给我们明显什么都不做，所以我们需要看一下</font></font></nobr></div>
<div style="position:absolute;top:32466;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追随自己。</font></font></nobr></div>
<div style="position:absolute;top:32484;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们已经编写了一个例程以打印出字符串，因此我们将</font></font></nobr></div>
<div style="position:absolute;top:32502;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在将这个想法扩展到十六进制打印例程中</font></font></nobr></div>
<div style="position:absolute;top:32520;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">珍惜在这个无情的低级世界中。</font></font></nobr></div>
<div style="position:absolute;top:32538;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们仔细考虑我们将如何做到这一点，首先要考虑我们的意愿</font></font></nobr></div>
<div style="position:absolute;top:32556;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用例程。</font><font style="vertical-align: inherit;">在高级语言中，我们想要这样的东西：</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print hex（0x1fb6）</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:32574;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将导致在</font><font style="vertical-align: inherit;">屏幕上打印</font><font style="vertical-align: inherit;">字符串</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ 0x1fb6”</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们已经</font></font></nobr></div>
<div style="position:absolute;top:32592;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第XXX节中看到了如何在汇编中调用函数以及如何使用它们</font></font></nobr></div>
<div style="position:absolute;top:32610;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寄存器作为参数，所以让我们使用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dx</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寄存器作为参数来保存值</font></font></nobr></div>
<div style="position:absolute;top:32628;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">希望我们的print hex函数可以打印：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:32658;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动作dx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x1fb6</font></font></font></nobr></div>
<div style="position:absolute;top:32658;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">存储要在dx中打印的值</font></font></nobr></div>
<div style="position:absolute;top:32673;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致电</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_hex</font></font></font></nobr></div>
<div style="position:absolute;top:32673;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">调用函数</font></font></nobr></div>
<div style="position:absolute;top:32701;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将DX的值打印为十六进制。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:32715;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_hex：</font></font></nobr></div>
<div style="position:absolute;top:32729;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:32744;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:32758;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退回</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:32987;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="27"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第27话</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:33131;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:33152;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:33152;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:33186;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们要在屏幕上打印字符串，因此我们不妨重新使用之前的打印</font></font></nobr></div>
<div style="position:absolute;top:33204;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数来完成实际的打印部分，那么我们的主要任务是看我们如何构建</font></font></nobr></div>
<div style="position:absolute;top:33222;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该字符串来自参数</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dx中</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们绝对不想混淆</font></font></nobr></div>
<div style="position:absolute;top:33240;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在组装时比我们需要的更重要，所以让我们考虑以下内容</font></font></nobr></div>
<div style="position:absolute;top:33258;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们开始使用此功能的技巧。</font><font style="vertical-align: inherit;">如果我们将完整的十六进制字符串定义为</font></font></nobr></div>
<div style="position:absolute;top:33276;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在代码中定义了一种模板变量，因为我们定义了较早的“ Hello，World”消息，</font></font></nobr></div>
<div style="position:absolute;top:33294;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以简单地获取字符串打印功能来打印它，然后执行我们的</font><font color="#2b57a3"><font style="vertical-align: inherit;">十六进制打印</font></font><font style="vertical-align: inherit;">任务</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"></font></font></nobr></div>
<div style="position:absolute;top:33312;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例程是更改模板字符串的成分以反映十六进制</font></font></nobr></div>
<div style="position:absolute;top:33330;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值作为ASCII代码：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:33360;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动作dx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x1fb6</font></font></font></nobr></div>
<div style="position:absolute;top:33360;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">存储要在dx中打印的值</font></font></nobr></div>
<div style="position:absolute;top:33374;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致电</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_hex</font></font></font></nobr></div>
<div style="position:absolute;top:33374;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">调用函数</font></font></nobr></div>
<div style="position:absolute;top:33403;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将DX的值打印为十六进制。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:33417;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_hex：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:33431;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">TODO：在HEX_OUT处操纵字符以反映DX</font></font></nobr></div>
<div style="position:absolute;top:33460;left:219"><nobr><font style="vertical-align: inherit;"><font color="#000000"><font style="vertical-align: inherit;">动画</font></font><font style="vertical-align: inherit;">bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，HEX_OUT</font></font></font></nobr></div>
<div style="position:absolute;top:33460;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">打印指向的字符串</font></font></nobr></div>
<div style="position:absolute;top:33474;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_string</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">由BX</font></font></nobr></div>
<div style="position:absolute;top:33488;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退回</font></font></nobr></div>
<div style="position:absolute;top:33516;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">全局变量</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:33531;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEX_OUT：</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DB</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '0×0000'，0</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:33584;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.5.1问题5（进阶）</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:33618;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印十六进制</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能的实现。</font><font style="vertical-align: inherit;">您可能会发现CPU指令-</font></font></nobr></div>
<div style="position:absolute;top:33636;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蒸发散</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHR</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是有用的，你可以找到互联网上的信息。</font></font></nobr></div>
<div style="position:absolute;top:33654;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确保用自己的话语用注释完全解释您的代码。</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:33706;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.6读取磁盘</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:33749;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们已经介绍了BIOS，并在计算机的</font></font></nobr></div>
<div style="position:absolute;top:33767;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低级环境，但是我们有一个小问题会妨碍我们</font></font></nobr></div>
<div style="position:absolute;top:33785;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计划编写一个操作系统：BIOS从第一个扇区加载了我们的启动代码</font></font></nobr></div>
<div style="position:absolute;top:33803;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘，但仅此而已；</font><font style="vertical-align: inherit;">如果我们的操作系统代码更大，我该怎么办？</font></font></nobr></div>
<div style="position:absolute;top:33821;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">猜测它将是---而不是512个字节。</font></font></nobr></div>
<div style="position:absolute;top:33839;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统通常不适合单个（512字节）扇区，因此第一个是</font></font></nobr></div>
<div style="position:absolute;top:33857;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他们必须做的事情就是将其余的代码从磁盘引导到内存中，然后</font></font></nobr></div>
<div style="position:absolute;top:33875;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后开始执行该代码。</font><font style="vertical-align: inherit;">幸运的是，如前所述，BIOS提供了例程</font></font></nobr></div>
<div style="position:absolute;top:33893;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样我们就可以操作驱动器上的数据。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:33940;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.6.1使用段扩展内存访问</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:33974;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当CPU在其初始16位实模式下运行时，寄存器的最大大小为16</font></font></nobr></div>
<div style="position:absolute;top:33992;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位，这意味着我们可以在一条指令中引用的最高地址是</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xffff</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:34010;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按照当今的标准，这相当于64 KB（65536字节）。</font><font style="vertical-align: inherit;">现在，也许</font></font></nobr></div>
<div style="position:absolute;top:34028;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们预期的简单操作系统之类的对象不受此限制的影响，</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:34249;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="28"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第28页</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:34393;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:34414;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:34414;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:34448;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是日常的操作系统永远无法在如此紧凑的环境中安放下来，因此</font></font></nobr></div>
<div style="position:absolute;top:34466;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重要的是，我们了解针对此问题的细分解决方案。</font></font></nobr></div>
<div style="position:absolute;top:34484;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了解决这个限制，CPU设计人员增加了一些特殊的寄存器，</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:34503;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cs </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ds </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ss</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，称为段寄存器。</font><font style="vertical-align: inherit;">我们可以想象主记忆是</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:34520;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分成由段寄存器索引的段，这样，当我们</font></font></nobr></div>
<div style="position:absolute;top:34538;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定16位地址，CPU会自动将绝对地址计算为</font></font></nobr></div>
<div style="position:absolute;top:34556;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相应段的起始地址，偏移了我们指定的地址[？]。</font><font style="vertical-align: inherit;">通过适当</font></font></nobr></div>
<div style="position:absolute;top:34574;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">段，我的意思是，除非另有明确说明，否则CPU将偏移我们的地址</font></font></nobr></div>
<div style="position:absolute;top:34592;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从段寄存器中适合我们指令的上下文，例如：</font></font></nobr></div>
<div style="position:absolute;top:34609;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ax，[0x45ef]中</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用的地址</font><font style="vertical-align: inherit;">默认情况下会从</font></font></nobr></div>
<div style="position:absolute;top:34627;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据段，由</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ds</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引</font><font style="vertical-align: inherit;">；</font><font style="vertical-align: inherit;">同样，堆栈段</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ss</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于修改</font></font></nobr></div>
<div style="position:absolute;top:34645;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈的基本指针</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bp的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际位置</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:34663;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">段寻址最令人困惑的是相邻段重叠</font></font></nobr></div>
<div style="position:absolute;top:34681;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">几乎完全，但是只有16个字节，因此不同的段和偏移量组合可以</font></font></nobr></div>
<div style="position:absolute;top:34699;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际上指向相同的物理地址；</font><font style="vertical-align: inherit;">但是足够多的话题：我们不会真正做到</font></font></nobr></div>
<div style="position:absolute;top:34717;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">掌握这个概念，直到我们看到一些示例。</font></font></nobr></div>
<div style="position:absolute;top:34735;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了计算绝对地址，CPU将段寄存器中的值乘以</font></font></nobr></div>
<div style="position:absolute;top:34753;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">乘以16，然后加上您的抵销地址；</font><font style="vertical-align: inherit;">因为我们正在使用十六进制，</font></font></nobr></div>
<div style="position:absolute;top:34771;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们将数字乘以16时，我们只需将数字向左移动（例如</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x42</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * 16</font></font></nobr></div>
<div style="position:absolute;top:34789;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x420</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">因此，如果我们将</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ds</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x4d</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后发出</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ax，[0x20]</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">，则</font></font></nobr></div>
<div style="position:absolute;top:34807;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ax中的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">实际上将从地址</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x4d0</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（16 * </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x4d</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x20</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">加载</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:34825;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font><a href="https://translate.googleusercontent.com/translate_f#29"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了如何设置</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ds</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以实现标签寻址的类似校正</font></font></nobr></div>
<div style="position:absolute;top:34843;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就像我们</font><font style="vertical-align: inherit;">在XXX节中</font><font style="vertical-align: inherit;">使用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[org 0x7c00]</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令时一样。</font><font style="vertical-align: inherit;">因为我们不使用</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:34862;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">org</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令，汇编程序不会将标签偏移到正确的内存位置</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:34878;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当代码由BIOS加载到地址</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7c00时</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此第一次尝试打印</font></font></nobr></div>
<div style="position:absolute;top:34896;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ X”将失败。</font><font style="vertical-align: inherit;">但是，如果将数据段寄存器设置为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7c0</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则CPU将执行此操作</font></font></nobr></div>
<div style="position:absolute;top:34914;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的偏移量（即</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7c0</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * 16 +</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机密</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），因此第二次尝试将正确进行</font></font></nobr></div>
<div style="position:absolute;top:34932;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印“ X”。</font><font style="vertical-align: inherit;">在第三次和第四次尝试中，我们进行相同的操作并获得相同的结果，</font></font></nobr></div>
<div style="position:absolute;top:34950;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但改为向CPU明确指出要在计算时使用哪个段寄存器</font></font></nobr></div>
<div style="position:absolute;top:34968;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物理地址，改为使用通用段寄存器</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:34986;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，CPU电路的局限性（至少在16位实模式下）显示</font></font></nobr></div>
<div style="position:absolute;top:35004;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里，当</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ds，0x1234</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等看似正确的指令</font><font style="vertical-align: inherit;">不起作用时，</font></font></nobr></div>
<div style="position:absolute;top:35022;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">盟友可能：仅仅因为我们可以将文字地址直接存储为通用地址</font></font></nobr></div>
<div style="position:absolute;top:35040;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注册（例如</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ax，0x1234</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov cx，0xdf</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），这并不意味着我们可以做同样的事情</font></font></nobr></div>
<div style="position:absolute;top:35058;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有每种类型的寄存器，例如段寄存器；</font><font style="vertical-align: inherit;">因此，如图</font></font><a href="https://translate.googleusercontent.com/translate_f#29"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所示</font><font style="vertical-align: inherit;">，我们必须</font></font></nobr></div>
<div style="position:absolute;top:35076;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">采取额外的步骤，通过通用寄存器传输值。</font></font></nobr></div>
<div style="position:absolute;top:35094;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，基于段的寻址使我们可以深入内存，最多可以</font></font></nobr></div>
<div style="position:absolute;top:35112;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超过1 MB（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xffff</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * 16 + </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xffff</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">稍后，我们将看到如何访问更多的内存，</font></font></nobr></div>
<div style="position:absolute;top:35130;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们切换到32位保护模式时，但就目前而言，我们已经足够了解</font></font></nobr></div>
<div style="position:absolute;top:35147;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16位实模式基于段的寻址。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:35195;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.6.2磁盘驱动器如何工作</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:35229;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从机械上讲，硬盘驱动器包含一个或多个在磁盘下旋转的堆叠盘片。</font></font></nobr></div>
<div style="position:absolute;top:35247;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读/写磁头，就像旧的电唱机一样，只是潜在地增加了容量，</font></font></nobr></div>
<div style="position:absolute;top:35265;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有几条记录，一个在另一个之上，一个头在进出</font></font></nobr></div>
<div style="position:absolute;top:35283;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">覆盖特定旋转盘的整个表面；</font><font style="vertical-align: inherit;">并且由于特定</font></font></nobr></div>
<div style="position:absolute;top:35301;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">盘片的两个表面都可以读取和写入，一个读/写头可以</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:35511;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="29"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第29话</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:35655;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:35676;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:35676;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:35728;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></nobr></div>
<div style="position:absolute;top:35742;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">一个简单的引导扇区程序，演示了段偏移</font></font></nobr></div>
<div style="position:absolute;top:35757;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></nobr></div>
<div style="position:absolute;top:35771;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ah </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x0e</font></font></font></nobr></div>
<div style="position:absolute;top:35771;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">int 10 / ah = 0eh-&gt;滚动电传BIOS例程</font></font></nobr></div>
<div style="position:absolute;top:35799;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运动</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[the_secret]</font></font></font></nobr></div>
<div style="position:absolute;top:35813;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:35813;left:372"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">这会打印X吗？</font></font></nobr></div>
<div style="position:absolute;top:35842;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x7c0</font></font></font></nobr></div>
<div style="position:absolute;top:35842;left:372"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">无法直接设置ds，因此设置bx</font></font></nobr></div>
<div style="position:absolute;top:35856;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV DS </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> BX</font></font></nobr></div>
<div style="position:absolute;top:35856;left:372"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">然后将bx复制到ds。</font></font></nobr></div>
<div style="position:absolute;top:35870;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运动</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[the_secret]</font></font></font></nobr></div>
<div style="position:absolute;top:35884;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:35884;left:372"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">这会打印X吗？</font></font></nobr></div>
<div style="position:absolute;top:35913;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，[</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：the_secret]</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">告诉CPU使用es（不是ds）段。</font></font></nobr></div>
<div style="position:absolute;top:35927;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:35927;left:372"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">这会打印X吗？</font></font></nobr></div>
<div style="position:absolute;top:35955;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x7c0</font></font></font></nobr></div>
<div style="position:absolute;top:35969;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV ES </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> BX</font></font></nobr></div>
<div style="position:absolute;top:35984;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运动</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：the_secret]</font></font></font></nobr></div>
<div style="position:absolute;top:35998;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font></nobr></div>
<div style="position:absolute;top:35998;left:372"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">这会打印X吗？</font></font></nobr></div>
<div style="position:absolute;top:36026;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></font></nobr></div>
<div style="position:absolute;top:36026;left:372"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">永远跳。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:36055;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the_secret：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:36069;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ X”</font></font></font></nobr></div>
<div style="position:absolute;top:36097;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">填充和魔术BIOS编号。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:36111;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">倍510-（$-$$）</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:36126;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xaa55</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:36195;left:196"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图3.7：使用</font></font><font color="#2b57a3" style="font-size:12px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ds</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寄存器</font><font style="vertical-align: inherit;">操作数据段</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:36257;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浮在上面，另一个在下面。</font><font style="vertical-align: inherit;">图3 </font></font><a href="https://translate.googleusercontent.com/translate_f#30"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.8</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了典型硬盘的内部</font></font></nobr></div>
<div style="position:absolute;top:36275;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动器，并露出一堆盘片和磁头。</font><font style="vertical-align: inherit;">请注意，同样的想法适用于</font></font></nobr></div>
<div style="position:absolute;top:36293;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">软盘驱动器，通常没有一个，而不是几个堆叠的硬盘，</font></font></nobr></div>
<div style="position:absolute;top:36311;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">双面软盘介质。</font></font></nobr></div>
<div style="position:absolute;top:36329;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">盘子的金属涂层使它们具有其特定区域的特性</font></font></nobr></div>
<div style="position:absolute;top:36347;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表面可以被磁头磁化或消磁，有效地允许任何状态</font></font></nobr></div>
<div style="position:absolute;top:36365;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">永久地记录在它们上[？]。</font><font style="vertical-align: inherit;">因此，重要的是要能够描述</font></font></nobr></div>
<div style="position:absolute;top:36383;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘表面上要读取或写入某些状态的确切位置，以及</font></font></nobr></div>
<div style="position:absolute;top:36401;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此使用的是圆柱头扇区（CHS）寻址，实际上是3D坐标</font></font></nobr></div>
<div style="position:absolute;top:36419;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统（见图</font></font><a href="https://translate.googleusercontent.com/translate_f#30"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.9）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></nobr></div>
<div style="position:absolute;top:36444;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•圆柱体：圆柱体描述了磁头到外边缘的离散距离</font></font></nobr></div>
<div style="position:absolute;top:36463;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之所以这样命名，是因为当几个盘子堆叠在一起时，您会</font></font></nobr></div>
<div style="position:absolute;top:36481;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以看到所有的头部都通过所有的盘子选择了一个圆柱体</font></font></nobr></div>
<div style="position:absolute;top:36506;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•头：头描述了哪个轨道（即，其中哪个特定的拼盘表面</font></font></nobr></div>
<div style="position:absolute;top:36525;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缸）我们感兴趣的。</font></font></nobr></div>
<div style="position:absolute;top:36550;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•扇区：循环磁道分为多个扇区，通常容量为512字节，</font></font></nobr></div>
<div style="position:absolute;top:36569;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以用扇区索引引用。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:36773;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="30"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第30话</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:36917;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:36938;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:36938;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">26</font></font></nobr></div>
<div style="position:absolute;top:37304;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图3.8：硬盘驱动器内部</font></font></nobr></div>
<div style="position:absolute;top:37793;left:212"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图3.9：圆柱体，磁头，硬盘的扇区结构。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:38035;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="31"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第31章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:38179;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:38200;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:38200;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">27</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:38229;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.6.3使用BIOS读取磁盘</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:38264;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">稍后我们将看到，特定的设备需要编写特定的例程</font></font></nobr></div>
<div style="position:absolute;top:38282;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用它们，例如，软盘设备需要我们显式打开并</font></font></nobr></div>
<div style="position:absolute;top:38299;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在使用磁盘之前，请先关闭使磁盘旋转的读写头下方的马达，</font></font></nobr></div>
<div style="position:absolute;top:38317;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而大多数硬盘设备具有在本地芯片上自动执行的更多功能[？]，但是</font></font></nobr></div>
<div style="position:absolute;top:38335;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次将此类设备用于连接到CPU的总线技术（例如ATA / IDE，</font></font></nobr></div>
<div style="position:absolute;top:38353;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SATA，SCSI，USB等）会影响我们访问它们的方式。</font><font style="vertical-align: inherit;">值得庆幸的是，BIOS可以提供​​一些</font></font></nobr></div>
<div style="position:absolute;top:38371;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘例程为通用磁盘设备抽象了所有这些差异。</font></font></nobr></div>
<div style="position:absolute;top:38389;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在此处感兴趣的特定BIOS例程可通过引发中断来访问</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:38408;left:159"><nobr><font style="vertical-align: inherit;"></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将寄存器</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">al</font><font color="#000000"><font style="vertical-align: inherit;">设置</font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x02</font><font color="#000000"><font style="vertical-align: inherit;">后为</font></font><font style="vertical-align: inherit;">0x13 </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此BIOS例程要求我们设置一些</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:38425;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他寄存器，其中包含要使用的磁盘设备，我们希望读取的块的详细信息</font></font></nobr></div>
<div style="position:absolute;top:38443;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从磁盘以及将块存储在内存中的位置。</font><font style="vertical-align: inherit;">使用中最困难的部分</font></font></nobr></div>
<div style="position:absolute;top:38461;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个例程是，我们必须使用CHS寻址指定要读取的第一个块</font></font></nobr></div>
<div style="position:absolute;top:38479;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方案; </font><font style="vertical-align: inherit;">否则，这只是填写预期寄存器的一种情况，如</font></font></nobr></div>
<div style="position:absolute;top:38497;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个代码段。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:38527;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ah </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x02</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">BIOS读取扇区功能</font></font></nobr></div>
<div style="position:absolute;top:38556;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动作dl </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0</font></font></font></nobr></div>
<div style="position:absolute;top:38556;left:302"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">读取驱动器0（即第一个软盘驱动器）</font></font></nobr></div>
<div style="position:absolute;top:38570;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运动</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></font></nobr></div>
<div style="position:absolute;top:38570;left:302"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">选择气缸3</font></font></nobr></div>
<div style="position:absolute;top:38584;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移动硬盘</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></font></nobr></div>
<div style="position:absolute;top:38584;left:302"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">选择软盘第二面的轨道</font></font></nobr></div>
<div style="position:absolute;top:38598;left:302"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">磁盘，因为此计数的底数为0</font></font></nobr></div>
<div style="position:absolute;top:38613;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运动类</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，4</font></font></font></nobr></div>
<div style="position:absolute;top:38613;left:302"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">选择赛道上的第4个扇区-不</font></font></nobr></div>
<div style="position:absolute;top:38627;left:302"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">第五，因为它的底数是1。</font></font></nobr></div>
<div style="position:absolute;top:38641;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电影</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></font></nobr></div>
<div style="position:absolute;top:38641;left:302"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">从起点开始读取5个扇区</font></font></nobr></div>
<div style="position:absolute;top:38669;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">最后，设置我们希望BIOS读取的地址。</font></font></nobr></div>
<div style="position:absolute;top:38684;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">BIOS期望在ES：BX中找到的扇区</font></font></nobr></div>
<div style="position:absolute;top:38698;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">（即，具有偏移BX的段ES）。</font></font></nobr></div>
<div style="position:absolute;top:38712;left:204"><nobr><font style="vertical-align: inherit;"><font color="#000000"><font style="vertical-align: inherit;">动画</font></font><font style="vertical-align: inherit;">bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0xa000</font></font></font></nobr></div>
<div style="position:absolute;top:38712;left:325"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">间接将ES设置为0xa000</font></font></nobr></div>
<div style="position:absolute;top:38726;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV ES </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> BX</font></font></nobr></div>
<div style="position:absolute;top:38740;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x1234</font></font></font></nobr></div>
<div style="position:absolute;top:38740;left:325"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将BX设置为0x1234</font></font></nobr></div>
<div style="position:absolute;top:38755;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在我们的情况下，数据将读取为0xa000：0x1234，</font></font></nobr></div>
<div style="position:absolute;top:38769;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">CPU将转换为物理地址0xa1234</font></font></nobr></div>
<div style="position:absolute;top:38797;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x13</font></font></font></nobr></div>
<div style="position:absolute;top:38797;left:302"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">现在发出BIOS中断以进行实际读取。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:38830;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，出于一个或另一个原因（例如，我们索引了超出最大限制的扇区）</font></font></nobr></div>
<div style="position:absolute;top:38848;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘，试图读取有故障的扇区，未将软盘插入</font></font></nobr></div>
<div style="position:absolute;top:38866;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动器等），BIOS可能无法为我们读取磁盘，因此了解如何操作非常重要</font></font></nobr></div>
<div style="position:absolute;top:38884;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发现这一点；</font><font style="vertical-align: inherit;">否则，我们可能会认为我们已经读取了一些数据，但实际上目标是</font></font></nobr></div>
<div style="position:absolute;top:38902;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该地址仅包含与我们发出读取命令之前相同的随机字节。</font></font></nobr></div>
<div style="position:absolute;top:38920;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对我们来说幸运的是，BIOS更新了一些寄存器以使我们知道发生了什么：进位</font></font></nobr></div>
<div style="position:absolute;top:38938;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特殊</font><font color="#2b57a3"><font style="vertical-align: inherit;">标志</font></font><font style="vertical-align: inherit;">寄存器的</font><font style="vertical-align: inherit;">标志（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CF</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">设置为发出一般故障信号，而</font><font color="#2b57a3"><font style="vertical-align: inherit;">al</font></font><font style="vertical-align: inherit;">设置为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><font color="#2b57a3"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:38955;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际读取的扇区数，而不是请求的数目。</font><font style="vertical-align: inherit;">发行后</font></font></nobr></div>
<div style="position:absolute;top:38973;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于BIOS磁盘读取中断，我们可以执行以下简单检查：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:39004;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:39018;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:39033;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x13</font></font></font></nobr></div>
<div style="position:absolute;top:39033;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">发出BIOS中断以进行实际读取。</font></font></nobr></div>
<div style="position:absolute;top:39061;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jc </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disk_error</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">jc是另一个跳转指令，它会跳转</font></font></nobr></div>
<div style="position:absolute;top:39075;left:325"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">仅当设置了进位标志时。</font></font></nobr></div>
<div style="position:absolute;top:39104;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">如果BIOS报告为扇区数，则此值会跳转</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:39297;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="32"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第32话</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:39441;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:39462;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:39462;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">28岁</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:39499;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">实际读入的AL不等于我们期望的数字。</font></font></nobr></div>
<div style="position:absolute;top:39513;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmp al </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，&lt;否。</font><font style="vertical-align: inherit;">预期行业&gt;</font></font></font></nobr></div>
<div style="position:absolute;top:39528;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jne </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disk_error</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:39556;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disk_error：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:39570;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，DISK_ERROR_MSG</font></font></font></nobr></div>
<div style="position:absolute;top:39584;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼叫</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_string</font></font></font></nobr></div>
<div style="position:absolute;top:39599;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></font></nobr></div>
<div style="position:absolute;top:39627;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">全局变量</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:39641;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DISK_ERROR_MSG：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:39641;left:333"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“磁盘读取错误！”，0</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:39694;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.6.4全部放在一起</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:39729;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如前所述，能够从磁盘读取更多数据对于启动-</font></font></nobr></div>
<div style="position:absolute;top:39746;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">捆绑我们的操作系统，因此在这里，我们将把本节中的所有想法放入</font></font></nobr></div>
<div style="position:absolute;top:39764;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个有用的例程，它将简单地从中读取引导扇区之后的前n个扇区</font></font></nobr></div>
<div style="position:absolute;top:39782;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定的磁盘设备。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:39842;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将DH扇区从驱动器DL加载到ES：BX</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:39856;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disk_load：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:39870;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">推DX</font></font></nobr></div>
<div style="position:absolute;top:39870;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将DX存储在堆栈中，以便以后我们可以回想起</font></font></nobr></div>
<div style="position:absolute;top:39884;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">要求读取多少个扇区，</font></font></nobr></div>
<div style="position:absolute;top:39899;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">即使与此同时更改</font></font></nobr></div>
<div style="position:absolute;top:39913;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ah </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x02</font></font></font></nobr></div>
<div style="position:absolute;top:39913;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">BIOS读取扇区功能</font></font></nobr></div>
<div style="position:absolute;top:39927;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV人</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DH</font></font></nobr></div>
<div style="position:absolute;top:39927;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">读取DH扇区</font></font></nobr></div>
<div style="position:absolute;top:39941;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移动通道</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x00</font></font></font></nobr></div>
<div style="position:absolute;top:39941;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">选择汽缸0</font></font></nobr></div>
<div style="position:absolute;top:39955;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动作dh </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x00</font></font></font></nobr></div>
<div style="position:absolute;top:39955;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">选择头0</font></font></nobr></div>
<div style="position:absolute;top:39969;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动画</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x02</font></font></font></nobr></div>
<div style="position:absolute;top:39969;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">从第二部分开始阅读（即</font></font></nobr></div>
<div style="position:absolute;top:39984;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在引导扇区之后）</font></font></nobr></div>
<div style="position:absolute;top:39998;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x13</font></font></font></nobr></div>
<div style="position:absolute;top:39998;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">BIOS中断</font></font></nobr></div>
<div style="position:absolute;top:40026;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jc </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disk_error</font></font></font></nobr></div>
<div style="position:absolute;top:40026;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">发生错误时跳转（即设置进位标志）</font></font></nobr></div>
<div style="position:absolute;top:40055;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流行dx</font></font></nobr></div>
<div style="position:absolute;top:40055;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">从堆栈还原DX</font></font></nobr></div>
<div style="position:absolute;top:40069;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMP DH </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">人</font></font></nobr></div>
<div style="position:absolute;top:40069;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">如果AL（读取的扇区）！= DH（预期的扇区）</font></font></nobr></div>
<div style="position:absolute;top:40083;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jne </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disk_error</font></font></font></nobr></div>
<div style="position:absolute;top:40083;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></nobr></div>
<div style="position:absolute;top:40083;left:342"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示错误信息</font></font></nobr></div>
<div style="position:absolute;top:40097;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退回</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:40126;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disk_error：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:40154;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，DISK_ERROR_MSG</font></font></font></nobr></div>
<div style="position:absolute;top:40168;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼叫</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_string</font></font></font></nobr></div>
<div style="position:absolute;top:40182;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></font></nobr></div>
<div style="position:absolute;top:40211;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">变数</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:40225;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DISK_ERROR_MSG</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:40225;left:296"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“磁盘读取错误！”，0</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:40282;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了测试该例程，我们可以编写一个启动扇区程序，如下所示：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:40559;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="33"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第33章</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:40703;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章引导程序编程（16位实数）</font></font></nobr></div>
<div style="position:absolute;top:40724;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式）</font></font></nobr></div>
<div style="position:absolute;top:40724;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">29</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:40776;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">使用disk_read函数从启动磁盘读取一些扇区</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:40790;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">org</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0x7c00]</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:40819;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[BOOT_DRIVE]，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dl; </font><font style="vertical-align: inherit;">BIOS将我们的启动驱动器存储在DL中，因此</font></font></nobr></div>
<div style="position:absolute;top:40833;left:349"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">最好记住这一点以备后用。</font></font></nobr></div>
<div style="position:absolute;top:40861;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov bp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x8000</font></font></font></nobr></div>
<div style="position:absolute;top:40861;left:349"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在这里，我们安全地将堆栈设置为</font></font></nobr></div>
<div style="position:absolute;top:40876;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV SP </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> BP</font></font></nobr></div>
<div style="position:absolute;top:40876;left:349"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">方式，在0x8000</font></font></nobr></div>
<div style="position:absolute;top:40904;left:189"><nobr><font style="vertical-align: inherit;"><font color="#000000"><font style="vertical-align: inherit;">动画</font></font><font style="vertical-align: inherit;">bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x9000</font></font></font></nobr></div>
<div style="position:absolute;top:40904;left:349"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将5个扇区加载到0x0000（ES）：0x9000（BX）</font></font></nobr></div>
<div style="position:absolute;top:40918;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移动硬盘</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></font></nobr></div>
<div style="position:absolute;top:40918;left:349"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">从启动盘。</font></font></nobr></div>
<div style="position:absolute;top:40932;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov dl </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，[BOOT_DRIVE]</font></font></font></nobr></div>
<div style="position:absolute;top:40947;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼叫</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disk_load</font></font></font></nobr></div>
<div style="position:absolute;top:40975;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov dx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，[0x9000]</font></font></font></nobr></div>
<div style="position:absolute;top:40975;left:349"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">打印出第一个加载的单词</font></font></nobr></div>
<div style="position:absolute;top:40989;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致电</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_hex</font></font></font></nobr></div>
<div style="position:absolute;top:40989;left:349"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">我们期望是0xdada，已存储</font></font></nobr></div>
<div style="position:absolute;top:41003;left:349"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在地址0x9000</font></font></nobr></div>
<div style="position:absolute;top:41032;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov dx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，[0x9000 + 512]</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">；</font><font style="vertical-align: inherit;">此外，从</font></font></nobr></div>
<div style="position:absolute;top:41046;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致电</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_hex</font></font></font></nobr></div>
<div style="position:absolute;top:41046;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">第2个加载扇区：应为0xface</font></font></nobr></div>
<div style="position:absolute;top:41074;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:41103;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ ../print/print_string.asm” </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">重用我们的print_string函数</font></font></font></nobr></div>
<div style="position:absolute;top:41117;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ ../hex/print_hex.asm”</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:41117;left:455"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">重新使用我们的print_hex函数</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:41131;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ disk_load.asm”</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:41145;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">包括我们新的disk_load函数</font></font></nobr></div>
<div style="position:absolute;top:41174;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">全局变量</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:41188;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BOOT_DRIVE：</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:41216;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">引导区填充</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:41230;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">倍510-（$-$$）</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:41245;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xaa55</font></font></font></nobr></div>
<div style="position:absolute;top:41273;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">我们知道BIOS只会从磁盘加载第一个512字节的扇区，</font></font></nobr></div>
<div style="position:absolute;top:41287;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">因此，如果我们有意地通过重复一些代码来向我们的代码中添加更多的扇区</font></font></nobr></div>
<div style="position:absolute;top:41301;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">熟悉的数字，我们可以向自己证明我们实际上已经加载了这些</font></font></nobr></div>
<div style="position:absolute;top:41316;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">我们从中引导的磁盘中的另外两个扇区。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:41330;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">倍256 </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0xdada</font></font></nobr></div>
<div style="position:absolute;top:41344;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间256 </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0xface</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:41821;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="34"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第34页</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:42132;left:389"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">章</font></font><font style="font-size:35px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></font></nobr></div>
</span></font>
<font size="5" color="#2b57a3" face="Times"><span style="font-size:35px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:42209;left:170"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进入32位保护模式</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:42324;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最好继续以我们现在使用的16位实模式工作</font></font></nobr></div>
<div style="position:absolute;top:42342;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变得更好了，但是为了更充分地利用CPU，并</font></font></nobr></div>
<div style="position:absolute;top:42360;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更好地了解CPU体系结构的开发如何使现代操作受益</font></font></nobr></div>
<div style="position:absolute;top:42378;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统，即硬件中的内存保护，那么我们必须继续使用32位</font></font></nobr></div>
<div style="position:absolute;top:42396;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保护模式。</font></font></nobr></div>
<div style="position:absolute;top:42414;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32位保护模式下的主要区别是：</font></font></nobr></div>
<div style="position:absolute;top:42440;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•寄存器扩展到32位，其全部容量可通过预寄存器访问。</font></font></nobr></div>
<div style="position:absolute;top:42459;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">固定</font><font style="vertical-align: inherit;">为寄存器名称，例如：</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ebx，0x274fe8fe</font></font></font></nobr></div>
<div style="position:absolute;top:42485;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•为方便起见，还有两个附加的通用段寄存器</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fs</font></font></font></nobr></div>
<div style="position:absolute;top:42504;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gs</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:42530;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•32位内存偏移量可用，因此偏移量可以引用高达4 GB的内存</font></font></nobr></div>
<div style="position:absolute;top:42549;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xffffffff</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></nobr></div>
<div style="position:absolute;top:42575;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•CPU支持更复杂的---尽管稍微复杂一些-</font></font></nobr></div>
<div style="position:absolute;top:42593;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存分段的方法，具有两个主要优点：</font></font></nobr></div>
<div style="position:absolute;top:42623;left:224"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">–可以禁止某一段中的代码以更高特权执行代码。</font></font></nobr></div>
<div style="position:absolute;top:42641;left:241"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隔离段，因此您可以保护内核代码免受用户应用程序的攻击</font></font></nobr></div>
<div style="position:absolute;top:42666;left:224"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">– CPU可以为用户进程实现虚拟内存，例如页面</font></font></nobr></div>
<div style="position:absolute;top:42684;left:241"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（即固定大小的块）可以透明地交换进程的内存</font></font></nobr></div>
<div style="position:absolute;top:42702;left:241"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要在磁盘和内存之间进行切换。</font><font style="vertical-align: inherit;">这确保主要</font></font></nobr></div>
<div style="position:absolute;top:42720;left:241"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效地使用内存，因为很少执行的代码或数据</font></font></nobr></div>
<div style="position:absolute;top:42738;left:241"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不必浪费宝贵的记忆。</font></font></nobr></div>
<div style="position:absolute;top:42767;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•中断处理也更加复杂。</font></font></nobr></div>
<div style="position:absolute;top:42794;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[？]</font></font></nobr></div>
<div style="position:absolute;top:42812;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将CPU从16位实模式切换到32位最困难的部分</font></font></nobr></div>
<div style="position:absolute;top:42830;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保护模式是我们必须在内存中准备一个复杂的数据结构，称为</font></font></nobr></div>
<div style="position:absolute;top:42848;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全局描述符表（GDT），用于定义内存段及其保护模式</font></font></nobr></div>
<div style="position:absolute;top:42866;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性。</font><font style="vertical-align: inherit;">定义GDT后，我们可以使用特殊指令来加载它</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:42930;left:436"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:43083;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="35"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第35章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:43227;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4章进入32位保护模式</font></font></nobr></div>
<div style="position:absolute;top:43227;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">31</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:43282;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进入CPU，然后在特殊的CPU控制寄存器中将单个位置1以使</font></font></nobr></div>
<div style="position:absolute;top:43300;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际的开关。</font></font></nobr></div>
<div style="position:absolute;top:43318;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们不必在组装中定义GDT，则此过程将很容易</font></font></nobr></div>
<div style="position:absolute;top:43336;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言，但遗憾的是，如果我们以后希望加载一个</font></font></nobr></div>
<div style="position:absolute;top:43354;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已从高级语言（例如C）编译的内核，通常</font></font></nobr></div>
<div style="position:absolute;top:43372;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被编译为32位指令，而不是效率较低的16位指令。</font></font></nobr></div>
<div style="position:absolute;top:43390;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哦，我几乎忘了提到一个令人震惊的事情：我们不能再使用</font></font></nobr></div>
<div style="position:absolute;top:43408;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BIOS一旦切换到32位保护模式。</font><font style="vertical-align: inherit;">如果您认为拨打BIOS电话是</font></font></nobr></div>
<div style="position:absolute;top:43426;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低级。</font><font style="vertical-align: inherit;">这就像向后退了一步，向前进了两步。</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:43478;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1在没有BIOS的情况下适应生活</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:43521;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的确是这样：为了充分利用CPU，我们必须放弃所有有用的东西。</font></font></nobr></div>
<div style="position:absolute;top:43539;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BIOS提供的例程。</font><font style="vertical-align: inherit;">正如我们将更详细地了解32位时所看到的那样</font></font></nobr></div>
<div style="position:absolute;top:43557;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保护模式切换，BIOS例程，已被编码为只能在16位中使用</font></font></nobr></div>
<div style="position:absolute;top:43575;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实模式，在32位保护模式下不再有效；</font><font style="vertical-align: inherit;">确实，尝试使用它们</font></font></nobr></div>
<div style="position:absolute;top:43593;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会使机器崩溃。</font></font></nobr></div>
<div style="position:absolute;top:43611;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，这意味着32位操作系统必须提供自己的驱动程序</font></font></nobr></div>
<div style="position:absolute;top:43629;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器的所有硬件（例如键盘，屏幕，磁盘驱动器，鼠标等）。</font><font style="vertical-align: inherit;">实际上，</font></font></nobr></div>
<div style="position:absolute;top:43647;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32位保护模式操作系统可能会暂时切换回</font></font></nobr></div>
<div style="position:absolute;top:43665;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进入16位模式，这时它可能会利用BIOS，但是这种教导可能会带来更多麻烦</font></font></nobr></div>
<div style="position:absolute;top:43683;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比它值得的，尤其是在性能方面。</font></font></nobr></div>
<div style="position:absolute;top:43700;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们切换到保护模式时遇到的第一个问题是知道如何</font></font></nobr></div>
<div style="position:absolute;top:43718;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在屏幕上打印一条消息，这样我们就可以看到发生了什么。</font><font style="vertical-align: inherit;">以前我们</font></font></nobr></div>
<div style="position:absolute;top:43736;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经要求BIOS在屏幕上打印ASCII字符，但是这是如何导致</font></font></nobr></div>
<div style="position:absolute;top:43754;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们计算机的适当位置突出显示适当的像素</font></font></nobr></div>
<div style="position:absolute;top:43772;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕？</font><font style="vertical-align: inherit;">现在，足以知道该显示设备可以配置为一个</font></font></nobr></div>
<div style="position:absolute;top:43790;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两种模式之一（文本模式和图形模式）中的几种分辨率；</font><font style="vertical-align: inherit;">那又是什么</font></font></nobr></div>
<div style="position:absolute;top:43808;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕上显示的“”是特定范围内存的直观表示。</font><font style="vertical-align: inherit;">所以，</font></font></nobr></div>
<div style="position:absolute;top:43826;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了操纵屏幕，我们必须操纵特定的内存范围</font></font></nobr></div>
<div style="position:absolute;top:43844;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它以其当前模式使用。</font><font style="vertical-align: inherit;">显示设备是内存映射的一个示例</font></font></nobr></div>
<div style="position:absolute;top:43862;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">硬件，因为它以这种方式工作。</font></font></nobr></div>
<div style="position:absolute;top:43880;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当大多数计算机启动时，尽管它们实际上可能具有更高级的图形-</font></font></nobr></div>
<div style="position:absolute;top:43898;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ics硬件，它们以简单的视频图形阵列（VGA）彩色文本模式开始，</font></font></nobr></div>
<div style="position:absolute;top:43916;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尺寸80x25个字符。</font><font style="vertical-align: inherit;">在文本模式下，程序员无需渲染</font></font></nobr></div>
<div style="position:absolute;top:43934;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单个像素来描述特定字符，因为已经定义了简单字体</font></font></nobr></div>
<div style="position:absolute;top:43951;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在VGA显示设备的内部存储器中。</font><font style="vertical-align: inherit;">相反，</font></font></nobr></div>
<div style="position:absolute;top:43969;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕由内存中的两个字节表示：第一个字节是</font></font></nobr></div>
<div style="position:absolute;top:43987;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要显示的字符，第二个字节编码字符属性，例如</font></font></nobr></div>
<div style="position:absolute;top:44005;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为前景色和背景色，以及字符是否应该闪烁。</font></font></nobr></div>
<div style="position:absolute;top:44023;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，如果我们想在屏幕上显示一个字符，则需要设置其ASCII</font></font></nobr></div>
<div style="position:absolute;top:44041;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前VGA模式的正确内存地址处的代码和属性，即</font></font></nobr></div>
<div style="position:absolute;top:44059;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常位于地址</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xb8000上</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果我们稍微修改原始格式（16位实模式）</font></font></nobr></div>
<div style="position:absolute;top:44077;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印字符串例程，以便不再使用BIOS例程，我们可以创建一个32位</font></font></nobr></div>
<div style="position:absolute;top:44095;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保护模式例程，直接写入视频内存，如图</font><a href="https://translate.googleusercontent.com/translate_f#36"><font style="vertical-align: inherit;">4.1</font></a><font style="vertical-align: inherit;">所示</font></font><a href="https://translate.googleusercontent.com/translate_f#36"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></a></nobr></div>
<div style="position:absolute;top:44113;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，尽管屏幕显示为列和行，但是视频内存</font></font></nobr></div>
<div style="position:absolute;top:44131;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只是顺序的。</font><font style="vertical-align: inherit;">例如，可以计算第3行第5列的地址</font></font></nobr></div>
<div style="position:absolute;top:44149;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下：</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xb8000 + 2 *（行* 80 + col）</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:44345;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="36"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第36话</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:44489;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4章进入32位保护模式</font></font></nobr></div>
<div style="position:absolute;top:44489;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:44562;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[位32]</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:44576;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">定义一些常量</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:44591;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VIDEO_MEMORY </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EQU</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0xb8000</font></font></nobr></div>
<div style="position:absolute;top:44605;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHITE_ON_BLACK </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">equ</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0x0f</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:44633;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">打印由EDX指向的以空字符结尾的字符串</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:44647;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_string_pm：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:44662;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></nobr></div>
<div style="position:absolute;top:44676;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov edx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，VIDEO_MEMORY</font></font></font></nobr></div>
<div style="position:absolute;top:44676;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将edx设置为vid mem的开始。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:44704;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_string_pm_loop：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:44718;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电影</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ebx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]</font></font></font></nobr></div>
<div style="position:absolute;top:44718;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将字符存储在AL中的EBX</font></font></nobr></div>
<div style="position:absolute;top:44733;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov啊</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，WHITE_ON_BLACK</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">；</font><font style="vertical-align: inherit;">将属性存储在AH中</font></font></nobr></div>
<div style="position:absolute;top:44761;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">厘米</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></font></nobr></div>
<div style="position:absolute;top:44761;left:326"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">if（al == 0），在字符串的末尾，所以</font></font></nobr></div>
<div style="position:absolute;top:44775;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">做完了</font></font></font></nobr></div>
<div style="position:absolute;top:44775;left:326"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">跳到完成</font></font></nobr></div>
<div style="position:absolute;top:44803;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> edx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ax</font></font></nobr></div>
<div style="position:absolute;top:44803;left:326"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">当前存储字符和属性</font></font></nobr></div>
<div style="position:absolute;top:44818;left:326"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">字符单元格。</font></font></nobr></div>
<div style="position:absolute;top:44832;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加ebx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，1</font></font></font></nobr></div>
<div style="position:absolute;top:44832;left:326"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将EBX递增到字符串中的下一个字符。</font></font></nobr></div>
<div style="position:absolute;top:44846;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加edx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，2</font></font></font></nobr></div>
<div style="position:absolute;top:44846;left:326"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">移到vid mem中的下一个字符单元格。</font></font></nobr></div>
<div style="position:absolute;top:44874;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_string_pm_loop</font></font></font></nobr></div>
<div style="position:absolute;top:44874;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">循环打印下一个字符。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:44903;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_string_pm_done：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:44917;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">波帕</font></font></nobr></div>
<div style="position:absolute;top:44931;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退回</font></font></nobr></div>
<div style="position:absolute;top:44931;left:326"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">从函数返回</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:45000;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图4.1：将字符串直接打印到视频存储器的例程（即</font></font></nobr></div>
<div style="position:absolute;top:45022;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无需使用BIOS）。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:45087;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们例程的不利之处在于，它总是将字符串打印到字符串的左上角。</font></font></nobr></div>
<div style="position:absolute;top:45105;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕，因此将覆盖以前的消息，而不是滚动显示。</font><font style="vertical-align: inherit;">我们可以花</font></font></nobr></div>
<div style="position:absolute;top:45123;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间增加了此汇编例程的复杂性，但让我们不要做太多事情</font></font></nobr></div>
<div style="position:absolute;top:45141;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对我们自己来说很辛苦，因为当我们掌握了切换到保护模式后，我们很快就会</font></font></nobr></div>
<div style="position:absolute;top:45159;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用高级语言编写的启动代码，我们可以在其中简化工作</font></font></nobr></div>
<div style="position:absolute;top:45177;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些东西。</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:45229;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2了解全局描述符</font></font></nobr></div>
<div style="position:absolute;top:45262;left:225"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">桌子</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:45305;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重要的是要了解此GDT的要点，这对于</font></font></nobr></div>
<div style="position:absolute;top:45323;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在深入研究细节之前，请先执行保护模式的操作。</font><font style="vertical-align: inherit;">召回部分</font></font></nobr></div>
<div style="position:absolute;top:45341;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XXX表示经典16位实数中基于段的寻址的设计原理</font></font></nobr></div>
<div style="position:absolute;top:45359;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式是允许程序员更多地访问（尽管按今天的标准，这稍有增加）</font></font></nobr></div>
<div style="position:absolute;top:45377;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存超过16位偏移量所允许的范围。</font><font style="vertical-align: inherit;">例如，假设</font></font></nobr></div>
<div style="position:absolute;top:45395;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序员希望将</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ax</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值存储</font><font style="vertical-align: inherit;">在地址</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x4fe56处</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">没有细分-</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:45607;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="37"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第37部分</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:45751;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4章进入32位保护模式</font></font></nobr></div>
<div style="position:absolute;top:45751;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">33</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:45806;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于地址的寻址，程序员可以做的最好的事情是：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:45836;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[0xffff]，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ax</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:45868;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该地址与预期的地址相去甚远。</font><font style="vertical-align: inherit;">因此，使用段寄存器，</font></font></nobr></div>
<div style="position:absolute;top:45886;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以完成以下任务：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:45915;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动画bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x4000</font></font></font></nobr></div>
<div style="position:absolute;top:45930;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV ES </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> BX</font></font></nobr></div>
<div style="position:absolute;top:45944;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：0xfe56]，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ax</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:45976;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管分割内存并使用偏移量来达到这些目的的一般想法</font></font></nobr></div>
<div style="position:absolute;top:45994;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">段保持不变，它在保护模式下处于强制状态</font></font></nobr></div>
<div style="position:absolute;top:46011;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全改变，主要是为了提供更大的灵活性。</font><font style="vertical-align: inherit;">切换CPU之后</font></font></nobr></div>
<div style="position:absolute;top:46029;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进入32位保护模式，即转换逻辑地址的过程（即</font></font></nobr></div>
<div style="position:absolute;top:46047;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">段寄存器和偏移量的组合）到物理地址是完全</font></font></nobr></div>
<div style="position:absolute;top:46065;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同：不是将段寄存器的值乘以16，然后再相加</font></font></nobr></div>
<div style="position:absolute;top:46083;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移量，段寄存器成为特定段描述符（SD）的索引</font></font></nobr></div>
<div style="position:absolute;top:46101;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在GDT中。</font></font></nobr></div>
<div style="position:absolute;top:46119;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">段描述符是一个8字节的结构，它定义了以下属性</font></font></nobr></div>
<div style="position:absolute;top:46137;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保护模式段：</font></font></nobr></div>
<div style="position:absolute;top:46163;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•基址（32位），它定义段在物理内存中的开始位置</font></font></nobr></div>
<div style="position:absolute;top:46189;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•段限制（20位），它定义了段的大小</font></font></nobr></div>
<div style="position:absolute;top:46215;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•各种标志，这些标志会影响CPU解释段的方式，例如</font></font></nobr></div>
<div style="position:absolute;top:46234;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在其中运行的特权级别，或者是只读还是仅写。</font></font></nobr></div>
<div style="position:absolute;top:46260;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图</font></font><a href="https://translate.googleusercontent.com/translate_f#38"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了段描述符的实际结构。</font><font style="vertical-align: inherit;">注意如何</font></font></nobr></div>
<div style="position:absolute;top:46278;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更令人困惑的是，该结构碎片化了基地址和段限制</font></font></nobr></div>
<div style="position:absolute;top:46296;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在整个结构中，例如，段限制的低16位在</font></font></nobr></div>
<div style="position:absolute;top:46314;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结构的前两个字节，但高4位在第七个的开头</font></font></nobr></div>
<div style="position:absolute;top:46332;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结构的字节。</font><font style="vertical-align: inherit;">也许这是开个玩笑，或更有趣的是</font></font></nobr></div>
<div style="position:absolute;top:46350;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">历史根源还是受CPU硬件设计的影响。</font></font></nobr></div>
<div style="position:absolute;top:46368;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们不会担心自己的所有可能配置的细节</font></font></nobr></div>
<div style="position:absolute;top:46386;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">段描述符，有关详细说明，请参阅《英特尔开发人员手册》 [？]，</font></font></nobr></div>
<div style="position:absolute;top:46404;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是我们将学习为了使我们的代码在32位受保护的代码上运行而必须做的事情</font></font></nobr></div>
<div style="position:absolute;top:46422;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式。</font></font></nobr></div>
<div style="position:absolute;top:46440;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">段寄存器的最简单可行配置被英特尔描述为</font></font></nobr></div>
<div style="position:absolute;top:46458;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本平面模型，其中定义了两个重叠的段，它们覆盖了整个4 GB</font></font></nobr></div>
<div style="position:absolute;top:46476;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可寻址存储器，一个用于代码，另一个用于数据。</font><font style="vertical-align: inherit;">在这种模式下的事实</font></font></nobr></div>
<div style="position:absolute;top:46493;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这两个部分重叠意味着没有尝试保护一个部分免受</font></font></nobr></div>
<div style="position:absolute;top:46511;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另外，也没有尝试将分页功能用于虚拟内存。</font><font style="vertical-align: inherit;">它</font></font></nobr></div>
<div style="position:absolute;top:46529;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽早使事情变得简单很有意义，尤其是因为以后我们可能会改变细分市场</font></font></nobr></div>
<div style="position:absolute;top:46547;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦启动了高级语言，描述符就更容易了。</font></font></nobr></div>
<div style="position:absolute;top:46565;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了代码段和数据段，CPU还要求第一个条目</font></font></nobr></div>
<div style="position:absolute;top:46583;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GDT中的故意是一个无效的空描述符（即8个零字节的结构）。</font></font></nobr></div>
<div style="position:absolute;top:46601;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空描述符是一种简单的机制，可以在我们忘记设置错误的地方捕获错误。</font></font></nobr></div>
<div style="position:absolute;top:46619;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定的段寄存器，然后再访问地址，如果我们有的话，这很容易做到</font></font></nobr></div>
<div style="position:absolute;top:46637;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一些段寄存器设置为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x0</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，却忘记将其更新为适当的段</font></font></nobr></div>
<div style="position:absolute;top:46655;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">切换到保护模式后的描述符。</font><font style="vertical-align: inherit;">如果尝试使用</font></font></nobr></div>
<div style="position:absolute;top:46673;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果为null描述符，则CPU将引发异常，该异常本质上是一个中断-</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:46869;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="38"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第38部分</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:47013;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4章进入32位保护模式</font></font></nobr></div>
<div style="position:absolute;top:47013;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">34</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:47068;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管在概念上并不太相似，但不要将其与例外相混淆</font></font></nobr></div>
<div style="position:absolute;top:47086;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在高级语言（例如Java）中。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:47537;left:282"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图4.2：段描述符结构。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:47589;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的代码段将具有以下配置：</font></font></nobr></div>
<div style="position:absolute;top:47614;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•基数：0x0</font></font></nobr></div>
<div style="position:absolute;top:47641;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•限制：0xfffff</font></font></nobr></div>
<div style="position:absolute;top:47667;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•存在：1，因为段存在于内存中-用于虚拟内存</font></font></nobr></div>
<div style="position:absolute;top:47694;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•特权：0，环0是最高特权</font></font></nobr></div>
<div style="position:absolute;top:47721;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•描述符类型：1表示代码或数据段，0表示陷阱</font></font></nobr></div>
<div style="position:absolute;top:47747;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• 类型：</font></font></nobr></div>
<div style="position:absolute;top:47777;left:224"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">–代码：1为代码，因为这是一个代码段</font></font></nobr></div>
<div style="position:absolute;top:47802;left:224"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">–一致：0，不进行标准匹配，表示代码位于较低的段中</font></font></nobr></div>
<div style="position:absolute;top:47820;left:241"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权可能不会在此段中调用代码-这是内存保护的关键</font></font></nobr></div>
<div style="position:absolute;top:47845;left:224"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">–可读：1、1（如果可读），0（如果仅执行）。</font><font style="vertical-align: inherit;">可读允许我们阅读</font></font></nobr></div>
<div style="position:absolute;top:47863;left:241"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码中定义的常量。</font></font></nobr></div>
<div style="position:absolute;top:47888;left:224"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">–已访问：0这通常用于调试和虚拟内存技术，</font></font></nobr></div>
<div style="position:absolute;top:47906;left:241"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为CPU在访问网段时会将其设置为1</font></font></nobr></div>
<div style="position:absolute;top:47934;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•其他标志</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:48131;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="39"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第39部分</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:48275;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4章进入32位保护模式</font></font></nobr></div>
<div style="position:absolute;top:48275;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">35</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:48330;left:224"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">–粒度：1，如果设置，则将我们的极限乘以4 K（即16 * 16 * 16），因此我们的</font></font></nobr></div>
<div style="position:absolute;top:48348;left:241"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xfffff将变为0xfffff000（即，向左移动3个十六进制数字），从而允许</font></font></nobr></div>
<div style="position:absolute;top:48366;left:241"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的段跨越了4 Gb的内存</font></font></nobr></div>
<div style="position:absolute;top:48391;left:224"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">– 32位默认值：1，因为我们的网段将保存32位代码，否则我们将使用</font></font></nobr></div>
<div style="position:absolute;top:48409;left:241"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0表示16位代码。</font><font style="vertical-align: inherit;">这实际上设置了操作的默认数据单元大小</font></font></nobr></div>
<div style="position:absolute;top:48427;left:241"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（例如，push 0x4将扩展为32位数字，依此类推）</font></font></nobr></div>
<div style="position:absolute;top:48452;left:224"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">– 64位代码段：0，在32位处理器上未使用</font></font></nobr></div>
<div style="position:absolute;top:48477;left:224"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">– AVL：0，我们可以将其设置为自己使用（例如调试），但不会</font></font></nobr></div>
<div style="position:absolute;top:48495;left:241"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用它</font></font></nobr></div>
<div style="position:absolute;top:48525;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们使用的是简单的平面模型，其中包含两个重叠的代码段和数据段，</font></font></nobr></div>
<div style="position:absolute;top:48543;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据段将相同，但类型标记为：</font></font></nobr></div>
<div style="position:absolute;top:48569;left:225"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•代码：0表示数据</font></font></nobr></div>
<div style="position:absolute;top:48594;left:225"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•向下扩展：0。</font><font style="vertical-align: inherit;">这允许细分向下扩展-TODO</font></font></nobr></div>
<div style="position:absolute;top:48613;left:241"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解释这个</font></font></nobr></div>
<div style="position:absolute;top:48637;left:225"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•可写：1.这允许将数据段写入，否则</font></font></nobr></div>
<div style="position:absolute;top:48656;left:241"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将是只读的</font></font></nobr></div>
<div style="position:absolute;top:48680;left:225"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•已访问：0这通常用于调试和虚拟内存</font></font></nobr></div>
<div style="position:absolute;top:48699;left:241"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技术，因为CPU在访问段时将其设置为1</font></font></nobr></div>
<div style="position:absolute;top:48726;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们已经看到了两个部分的实际配置，探索了大部分</font></font></nobr></div>
<div style="position:absolute;top:48744;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能的段描述符设置，应该更清楚保护模式如何提供</font></font></nobr></div>
<div style="position:absolute;top:48762;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与实模式相比，内存分配的灵活性要高得多。</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:48814;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3在组装中定义GDT</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:48857;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们了解了在基本GDT中要包含的基本段描述符</font></font></nobr></div>
<div style="position:absolute;top:48875;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平面模型，让我们看一下如何在组装中实际表示GDT，这是一项任务</font></font></nobr></div>
<div style="position:absolute;top:48893;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这比其他任何事情都需要更多的耐心。</font><font style="vertical-align: inherit;">在经历剪力的同时</font></font></nobr></div>
<div style="position:absolute;top:48911;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">乏味，请记住它的重要性：我们在这里所做的将使我们</font></font></nobr></div>
<div style="position:absolute;top:48929;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即将启动我们的操作系统内核，我们将使用更高级别的语言来编写该操作系统内核，</font></font></nobr></div>
<div style="position:absolute;top:48947;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后---需要一个更好的报价---我们的小步伐将变成巨大的飞跃。</font></font></nobr></div>
<div style="position:absolute;top:48965;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们已经看到了有关如何在汇编代码中定义数据的示例，</font></font></nobr></div>
<div style="position:absolute;top:48983;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dd</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇编指令，这些正是我们必须使用的</font></font></nobr></div>
<div style="position:absolute;top:49001;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的GDT的段描述符条目中放置适当的字节。</font></font></nobr></div>
<div style="position:absolute;top:49019;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际上，出于CPU需要知道GDT多长时间的简单原因，</font></font></nobr></div>
<div style="position:absolute;top:49037;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们实际上并没有直接给CPU提供GDT的起始地址，而是给了它</font></font></nobr></div>
<div style="position:absolute;top:49055;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">称为GDT描述符的简单得多的结构的地址（即</font></font></nobr></div>
<div style="position:absolute;top:49072;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">说明GDT）。</font><font style="vertical-align: inherit;">GDT是一个6字节的结构，其中包含：</font></font></nobr></div>
<div style="position:absolute;top:49099;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•GDT大小（16位）</font></font></nobr></div>
<div style="position:absolute;top:49125;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•GDT地址（32位）</font></font></nobr></div>
<div style="position:absolute;top:49153;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，使用如此低级的语言处理复杂的数据结构时，例如</font></font></nobr></div>
<div style="position:absolute;top:49171;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些，我们无法添加足够的注释。</font><font style="vertical-align: inherit;">以下代码定义了我们的GDT和</font></font></nobr></div>
<div style="position:absolute;top:49189;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GDT描述符；</font><font style="vertical-align: inherit;">在代码中，请注意我们如何使用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等填充部分内容。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:49393;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="40"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第40话</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:49537;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4章进入32位保护模式</font></font></nobr></div>
<div style="position:absolute;top:49537;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">36</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:49592;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结构以及如何使用文字二进制数更方便地定义标志，</font></font></nobr></div>
<div style="position:absolute;top:49610;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后缀</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:49666;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">GDT</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:49680;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gdt_start：</font></font></nobr></div>
<div style="position:absolute;top:49708;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gdt_null：</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">强制空描述符</font></font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:49722;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dd </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x0</font></font></font></nobr></div>
<div style="position:absolute;top:49722;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">“ dd”表示定义双字（即4个字节）</font></font></nobr></div>
<div style="position:absolute;top:49737;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dd </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x0</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:49765;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gdt_code ：</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">；</font><font style="vertical-align: inherit;">代码段描述符</font></font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:49779;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">基本= 0x0，限制= 0xfffff，</font></font></nobr></div>
<div style="position:absolute;top:49793;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">第一个标志：（当前）1（特权）00（描述符类型）1-&gt; 1001b</font></font></nobr></div>
<div style="position:absolute;top:49808;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">类型标志：（代码）1（符合）0（可读）1（访问）0-&gt; 1010b</font></font></nobr></div>
<div style="position:absolute;top:49822;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">第二个标志：（粒度）1（默认为32位）1（64位段）0（AVL）0-&gt; 1100b</font></font></nobr></div>
<div style="position:absolute;top:49836;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xffff</font></font></font></nobr></div>
<div style="position:absolute;top:49836;left:288"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">限制（0-15位）</font></font></nobr></div>
<div style="position:absolute;top:49850;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x0</font></font></font></nobr></div>
<div style="position:absolute;top:49850;left:288"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">基（位0-15）</font></font></nobr></div>
<div style="position:absolute;top:49864;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x0</font></font></font></nobr></div>
<div style="position:absolute;top:49864;left:288"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">基（位16-23）</font></font></nobr></div>
<div style="position:absolute;top:49879;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10011010b</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">第一个标志，键入标志</font></font></nobr></div>
<div style="position:absolute;top:49893;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分贝</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11001111b</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">第二个标志，限制（位16-19）</font></font></nobr></div>
<div style="position:absolute;top:49907;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x0</font></font></font></nobr></div>
<div style="position:absolute;top:49907;left:288"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">基（位24-31）</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:49935;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gdt_data：;</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据段描述符</font></font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:49950;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">除类型标志外，与代码段相同：</font></font></nobr></div>
<div style="position:absolute;top:49964;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">类型标志：（代码）0（向下扩展）0（可写）1（已访问）0-&gt; 0010b</font></font></nobr></div>
<div style="position:absolute;top:49978;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xffff</font></font></font></nobr></div>
<div style="position:absolute;top:49978;left:288"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">限制（0-15位）</font></font></nobr></div>
<div style="position:absolute;top:49992;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x0</font></font></font></nobr></div>
<div style="position:absolute;top:49992;left:288"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">基（位0-15）</font></font></nobr></div>
<div style="position:absolute;top:50006;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x0</font></font></font></nobr></div>
<div style="position:absolute;top:50006;left:288"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">基（位16-23）</font></font></nobr></div>
<div style="position:absolute;top:50021;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分贝</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10010010b</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">第一个标志，键入标志</font></font></nobr></div>
<div style="position:absolute;top:50035;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分贝</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11001111b</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">第二个标志，限制（位16-19）</font></font></nobr></div>
<div style="position:absolute;top:50049;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x0</font></font></font></nobr></div>
<div style="position:absolute;top:50049;left:288"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">基（位24-31）</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:50077;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gdt_end：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:50077;left:288"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在标签末尾加上标签的原因</font></font></nobr></div>
<div style="position:absolute;top:50092;left:288"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">GDT是这样，我们可以让汇编器进行计算</font></font></nobr></div>
<div style="position:absolute;top:50106;left:288"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">GDT抽取器的GDT大小（下）</font></font></nobr></div>
<div style="position:absolute;top:50134;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">GDT描述子</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:50148;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gdt_descriptor：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:50163;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gdt_end-gdt_start-1</font></font></font></nobr></div>
<div style="position:absolute;top:50163;left:402"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">GDT的大小，总是小于1</font></font></nobr></div>
<div style="position:absolute;top:50177;left:402"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">真实大小</font></font></nobr></div>
<div style="position:absolute;top:50191;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dd </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gdt_start</font></font></font></nobr></div>
<div style="position:absolute;top:50191;left:402"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">我们的GDT的起始地址</font></font></nobr></div>
<div style="position:absolute;top:50219;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">为GDT段描述符的偏移量定义一些方便的常量，这些常量</font></font></nobr></div>
<div style="position:absolute;top:50234;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在保护模式下，段寄存器必须包含哪些内容。</font><font style="vertical-align: inherit;">例如，</font></font></nobr></div>
<div style="position:absolute;top:50248;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">当我们在PM中将DS设置为0x10时，CPU知道我们的意思是使用</font></font></nobr></div>
<div style="position:absolute;top:50262;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在我们的GDT中以偏移量0x10（即16个字节）描述的段，在我们的GDT中</font></font></nobr></div>
<div style="position:absolute;top:50276;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">case是DATA段（0x0-&gt; NULL; 0x08-&gt; CODE; 0x10-&gt; DATA）</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:50290;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CODE_SEG </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EQU</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gdt_code - gdt_start</font></font></nobr></div>
<div style="position:absolute;top:50304;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DATA_SEG</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gdt_data-gdt_start</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:50380;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4进行切换</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:50423;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的引导扇区中准备好GDT和GDT描述符后，</font></font></nobr></div>
<div style="position:absolute;top:50441;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们已经准备好指示CPU从16位实模式切换到32位受保护模式</font></font></nobr></div>
<div style="position:absolute;top:50459;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:50655;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="41"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第41章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:50799;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4章进入32位保护模式</font></font></nobr></div>
<div style="position:absolute;top:50799;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">37</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:50854;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就像我之前说过的那样，实际的切换是很直接的代码，但是</font></font></nobr></div>
<div style="position:absolute;top:50872;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解所涉及步骤的重要性很重要。</font></font></nobr></div>
<div style="position:absolute;top:50890;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们要做的第一件事是使用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cli</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（清除中断）</font><font style="vertical-align: inherit;">禁用中断</font></font></nobr></div>
<div style="position:absolute;top:50908;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令，这意味着CPU将仅忽略将来可能发生的任何中断</font></font></nobr></div>
<div style="position:absolute;top:50926;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至少在以后允许中断之前会发生这种情况。</font><font style="vertical-align: inherit;">这非常重要，因为</font></font></nobr></div>
<div style="position:absolute;top:50944;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于段的寻址，中断处理的方式完全不同</font></font></nobr></div>
<div style="position:absolute;top:50962;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保护模式而不是实模式，从而使BIOS在启动时就设置了当前的IVT</font></font></nobr></div>
<div style="position:absolute;top:50980;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记忆完全没有意义；</font><font style="vertical-align: inherit;">即使CPU可以将中断信号映射到</font></font></nobr></div>
<div style="position:absolute;top:50998;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他们正确的BIOS例程（例如，当用户按下某个键时，将其值存储在缓冲区中），</font></font></nobr></div>
<div style="position:absolute;top:51015;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BIOS例程将执行16位代码，这将没有概念</font></font></nobr></div>
<div style="position:absolute;top:51033;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在GDT中定义的32位段会导致CPU崩溃</font></font></nobr></div>
<div style="position:absolute;top:51051;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假定16位实模式分段方案的分段寄存器值。</font></font></nobr></div>
<div style="position:absolute;top:51069;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一步是要告诉CPU我们刚刚准备的GDT-很棒</font></font></nobr></div>
<div style="position:absolute;top:51087;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">疼痛。</font><font style="vertical-align: inherit;">我们使用一条指令来执行此操作，并向其传递GDT描述符：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:51118;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lgdt </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[gdt_descriptor]</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:51151;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既然一切都就位了，我们就可以通过设置a的第一位来进行实际的切换。</font></font></nobr></div>
<div style="position:absolute;top:51169;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特殊CPU控制寄存器</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cr0</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">现在，我们不能直接在寄存器上设置该位，</font></font></nobr></div>
<div style="position:absolute;top:51187;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此我们必须将其加载到通用寄存器中，设置该位，然后将其存储回</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:51206;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cr0 </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">类似于我们</font></font></font><font style="vertical-align: inherit;"><font color="#000000"><font style="vertical-align: inherit;">在XXX节中</font></font><font color="#000000"><font style="vertical-align: inherit;">使用</font></font><font style="vertical-align: inherit;">and</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令从中排除位的方式</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:51222;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个值，我们可以使用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令将某些位包含在一个值中（即，不包含</font></font></nobr></div>
<div style="position:absolute;top:51240;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于某些重要原因，可能会扰乱其他可能已设置的位</font></font></nobr></div>
<div style="position:absolute;top:51258;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制寄存器）[？]。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:51289;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV EAX </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CR0</font></font></nobr></div>
<div style="position:absolute;top:51289;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">为了切换到保护模式，我们设置</font></font></nobr></div>
<div style="position:absolute;top:51303;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或eax </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x1</font></font></font></nobr></div>
<div style="position:absolute;top:51303;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">CR0的第一位，控制寄存器</font></font></nobr></div>
<div style="position:absolute;top:51317;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov cr0 </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eax</font></font></nobr></div>
<div style="position:absolute;top:51317;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">更新控制寄存器</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:51350;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之后</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CR0</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经被更新，则CPU处于32位保护模式[？]。</font></font></nobr></div>
<div style="position:absolute;top:51368;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后的说法并不完全正确，因为现代处理器使用了一种技术</font></font></nobr></div>
<div style="position:absolute;top:51386;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">称为流水线，使他们能够处理指令执行的不同阶段</font></font></nobr></div>
<div style="position:absolute;top:51404;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并行（我在谈论单个CPU，而不是并行CPU），以及</font></font></nobr></div>
<div style="position:absolute;top:51422;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，用更少的时间。</font><font style="vertical-align: inherit;">例如，每条指令可能是从内存中提取的，</font></font></nobr></div>
<div style="position:absolute;top:51440;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解码成微码指令，执行，然后也许将结果存储回</font></font></nobr></div>
<div style="position:absolute;top:51458;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记忆; </font><font style="vertical-align: inherit;">由于这些阶段是半独立的，因此它们都可以在</font></font></nobr></div>
<div style="position:absolute;top:51476;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同的CPU周期，但在不同的电路内（例如，上一条指令可能是</font></font></nobr></div>
<div style="position:absolute;top:51494;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解码，然后提取下一个）[？]。</font></font></nobr></div>
<div style="position:absolute;top:51512;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常情况下，我们不需要担心CPU内部问题，例如流水线化</font></font></nobr></div>
<div style="position:absolute;top:51530;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对CPU进行编程，但是切换CPU模式是一种特殊情况，因为存在风险</font></font></nobr></div>
<div style="position:absolute;top:51547;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU可能会在错误的模式下处理指令执行的某些阶段。</font></font></nobr></div>
<div style="position:absolute;top:51565;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，在指示CPU切换模式后，我们需要立即做的是</font></font></nobr></div>
<div style="position:absolute;top:51583;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">强制CPU完成其管道中的所有作业，以便我们可以确信所有</font></font></nobr></div>
<div style="position:absolute;top:51601;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以后的指令将以正确的模式执行。</font></font></nobr></div>
<div style="position:absolute;top:51619;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，当CPU知道接下来的几条指令时，流水线工作非常好</font></font></nobr></div>
<div style="position:absolute;top:51637;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为它可以预取它们，所以它会出现在地平线上，但是它不喜欢</font></font></nobr></div>
<div style="position:absolute;top:51655;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令，例如</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">call</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为在执行</font><font color="#2b57a3"><font style="vertical-align: inherit;">完</font></font><font style="vertical-align: inherit;">这些指令之前</font></font></nobr></div>
<div style="position:absolute;top:51673;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU完全不知道将遵循它们的指令，尤其是在以下情况下：</font></font></nobr></div>
<div style="position:absolute;top:51691;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们使用远距离跳转或调用，这意味着我们跳转到另一段。</font><font style="vertical-align: inherit;">所以马上</font></font></nobr></div>
<div style="position:absolute;top:51709;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示CPU切换模式后，我们可以发出远距离跳动，这将强制</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:51917;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="42"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第42话</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:52061;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4章进入32位保护模式</font></font></nobr></div>
<div style="position:absolute;top:52061;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">38</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:52116;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU刷新管道（即完成当前处于不同阶段的所有指令）</font></font></nobr></div>
<div style="position:absolute;top:52134;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的管道）。</font></font></nobr></div>
<div style="position:absolute;top:52152;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了发出远距离跳动，而不是近距离（即标准）跳动，我们另外</font></font></nobr></div>
<div style="position:absolute;top:52170;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供目标细分，如下所示：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:52199;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">段</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;：&lt;地址</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移量</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:52230;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于这种跳跃，我们需要仔细考虑我们希望降落的地方。</font><font style="vertical-align: inherit;">假设我们成立了</font></font></nobr></div>
<div style="position:absolute;top:52248;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们代码中的标签，例如</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始保护模式</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它标记了我们32位的开始</font></font></nobr></div>
<div style="position:absolute;top:52266;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码。</font><font style="vertical-align: inherit;">正如我们刚刚讨论的那样，</font><font style="vertical-align: inherit;">可能会发生</font><font style="vertical-align: inherit;">跳跃，例如</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp启动保护模式</font></font></font><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:52284;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不足以冲洗管道，而且，除了我们现在处于某种奇怪的困境之外，</font></font></nobr></div>
<div style="position:absolute;top:52302;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为我们当前的代码段（即</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cs</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）在保护模式下无效。</font><font style="vertical-align: inherit;">所以，我们</font></font></nobr></div>
<div style="position:absolute;top:52320;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须将我们的</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cs</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寄存器</font><font style="vertical-align: inherit;">更新</font><font style="vertical-align: inherit;">为GDT的代码段描述符的偏移量。</font></font></nobr></div>
<div style="position:absolute;top:52338;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于段描述符的长度均为8个字节，并且由于我们的代码描述符为</font></font></nobr></div>
<div style="position:absolute;top:52356;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GDT中的第二个描述符（空描述符是第一个），其偏移量为</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:52375;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x8 </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此此值是我们现在必须将代码段寄存器设置为的值。</font><font style="vertical-align: inherit;">注意，</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:52392;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按照遥远的定义，它将自动导致CPU更新我们的</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:52411;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cs</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注册到目标段。</font><font style="vertical-align: inherit;">方便地使用标签，我们得到了汇编器</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:52428;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算这些段描述符的偏移量并将其存储为常量</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CODE SEG</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:52447;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DATA SEG </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所以现在我们得到跳出指令：</font></font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:52475;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CODE_SEG：start_protected_mode</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:52503;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[位32]</font></font></nobr></div>
<div style="position:absolute;top:52532;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start_protected_mode：</font></font></nobr></div>
<div style="position:absolute;top:52546;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:52546;left:325"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">到现在为止，我们可以肯定地处于32位保护模式。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:52560;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:52591;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，实际上，我们不需要在物理距离上跳得很远</font></font></nobr></div>
<div style="position:absolute;top:52609;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们从哪里跳到着陆之间，但重要的是</font></font></nobr></div>
<div style="position:absolute;top:52627;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们如何跳。</font></font></nobr></div>
<div style="position:absolute;top:52645;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还要注意，我们需要使用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[bits 32]</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令来告诉我们的汇编器，</font></font></nobr></div>
<div style="position:absolute;top:52663;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从那时起，它应该以32位模式指令进行编码。</font><font style="vertical-align: inherit;">请注意，</font></font></nobr></div>
<div style="position:absolute;top:52681;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这并不意味着我们不能在16位实模式下使用32位指令，只是</font></font></nobr></div>
<div style="position:absolute;top:52699;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇编程序对这些指令的编码必须与32位受保护的编码稍有不同</font></font></nobr></div>
<div style="position:absolute;top:52717;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式 [？]。</font><font style="vertical-align: inherit;">确实，当切换到保护模式时，我们使用了32位寄存器</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:52736;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eax</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置控制位。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:52753;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们处于32位保护模式。</font><font style="vertical-align: inherit;">进入我们之后要做的一件好事</font></font></nobr></div>
<div style="position:absolute;top:52770;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正确的32位模式是更新所有其他段寄存器，因此它们现在指向</font></font></nobr></div>
<div style="position:absolute;top:52788;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的32位数据段（而不是现在无效的实模式段）并进行更新</font></font></nobr></div>
<div style="position:absolute;top:52806;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈的位置。</font></font></nobr></div>
<div style="position:absolute;top:52824;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以将整个过程组合成一个可重用的例程，如图XXX所示。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:52882;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[位16]</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:52897;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">切换到保护模式</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:52911;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">switch_to_pm：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:52939;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cli</font></font></nobr></div>
<div style="position:absolute;top:52939;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">我们必须切换中断，直到有</font></font></nobr></div>
<div style="position:absolute;top:52953;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">设置保护模式中断向量</font></font></nobr></div>
<div style="position:absolute;top:52968;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">否则中断将引发骚乱。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:53179;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="43"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第43部分</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:53323;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4章进入32位保护模式</font></font></nobr></div>
<div style="position:absolute;top:53323;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">39</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:53410;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lgdt </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[gdt_descriptor]</font></font></font></nobr></div>
<div style="position:absolute;top:53410;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">加载我们的全局描述符表，该表定义</font></font></nobr></div>
<div style="position:absolute;top:53425;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">保护模式段（例如，用于代码和数据）</font></font></nobr></div>
<div style="position:absolute;top:53453;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV EAX </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CR0</font></font></nobr></div>
<div style="position:absolute;top:53453;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">为了切换到保护模式，我们设置</font></font></nobr></div>
<div style="position:absolute;top:53467;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或eax </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x1</font></font></font></nobr></div>
<div style="position:absolute;top:53467;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">CR0的第一位，控制寄存器</font></font></nobr></div>
<div style="position:absolute;top:53481;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov cr0 </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eax</font></font></nobr></div>
<div style="position:absolute;top:53510;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JMP </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CODE_SEG：init_pm</font></font></font></nobr></div>
<div style="position:absolute;top:53510;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">跳到我们的32位（即跳转到新段）</font></font></nobr></div>
<div style="position:absolute;top:53524;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">代码。</font></font></nobr></div>
<div style="position:absolute;top:53524;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这也迫使CPU刷新其缓存</font></font></nobr></div>
<div style="position:absolute;top:53538;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">预取和实模式解码的指令，可以</font></font></nobr></div>
<div style="position:absolute;top:53552;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">引起问题。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:53581;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[位32]</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:53595;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">一次在PM中初始化寄存器和堆栈。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:53609;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">init_pm：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:53637;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ax </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，DATA_SEG</font></font></font></nobr></div>
<div style="position:absolute;top:53637;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">现在在PM中，我们的旧细分市场已经毫无意义，</font></font></nobr></div>
<div style="position:absolute;top:53652;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV DS </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AX</font></font></nobr></div>
<div style="position:absolute;top:53652;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">所以我们将段寄存器指向</font></font></nobr></div>
<div style="position:absolute;top:53666;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV SS </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AX</font></font></nobr></div>
<div style="position:absolute;top:53666;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">我们在GDT中定义的数据选择器</font></font></nobr></div>
<div style="position:absolute;top:53680;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV ES </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AX</font></font></nobr></div>
<div style="position:absolute;top:53694;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV FS </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">斧</font></font></nobr></div>
<div style="position:absolute;top:53708;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV GS </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">斧</font></font></nobr></div>
<div style="position:absolute;top:53737;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ebp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x90000</font></font></font></nobr></div>
<div style="position:absolute;top:53737;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">更新我们的堆栈位置，以便正确</font></font></nobr></div>
<div style="position:absolute;top:53751;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV ESP </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> EBP</font></font></nobr></div>
<div style="position:absolute;top:53751;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在可用空间的顶部。</font></font></nobr></div>
<div style="position:absolute;top:53779;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致电</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BEGIN_PM</font></font></font></nobr></div>
<div style="position:absolute;top:53779;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">最后，叫一些知名的标签</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:53855;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5放在一起</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:53899;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，我们可以将所有例程包含在引导扇区中，以演示该切换</font></font></nobr></div>
<div style="position:absolute;top:53917;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从16位实模式到32位保护模式。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:53974;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">进入32位保护模式的引导扇区。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:53988;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">org</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0x7c00]</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:54017;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov bp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x9000</font></font></font></nobr></div>
<div style="position:absolute;top:54017;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">设置堆栈。</font></font></nobr></div>
<div style="position:absolute;top:54031;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV SP </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> BP</font></font></nobr></div>
<div style="position:absolute;top:54059;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，MSG_REAL_MODE</font></font></font></nobr></div>
<div style="position:absolute;top:54073;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼叫</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_string</font></font></font></nobr></div>
<div style="position:absolute;top:54102;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致电</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">switch_to_pm</font></font></font></nobr></div>
<div style="position:absolute;top:54102;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">请注意，我们永远不会从这里返回。</font></font></nobr></div>
<div style="position:absolute;top:54130;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:54159;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ ../print/print_string.asm”</font></font></nobr></div>
<div style="position:absolute;top:54173;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ gdt.asm”</font></font></nobr></div>
<div style="position:absolute;top:54187;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ print_string_pm.asm”</font></font></nobr></div>
<div style="position:absolute;top:54201;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ switch_to_pm.asm”</font></font></nobr></div>
<div style="position:absolute;top:54230;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[位32]</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:54441;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="44"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第44章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:54585;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4章进入32位保护模式</font></font></nobr></div>
<div style="position:absolute;top:54585;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">40</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:54658;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">这是我们切换到并初始化保护模式之后到达的地方。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:54672;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BEGIN_PM：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:54701;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ebx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，MSG_PROT_MODE</font></font></font></nobr></div>
<div style="position:absolute;top:54715;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致电</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_string_pm</font></font></font></nobr></div>
<div style="position:absolute;top:54715;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">使用我们的32位打印例程。</font></font></nobr></div>
<div style="position:absolute;top:54743;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></font></nobr></div>
<div style="position:absolute;top:54743;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">悬挂。</font></font></nobr></div>
<div style="position:absolute;top:54786;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">全局变量</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:54800;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSG_REAL_MODE</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:54800;left:288"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“以16位实模式启动”，0</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:54814;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSG_PROT_MODE</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:54814;left:288"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“成功进入32位保护模式”，0</font></font></font></nobr></div>
<div style="position:absolute;top:54843;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">引导区填充</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:54857;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">倍510-（$-$$）</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:54871;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xaa55</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:55703;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="45"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第45章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:56014;left:389"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">章</font></font><font style="font-size:35px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></font></nobr></div>
</span></font>
<font size="5" color="#2b57a3" face="Times"><span style="font-size:35px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:56089;left:183"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写，构建和加载</font></font></nobr></div>
<div style="position:absolute;top:56134;left:343"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的内核</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:56242;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目前为止，通过交流，我们已经学到了很多有关计算机如何工作的知识。</font></font></nobr></div>
<div style="position:absolute;top:56260;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在低级汇编语言中使用它，但是我们也看到了它可能非常慢</font></font></nobr></div>
<div style="position:absolute;top:56278;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以这种语言取得进步：即使是最简单的语言，我们也需要非常仔细地思考</font></font></nobr></div>
<div style="position:absolute;top:56296;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制结构（例如，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果（&lt;something&gt;）&lt;执行此操作&gt;否则执行&lt;执行操作&gt;</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），则我们</font></font></nobr></div>
<div style="position:absolute;top:56314;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不得不担心如何最好地利用有限数量的寄存器，并且变戏法</font></font></nobr></div>
<div style="position:absolute;top:56332;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与堆栈。</font><font style="vertical-align: inherit;">我们继续使用汇编语言的另一个缺点是</font></font></nobr></div>
<div style="position:absolute;top:56349;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与特定的CPU架构紧密相关，因此我们很难移植</font></font></nobr></div>
<div style="position:absolute;top:56367;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的操作系统使用另一种CPU架构（例如ARM，RISC，PowerPC）。</font></font></nobr></div>
<div style="position:absolute;top:56385;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">幸运的是，其他程序员也厌倦了汇编语言的编写，因此决定编写</font></font></nobr></div>
<div style="position:absolute;top:56403;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更高级的语言编译器（例如FORTRAN，C，Pascal，BASIC等），</font></font></nobr></div>
<div style="position:absolute;top:56421;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将更直观的代码转换为汇编语言。</font><font style="vertical-align: inherit;">这些编译器的目的是</font></font></nobr></div>
<div style="position:absolute;top:56439;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将更高级别的构造（例如控制结构和函数调用）映射到汇编上</font></font></nobr></div>
<div style="position:absolute;top:56457;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模板代码，所以不利之处---通常总是存在不利之处---是</font></font></nobr></div>
<div style="position:absolute;top:56475;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通用模板对于特定功能可能并不总是最佳的。</font><font style="vertical-align: inherit;">没有</font></font></nobr></div>
<div style="position:absolute;top:56493;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事不宜迟，让我们看一下如何将C代码转换为汇编以使角色神秘化</font></font></nobr></div>
<div style="position:absolute;top:56511;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的编译器。</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:56563;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1了解C编译</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:56606;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们用C编写一些小的代码片段，看看它们是什么样的汇编代码</font></font></nobr></div>
<div style="position:absolute;top:56624;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产生。</font><font style="vertical-align: inherit;">这是学习C的工作方式的好方法。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:56672;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.1生成原始机器代码</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:56747;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//定义一个返回整数的空函数</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:56812;left:436"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">41</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:56965;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="46"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第46章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:57109;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:57130;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:57130;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">42</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:57182;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_function（）{</font></font></font></nobr></div>
<div style="position:absolute;top:57196;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xbaba;</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:57211;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:57267;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将图XXXX中的代码保存到名为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">basic.c</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的文件中</font><font style="vertical-align: inherit;">，并按如下所示进行编译：</font></font></nobr></div>
<div style="position:absolute;top:57295;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ gcc -ffreestanding -c basic.c -o basic.o</font></font></nobr></div>
<div style="position:absolute;top:57321;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将产生一个目标文件，该文件完全不相关，因此不应</font></font></nobr></div>
<div style="position:absolute;top:57339;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与面向对象编程的概念融为一体。</font><font style="vertical-align: inherit;">而不是直接编译</font></font></nobr></div>
<div style="position:absolute;top:57357;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转换成机器代码后，编译器会输出带注释的机器代码，其中元信息</font></font></nobr></div>
<div style="position:absolute;top:57375;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文本标签之类的对执行有多余的功能仍然存在，以便启用</font></font></nobr></div>
<div style="position:absolute;top:57393;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最终如何将代码组合在一起具有更大的灵活性。</font><font style="vertical-align: inherit;">这的一大优势</font></font></nobr></div>
<div style="position:absolute;top:57411;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中间格式是该代码可以轻松地重定位到较大的二进制文件中</font></font></nobr></div>
<div style="position:absolute;top:57429;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与其他库中其他例程的例程链接时，由于</font></font></nobr></div>
<div style="position:absolute;top:57446;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标文件使用相对而不是绝对的内部内存引用。</font><font style="vertical-align: inherit;">我们可以得到一个</font></font></nobr></div>
<div style="position:absolute;top:57464;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用以下命令可以很好地查看目标文件的内容：</font></font></nobr></div>
<div style="position:absolute;top:57493;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ objdump -d basic.o</font></font></nobr></div>
<div style="position:absolute;top:57518;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该命令的输出将给出如图XXX所示的内容。</font><font style="vertical-align: inherit;">注意</font></font></nobr></div>
<div style="position:absolute;top:57536;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以看到一些汇编说明以及有关代码的其他一些详细信息。</font><font style="vertical-align: inherit;">笔记</font></font></nobr></div>
<div style="position:absolute;top:57554;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序集的语法与nasm所使用的语法略有不同，因此很简单</font></font></nobr></div>
<div style="position:absolute;top:57572;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">忽略这部分，因为我们很快就会以更熟悉的格式看到它。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:57646;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">basic.o：</font></font></nobr></div>
<div style="position:absolute;top:57646;left:273"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件格式elf32-i386</font></font></nobr></div>
<div style="position:absolute;top:57688;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.text部分的反汇编：</font></font></nobr></div>
<div style="position:absolute;top:57717;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000000 &lt;我的功能&gt;：</font></font></nobr></div>
<div style="position:absolute;top:57731;left:197"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0：55</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:57731;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">推</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:57731;left:440"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％息</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">税前利润</font></font></font></nobr></div>
<div style="position:absolute;top:57745;left:197"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1：89 e5</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:57745;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:57745;left:440"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，％</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ebp</font></font></font></nobr></div>
<div style="position:absolute;top:57759;left:197"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3：b8 ba ba 00 00</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:57759;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:57759;left:441"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ 0xbaba，％</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eax</font></font></font></nobr></div>
<div style="position:absolute;top:57773;left:197"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8：5天</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:57773;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流行音乐</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:57773;left:440"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％息</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">税前利润</font></font></font></nobr></div>
<div style="position:absolute;top:57788;left:197"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9：c3</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:57788;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退回</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:57844;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了创建实际的可执行代码（即将在我们的CPU上运行的代码），</font></font></nobr></div>
<div style="position:absolute;top:57862;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们必须使用一个链接器，该链接器的作用是将本文档中描述的所有例程链接在一起</font></font></nobr></div>
<div style="position:absolute;top:57880;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将输入目标文件放入一个可执行的二进制文件中，将它们有效地缝合在一起</font></font></nobr></div>
<div style="position:absolute;top:57898;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并将这些相对地址转换为汇总内的绝对地址</font></font></nobr></div>
<div style="position:absolute;top:57916;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器码，例如：</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用&lt;功能X标签&gt;</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将变为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用0x12345</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:57934;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其中</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x12345</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是链接器决定将输出文件放置在输出文件中的偏移量</font></font></nobr></div>
<div style="position:absolute;top:57952;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能X标签</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示的例程的代码</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:57970;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，在我们的情况下，我们不想与任何其他对象的任何例程链接</font></font></nobr></div>
<div style="position:absolute;top:57988;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件---我们将在短期内进行介绍---但是，链接器将转换我们的anno-</font></font></nobr></div>
<div style="position:absolute;top:58006;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将机器代码文件处理为原始机器代码文件。</font><font style="vertical-align: inherit;">将原始机器代码输出到</font></font></nobr></div>
<div style="position:absolute;top:58023;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个文件</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">basic.bin</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们可以使用以下命令：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:58227;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="47"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第47页</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:58371;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:58392;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:58392;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">43</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:58427;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ ld -o basic.bin -Ttext 0x0 -o格式化二进制basic.o</font></font></nobr></div>
<div style="position:absolute;top:58453;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，链接器可以像编译器一样以各种形式输出可执行文件，例如：</font></font></nobr></div>
<div style="position:absolute;top:58471;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">垫，其中一些可以保留来自输入对象文件的元数据。</font><font style="vertical-align: inherit;">这很有用</font></font></nobr></div>
<div style="position:absolute;top:58489;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于操作系统托管的可执行文件，例如大多数程序</font></font></nobr></div>
<div style="position:absolute;top:58507;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将在Linux或Windows等平台上进行编写，因为可以保留元数据</font></font></nobr></div>
<div style="position:absolute;top:58525;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述如何将这些应用程序加载到内存中；</font><font style="vertical-align: inherit;">并用于调试</font></font></nobr></div>
<div style="position:absolute;top:58543;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目的，例如：进程在指令地址处崩溃的信息</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:58562;left:159"><nobr><font style="vertical-align: inherit;"><font color="#000000"><font style="vertical-align: inherit;">对于程序员而言，</font></font><font style="vertical-align: inherit;"> 0x12345678的</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作用远不如使用redun-呈现的信息</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:58578;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程无法正常运行的无法执行的元数据，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我的函数</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，文件</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:58598;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">basic.c </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在第</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font><font color="#000000"><font style="vertical-align: inherit;">行上</font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:58614;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无论如何，由于我们对编写操作系统感兴趣，所以这不好</font></font></nobr></div>
<div style="position:absolute;top:58632;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试在我们的CPU上运行与元数据混合在一起的机器代码，因为不知道</font></font></nobr></div>
<div style="position:absolute;top:58650;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU将每个字节作为机器代码执行。</font><font style="vertical-align: inherit;">这就是为什么我们指定输出格式</font></font></nobr></div>
<div style="position:absolute;top:58668;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的（原始）</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的二进制</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:58686;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们使用的另一个选项是</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Ttext 0x0</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它与</font><font color="#2b57a3"><font style="vertical-align: inherit;">org的</font></font><font style="vertical-align: inherit;">工作方式相同</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"></font></font></nobr></div>
<div style="position:absolute;top:58704;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过允许我们告诉编译器，我们在较早的汇编例程中使用了伪指令</font></font></nobr></div>
<div style="position:absolute;top:58722;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移我们代码中的标签地址（例如，对于我们在代码中指定的任何数据，例如</font></font></nobr></div>
<div style="position:absolute;top:58740;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">稍后加载的</font><font style="vertical-align: inherit;">字符串，例如</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ Hello，World”</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）到其绝对内存地址</font></font></nobr></div>
<div style="position:absolute;top:58758;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到内存中的特定来源。</font><font style="vertical-align: inherit;">目前这并不重要，但是当我们加载时</font></font></nobr></div>
<div style="position:absolute;top:58776;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核代码到内存中，将其设置为计划加载的地址很重要</font></font></nobr></div>
<div style="position:absolute;top:58794;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至。</font></font></nobr></div>
<div style="position:absolute;top:58812;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们已经成功地将C代码编译成原始机器代码文件，</font></font></nobr></div>
<div style="position:absolute;top:58830;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以（一旦我们弄清楚了如何加载它）就可以在我们的CPU上运行，那么让我们看看</font></font></nobr></div>
<div style="position:absolute;top:58847;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看起来像。</font><font style="vertical-align: inherit;">幸运的是，由于汇编非常紧密地映射到机器代码指令，如果</font></font></nobr></div>
<div style="position:absolute;top:58865;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您会得到一个仅包含机器代码的文件，您可以轻松地将其反汇编为</font></font></nobr></div>
<div style="position:absolute;top:58883;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在组装中查看。</font><font style="vertical-align: inherit;">是的; </font><font style="vertical-align: inherit;">这是了解一些组装的另一个好处，</font></font></nobr></div>
<div style="position:absolute;top:58901;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为您可以对所有落在您身上的软件进行反向工程</font></font></nobr></div>
<div style="position:absolute;top:58919;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原始源代码，如果开发人员保留了一些元数据，则将更加成功</font></font></nobr></div>
<div style="position:absolute;top:58937;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为您服务---他们几乎总是这样做。</font><font style="vertical-align: inherit;">拆卸机器的唯一问题</font></font></nobr></div>
<div style="position:absolute;top:58955;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码是其中某些字节可能已保留为数据，但将显示为</font></font></nobr></div>
<div style="position:absolute;top:58973;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇编指令，尽管在我们简单的C程序中我们没有声明任何数据。</font><font style="vertical-align: inherit;">至</font></font></nobr></div>
<div style="position:absolute;top:58991;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看编译器实际从我们的C源代码生成的机器代码，运行</font></font></nobr></div>
<div style="position:absolute;top:59009;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下命令：</font></font></nobr></div>
<div style="position:absolute;top:59037;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ ndisasm -b 32 basic.bin&gt; basic.dis</font></font></nobr></div>
<div style="position:absolute;top:59063;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-b 32</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单地告诉拆装到解码为32位汇编指令，</font></font></nobr></div>
<div style="position:absolute;top:59081;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是我们的编译器生成的。</font><font style="vertical-align: inherit;">图XXX显示了生成的汇编代码</font></font></nobr></div>
<div style="position:absolute;top:59099;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由gcc提供的简单C程序。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:59158;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000000</font></font></nobr></div>
<div style="position:absolute;top:59158;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">55</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:59158;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">推ebp</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:59172;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000001</font></font></nobr></div>
<div style="position:absolute;top:59172;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">89E5</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:59172;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ebp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特别是</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:59186;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000003</font></font></nobr></div>
<div style="position:absolute;top:59186;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:59186;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov eax </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0xbaba</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:59201;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000008</font></font></nobr></div>
<div style="position:absolute;top:59201;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5D</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:59201;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流行音乐</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:59215;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000009</font></font></nobr></div>
<div style="position:absolute;top:59215;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C3</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:59215;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退回</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:59271;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就是这样：gcc生成了一些汇编代码，与我们的汇编代码不太相似</font></font></nobr></div>
<div style="position:absolute;top:59289;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经在写自己了。</font><font style="vertical-align: inherit;">反汇编器输出的三列，</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:59489;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="48"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第48章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:59633;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:59654;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:59654;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">44</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:59688;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从左到右，显示指令，机器代码和</font></font></nobr></div>
<div style="position:absolute;top:59706;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等效的组装说明。</font><font style="vertical-align: inherit;">尽管我们的功能做的很简单，</font></font></nobr></div>
<div style="position:absolute;top:59724;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那里是一些其他代码，似乎在操纵栈的底部和顶部</font></font></nobr></div>
<div style="position:absolute;top:59742;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寄存器</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ebp</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">C大量使用堆栈来存储以下变量：</font></font></nobr></div>
<div style="position:absolute;top:59760;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数的局部变量（即函数返回时不再需要的变量），</font></font></nobr></div>
<div style="position:absolute;top:59778;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此在输入函数时，堆栈的基本指针（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ebp</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）被增加到当前</font></font></nobr></div>
<div style="position:absolute;top:59796;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">栈顶（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ebp，esp</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），有效地在上面创建了一个本地的，最初是空的栈</font></font></nobr></div>
<div style="position:absolute;top:59814;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用我们函数的函数堆栈。</font><font style="vertical-align: inherit;">此过程通常称为</font></font></nobr></div>
<div style="position:absolute;top:59832;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该函数设置其堆栈框架，并在其中分配所有局部变量。</font></font></nobr></div>
<div style="position:absolute;top:59849;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，如果在从我们的函数返回之前，我们无法将堆栈帧还原到</font></font></nobr></div>
<div style="position:absolute;top:59867;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初是由我们的调用者设置的，当</font></font></nobr></div>
<div style="position:absolute;top:59885;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">试图访问其局部变量；</font><font style="vertical-align: inherit;">因此，在为我们的堆栈更新基本指针之前</font></font></nobr></div>
<div style="position:absolute;top:59903;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框架，我们必须将其存储起来，没有比堆栈顶部更好的存储位置了</font></font></nobr></div>
<div style="position:absolute;top:59921;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">推送ebp</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></nobr></div>
<div style="position:absolute;top:59939;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在准备好我们的堆栈框架之后，可惜的是，它实际上并没有在我们的简单框架中使用</font></font></nobr></div>
<div style="position:absolute;top:59957;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数，我们看到编译器如何处理</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回0xbaba</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的行</font><font color="#2b57a3"><font style="vertical-align: inherit;">；</font></font><font style="vertical-align: inherit;">：值</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xbaba</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></nobr></div>
<div style="position:absolute;top:59975;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在32位寄存器</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eax中</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这是调用函数的位置（如果有的话）</font></font></nobr></div>
<div style="position:absolute;top:59993;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">期望找到返回的值，这与我们有自己的约定类似</font></font></nobr></div>
<div style="position:absolute;top:60011;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用某些寄存器将参数传递给我们先前的汇编例程，例如：</font></font></nobr></div>
<div style="position:absolute;top:60029;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印字符串</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例程应在以下位置找到要打印的字符串的地址：</font></font></nobr></div>
<div style="position:absolute;top:60047;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注册</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bx</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:60065;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，在发出</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ret</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回给调用者之前，该函数将弹出原始堆栈</font></font></nobr></div>
<div style="position:absolute;top:60083;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本指针离开堆栈（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pop ebp</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），因此调用函数将不会意识到自己的</font><font style="vertical-align: inherit;">指针</font></font></nobr></div>
<div style="position:absolute;top:60101;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈框架曾经被调用的函数更改过。</font><font style="vertical-align: inherit;">请注意，我们并未实际更改</font></font></nobr></div>
<div style="position:absolute;top:60118;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈的顶部（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），因为在这种情况下，我们的堆栈框架用于存储任何内容，</font></font></nobr></div>
<div style="position:absolute;top:60136;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，未更改的</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寄存器不需要还原。</font></font></nobr></div>
<div style="position:absolute;top:60154;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们对C代码如何转换为汇编有了一个好主意，所以让我们介绍一下</font></font></nobr></div>
<div style="position:absolute;top:60172;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进一步编译，直到我们有足够的理解来编写一个简单的</font></font></nobr></div>
<div style="position:absolute;top:60190;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C语言的内核</font></font></nobr></div>
<div style="position:absolute;top:60208;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[？]</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:60256;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.2局部变量</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:60290;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，将图XXX中的代码写入一个名为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">local var.c</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的文件中，</font><font style="vertical-align: inherit;">并进行编译，链接和</font></font></nobr></div>
<div style="position:absolute;top:60308;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">像以前一样拆卸它。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:60367;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//声明一个局部变量。</font></font></nobr></div>
<div style="position:absolute;top:60381;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_function（）{</font></font></font></nobr></div>
<div style="position:absolute;top:60395;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_var = 0xbaba;</font></font></font></nobr></div>
<div style="position:absolute;top:60410;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_var;</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:60424;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:60480;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，编译器将生成图XXX中的汇编代码。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:60751;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="49"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第49部分</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:60895;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:60916;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:60916;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">45</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:60968;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000000</font></font></nobr></div>
<div style="position:absolute;top:60968;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">55</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:60968;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">推ebp</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:60982;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000001</font></font></nobr></div>
<div style="position:absolute;top:60982;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">89E5</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:60982;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ebp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特别是</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:60997;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000003</font></font></nobr></div>
<div style="position:absolute;top:60997;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">83EC10</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:60997;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子esp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字节</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ 0x10</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:61011;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000006</font></font></nobr></div>
<div style="position:absolute;top:61011;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C745FCBABA0000</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:61011;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov dword </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ebp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-0x4]，0xbaba</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:61025;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0000000D</font></font></nobr></div>
<div style="position:absolute;top:61025;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8B45FC</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:61025;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov eax </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，[</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ebp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-0x4]</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:61039;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000010</font></font></nobr></div>
<div style="position:absolute;top:61039;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C9</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:61039;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">离开</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:61053;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000011</font></font></nobr></div>
<div style="position:absolute;top:61053;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C3</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:61053;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退回</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:61110;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在唯一的区别是我们实际上分配了一个局部变量</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my var</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是</font></font></nobr></div>
<div style="position:absolute;top:61128;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这引起了编译器的有趣响应。</font><font style="vertical-align: inherit;">和以前一样，堆栈框架是</font></font></nobr></div>
<div style="position:absolute;top:61146;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建立，但随后我们看到</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sub esp，字节+ 0x10</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它减去16（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）个字节</font></font></nobr></div>
<div style="position:absolute;top:61164;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从堆栈的顶部开始。</font><font style="vertical-align: inherit;">首先，我们必须（不断）提醒自己，堆栈</font></font></nobr></div>
<div style="position:absolute;top:61182;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在内存地址方面向下增长，因此在更简单的术语中，此指令</font></font></nobr></div>
<div style="position:absolute;top:61200;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">意思是“在栈的顶部再分配16个字节”。</font><font style="vertical-align: inherit;">我们正在存储一个</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即</font></font></nobr></div>
<div style="position:absolute;top:61218;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4字节（32位）数据类型，为什么要为此在堆栈上分配16个字节</font></font></nobr></div>
<div style="position:absolute;top:61235;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量，为什么不使用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">push</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它会自动分配新的堆栈空间？</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:61253;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编译器以这种方式操作堆栈的原因是优化之一，因为CPU</font></font></nobr></div>
<div style="position:absolute;top:61271;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常在未对齐内存边界的数据类型上效率较低</font></font></nobr></div>
<div style="position:absolute;top:61289;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是数据类型大小[？]的倍数。</font><font style="vertical-align: inherit;">由于C希望所有变量都正确</font></font></nobr></div>
<div style="position:absolute;top:61307;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对齐后，它将使用所有堆栈元素的最大数据类型宽度（即16个字节），位于</font></font></nobr></div>
<div style="position:absolute;top:61325;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浪费一些内存的成本。</font></font></nobr></div>
<div style="position:absolute;top:61343;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一条指令</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov dword [ebp-0x4]，0xbaba</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际上存储了我们变量的</font></font></nobr></div>
<div style="position:absolute;top:61361;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值在堆栈上新分配的空间中，但</font><font style="vertical-align: inherit;">对于以前的版本</font><font style="vertical-align: inherit;">，不使用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">push</font></font></font><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:61379;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给定的堆栈效率原因（即，存储的数据类型的大小小于堆栈的大小）</font></font></nobr></div>
<div style="position:absolute;top:61397;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预留空间）。</font><font style="vertical-align: inherit;">我们了解</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令</font><font style="vertical-align: inherit;">的一般用法</font><font style="vertical-align: inherit;">，但有两点</font></font></nobr></div>
<div style="position:absolute;top:61415;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里值得解释的是</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dword</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ebp-0x4]的使用</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></nobr></div>
<div style="position:absolute;top:61441;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dword</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明确表示我们在双字节上存储了一个双字（即4个字节）。</font></font></nobr></div>
<div style="position:absolute;top:61460;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈，即我们</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据类型</font><font style="vertical-align: inherit;">的大小</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，实际存储的字节将</font></font></nobr></div>
<div style="position:absolute;top:61478;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x0000baba</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但无需显式即可轻松为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xbaba</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（即2个字节）</font></font></nobr></div>
<div style="position:absolute;top:61495;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x000000000000baba</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（即8个字节），尽管值相同，但具有</font></font></nobr></div>
<div style="position:absolute;top:61513;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同的范围。</font></font></nobr></div>
<div style="position:absolute;top:61539;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ebp-0x4]</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是称为有效地址命令的现代CPU快捷方式的示例。</font></font></nobr></div>
<div style="position:absolute;top:61558;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示法[？]，汇编代码似乎可以反映出这一点。</font></font></nobr></div>
<div style="position:absolute;top:61576;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令的这一部分引用的地址是通过以下方式即时计算得出的：</font></font></nobr></div>
<div style="position:absolute;top:61594;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU，基于寄存器</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ebp</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的当前地址</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">乍一看，我们可能</font></font></nobr></div>
<div style="position:absolute;top:61612;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">认为我们的汇编器正在操纵一个常量值，就像我们写的那样</font></font></nobr></div>
<div style="position:absolute;top:61630;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">像这样的</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ax，0x5000 + 0x20</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们的汇编器只是</font></font></nobr></div>
<div style="position:absolute;top:61648;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将其预处理为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ax，0x5020</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，只有运行代码后，</font></font></nobr></div>
<div style="position:absolute;top:61666;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何寄存器的值都是已知的，因此这绝对不是预处理；</font><font style="vertical-align: inherit;">它形成一个</font></font></nobr></div>
<div style="position:absolute;top:61684;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU指令的一部分。</font><font style="vertical-align: inherit;">通过这种寻址方式，CPU允许</font></font></nobr></div>
<div style="position:absolute;top:61702;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在每个指令周期内要做更多的工作，这是CPU硬件如何运作的一个很好的例子</font></font></nobr></div>
<div style="position:absolute;top:61720;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已适应以更好地适合程序员。</font><font style="vertical-align: inherit;">我们可以写等价的，而无需</font></font></nobr></div>
<div style="position:absolute;top:61738;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在以下三行代码中，这种地址操纵效率较低：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:61773;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV EAX </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> EBP</font></font></nobr></div>
<div style="position:absolute;top:61773;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">EAX = EBP</font></font></nobr></div>
<div style="position:absolute;top:61787;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子eax </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x4</font></font></font></nobr></div>
<div style="position:absolute;top:61787;left:341"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">EAX = EAX-0x4</font></font></nobr></div>
<div style="position:absolute;top:61801;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eax </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]，0xbaba</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">将0xbaba存储在地址EAX</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:62013;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="50"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第50章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:62157;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:62178;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:62178;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">46</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:62212;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，值</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xbaba</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接存储到堆栈的适当位置，这样</font></font></nobr></div>
<div style="position:absolute;top:62230;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它会占据上方的前4个字节（尽管实际上位于下方，因为堆栈会增加</font></font></nobr></div>
<div style="position:absolute;top:62248;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向下）的基本指针。</font></font></nobr></div>
<div style="position:absolute;top:62266;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，作为计算机程序，我们的编译器可以将不同的数字区分为</font></font></nobr></div>
<div style="position:absolute;top:62284;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">很容易，因为我们可以区分不同的变量名，所以我们认为是变量</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:62303;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我的var </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，编译器会将其视为地址</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ebp-0x4 </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（即，</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:62320;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆）。</font><font style="vertical-align: inherit;">我们在下一条指令</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov eax，[ebp-0x4]中</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看到了这一点</font><font style="vertical-align: inherit;">，这基本上意味着，</font></font></nobr></div>
<div style="position:absolute;top:62338;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次使用有效的地址计算，</font><font style="vertical-align: inherit;">将</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我的var</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的内容存储</font><font style="vertical-align: inherit;">在</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eax中</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">；</font><font style="vertical-align: inherit;">和</font></font></nobr></div>
<div style="position:absolute;top:62356;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从上一个函数中我们知道</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eax</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于将变量返回给的调用者</font></font></nobr></div>
<div style="position:absolute;top:62373;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的职能。</font></font></nobr></div>
<div style="position:absolute;top:62391;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，在</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ret</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令</font><font style="vertical-align: inherit;">之前</font><font style="vertical-align: inherit;">，我们看到了一些新东西：</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请假</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令。</font></font></nobr></div>
<div style="position:absolute;top:62409;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际上，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请假</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令是以下步骤的替代方法：</font></font></nobr></div>
<div style="position:absolute;top:62427;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用者的原始堆栈，该函数的前两个指令的接收者：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:62458;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV ESP </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> EBP</font></font></nobr></div>
<div style="position:absolute;top:62458;left:310"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将堆栈放回找到的位置。</font></font></nobr></div>
<div style="position:absolute;top:62472;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流行音乐</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:62505;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然只有一条指令，但</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">离开</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并非总是如此，</font><font style="vertical-align: inherit;">效率更高</font></font></nobr></div>
<div style="position:absolute;top:62522;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是单独的说明[？]。</font><font style="vertical-align: inherit;">由于我们的编译器选择使用此指令，因此我们</font></font></nobr></div>
<div style="position:absolute;top:62540;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将把特定的讨论留给其他人。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:62588;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.3调用函数</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:62622;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们来看看图XXX中的C代码，它具有两个功能，其中一个功能，</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:62641;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用者函数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，调用另一个</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被调用</font><font style="vertical-align: inherit;">者函数</font><font color="#000000"><font style="vertical-align: inherit;">，并向其</font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递一个整数参数。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:62658;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被调用函数仅返回其传递的参数。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:62717;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">caller_function（）{</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:62731;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">callee_function（0xdede）;</font></font></nobr></div>
<div style="position:absolute;top:62745;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:62774;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">callee_function（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_arg）{</font></font></font></nobr></div>
<div style="position:absolute;top:62788;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_arg;</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:62802;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:62859;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们编译和反汇编C代码，我们将得到类似于</font></font></nobr></div>
<div style="position:absolute;top:62877;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图XXX。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:62936;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000000</font></font></nobr></div>
<div style="position:absolute;top:62936;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">55</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:62936;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">推ebp</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:62950;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000001</font></font></nobr></div>
<div style="position:absolute;top:62950;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">89E5</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:62950;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ebp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特别是</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:62964;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000003</font></font></nobr></div>
<div style="position:absolute;top:62964;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">83EC08</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:62964;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子esp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字节</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ 0x8</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:62978;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000006</font></font></nobr></div>
<div style="position:absolute;top:62978;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C70424DEDE0000</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:62978;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov dword </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> esp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]，0xdede</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:62993;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0000000D</font></font></nobr></div>
<div style="position:absolute;top:62993;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E802000000</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:62993;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼叫dword </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x14</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:63007;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000012</font></font></nobr></div>
<div style="position:absolute;top:63007;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C9</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:63007;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">离开</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:63021;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000013</font></font></nobr></div>
<div style="position:absolute;top:63021;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C3</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:63021;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退回</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:63035;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000014</font></font></nobr></div>
<div style="position:absolute;top:63035;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">55</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:63035;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">推ebp</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:63049;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000015</font></font></nobr></div>
<div style="position:absolute;top:63049;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">89E5</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:63049;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ebp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特别是</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:63064;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000017</font></font></nobr></div>
<div style="position:absolute;top:63064;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8B4508</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:63064;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov eax </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，[</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ebp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ 0x8]</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:63275;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="51"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第51章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:63419;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:63440;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:63440;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">47</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:63492;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0000001A</font></font></nobr></div>
<div style="position:absolute;top:63492;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5D</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:63492;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流行音乐</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:63506;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0000001B</font></font></nobr></div>
<div style="position:absolute;top:63506;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C3</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:63506;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退回</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:63562;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，请注意我们如何区分两个函数的汇编代码</font></font></nobr></div>
<div style="position:absolute;top:63579;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过查找</font><font style="vertical-align: inherit;">总是作为最后一条指令显示的讲解</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ret</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令</font></font></nobr></div>
<div style="position:absolute;top:63597;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能。</font><font style="vertical-align: inherit;">接下来，请注意上层函数如何使用汇编指令</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:63615;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们知道该方法用于跳转到另一个我们通常希望从中执行的例程</font></font></nobr></div>
<div style="position:absolute;top:63633;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回。</font><font style="vertical-align: inherit;">这必须是我们的</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用方函数</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即</font><font style="vertical-align: inherit;">在关闭时</font><font style="vertical-align: inherit;">调用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被调用</font></font></font><font style="vertical-align: inherit;"><font color="#2b57a3"><font style="vertical-align: inherit;">方函数</font></font></font></nobr></div>
<div style="position:absolute;top:63651;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">机器代码的</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x14</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这里最有趣的线是那些立即</font></font></nobr></div>
<div style="position:absolute;top:63669;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在调用之前，因为它们以某种方式确保了</font><font style="vertical-align: inherit;">传递</font><font style="vertical-align: inherit;">参数</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arg</font></font></font><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:63687;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被调用者函数</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">建立它的堆栈框架后，我们已经看到了</font></font></nobr></div>
<div style="position:absolute;top:63705;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mon对所有函数而言，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用者函数</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在堆栈的顶部分配8个字节（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sub</font></font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:63724;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp，byte + 0x8 </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），然后将传递的值</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xdede</font><font color="#000000"><font style="vertical-align: inherit;">存储</font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到该堆栈空间中（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mov dword</font></font></nobr></div>
<div style="position:absolute;top:63742;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[esp]，0xdede </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:63759;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，让我们看看</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被调用方函数</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何</font><font style="vertical-align: inherit;">访问该参数。</font><font style="vertical-align: inherit;">从偏移量</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x14开始</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们</font></font></nobr></div>
<div style="position:absolute;top:63777;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看到</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被调用方函数</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">像往常一样建立其堆栈框架，然后看一下它是什么</font></font></nobr></div>
<div style="position:absolute;top:63795;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eax</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寄存器中，我们从前面的分析中知道的寄存器用于</font></font></nobr></div>
<div style="position:absolute;top:63813;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保留函数的返回值：它存储地址</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ebp + 0x8]的内容</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这里，我们</font></font></nobr></div>
<div style="position:absolute;top:63831;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须再次提醒自己这个令人困惑的事实，即堆叠向下增长</font></font></nobr></div>
<div style="position:absolute;top:63848;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在内存中，因此就逻辑上更合理的向上增长堆栈而言，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ebp + 0x8</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font></nobr></div>
<div style="position:absolute;top:63866;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比我们的堆栈底部低8个字节，因此我们实际上正在进入堆栈的堆栈帧</font></font></nobr></div>
<div style="position:absolute;top:63884;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用我们以获取参数值的函数。</font><font style="vertical-align: inherit;">当然，这就是我们所期望的</font></font></nobr></div>
<div style="position:absolute;top:63902;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为调用者将该值放在栈顶，所以我们将栈底</font></font></nobr></div>
<div style="position:absolute;top:63920;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在他们的堆栈顶部以建立我们的堆栈框架。</font></font></nobr></div>
<div style="position:absolute;top:63938;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解任何高级语言组合使用的调用约定非常有用。</font></font></nobr></div>
<div style="position:absolute;top:63956;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇编程序中连接其代码时使用的堆积器。</font><font style="vertical-align: inherit;">例如，默认的调用约定</font></font></nobr></div>
<div style="position:absolute;top:63974;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C的作用是将参数以相反的顺序推入堆栈，因此第一个参数位于</font></font></nobr></div>
<div style="position:absolute;top:63992;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈的顶部。</font><font style="vertical-align: inherit;">混淆参数的顺序肯定会导致程序</font></font></nobr></div>
<div style="position:absolute;top:64010;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行不正确，并可能崩溃。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:64057;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.4指针，地址和数据</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:64091;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当使用高级语言工作时，我们很容易发现自己忘记了</font></font></nobr></div>
<div style="position:absolute;top:64109;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在足够的情况下，变量只是对分配的内存地址的引用</font></font></nobr></div>
<div style="position:absolute;top:64127;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已保留空间以适应其特定的数据类型。</font><font style="vertical-align: inherit;">这是因为</font></font></nobr></div>
<div style="position:absolute;top:64145;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在大多数情况下，当我们处理变量时，我们实际上只对值感兴趣</font></font></nobr></div>
<div style="position:absolute;top:64163;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是它们在内存中的位置。</font><font style="vertical-align: inherit;">考虑以下片段</font></font></nobr></div>
<div style="position:absolute;top:64181;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C代码：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:64210;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a = 3;</font></font></font></nobr></div>
<div style="position:absolute;top:64224;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b = 4;</font></font></font></nobr></div>
<div style="position:absolute;top:64238;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">total = a + b;</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:64269;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们对计算机的实际性能有了更多的了解</font></font></nobr></div>
<div style="position:absolute;top:64287;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些简单的C指令，我们可以很好地假设该指令</font></font></nobr></div>
<div style="position:absolute;top:64305;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tion </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int a = 3; </font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将涉及两个主要步骤：首先，将至少4个字节（32位）</font></font></nobr></div>
<div style="position:absolute;top:64323;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保留，也许在堆栈上，以保存该值；</font><font style="vertical-align: inherit;">然后，值</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将存储在</font></font></nobr></div>
<div style="position:absolute;top:64341;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保留地址。</font><font style="vertical-align: inherit;">第二行也是如此。</font><font style="vertical-align: inherit;">并在</font><font color="#2b57a3"><font style="vertical-align: inherit;">int</font></font><font style="vertical-align: inherit;">行</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:64537;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="52"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第52章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:64681;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:64702;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:64702;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">48</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:64737;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总数= a + b; </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，将为</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">total</font><font color="#000000"><font style="vertical-align: inherit;">保留更多的空间</font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且在其中</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:64754;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将存储由标签</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指向的地址内容的添加</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:64772;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，假设我们要在内存的特定地址存储一个值；</font><font style="vertical-align: inherit;">为了</font></font></nobr></div>
<div style="position:absolute;top:64790;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，就像我们在汇编中所做的一样，将字符直接写入视频内存</font></font></nobr></div>
<div style="position:absolute;top:64808;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当BIOS不再可用时，</font><font style="vertical-align: inherit;">在地址</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xb8000</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们将如何在C语言中做到这一点，</font></font></nobr></div>
<div style="position:absolute;top:64826;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们希望存储的任何值似乎必须位于一个已经存在的地址中时</font></font></nobr></div>
<div style="position:absolute;top:64844;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由编译器确定？</font><font style="vertical-align: inherit;">实际上，某些高级语言不允许我们访问</font></font></nobr></div>
<div style="position:absolute;top:64862;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以这种方式存储，根本上是打破了蓬松的抽象</font></font></nobr></div>
<div style="position:absolute;top:64880;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语。</font><font style="vertical-align: inherit;">幸运的是，C允许我们使用指针变量，这些变量是用于</font></font></nobr></div>
<div style="position:absolute;top:64897;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储地址（而不是值），并且我们可以取消引用以读取或写入</font></font></nobr></div>
<div style="position:absolute;top:64915;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据到他们指向的任何地方。</font></font></nobr></div>
<div style="position:absolute;top:64933;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，从技术上讲，所有指针变量都是相同的数据类型（例如32位内存）</font></font></nobr></div>
<div style="position:absolute;top:64951;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地址），但通常我们计划从该地址读写特定的数据类型</font></font></nobr></div>
<div style="position:absolute;top:64969;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由指针指向，所以我们告诉编译器，这是指向</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></nobr></div>
<div style="position:absolute;top:64987;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那是一个指向</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的指针</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这确实是一种方便，因此我们并不总是拥有</font></font></nobr></div>
<div style="position:absolute;top:65005;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">告诉编译器应该从保存在其中的地址读取和写入多少个字节</font></font></nobr></div>
<div style="position:absolute;top:65023;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一定的指针。</font><font style="vertical-align: inherit;">定义和使用指针的语法如图XXX所示。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:65082;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//这里，类型后面的星号表示这不是要保留的变量</font></font></nobr></div>
<div style="position:absolute;top:65097;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//一个字符（即一个字节），但指向一个字符的地址的指针，</font></font></nobr></div>
<div style="position:absolute;top:65111;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//作为地址，实际上至少需要分配</font></font></nobr></div>
<div style="position:absolute;top:65125;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">// 32位</font></font></nobr></div>
<div style="position:absolute;top:65139;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* video_address = 0xb8000;</font></font></font></nobr></div>
<div style="position:absolute;top:65168;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//如果我们想在指向的地址处存储一个字符，我们将</font></font></nobr></div>
<div style="position:absolute;top:65182;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//用星号前缀的指针变量赋值。</font></font></nobr></div>
<div style="position:absolute;top:65182;left:585"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这被称为</font></font></nobr></div>
<div style="position:absolute;top:65196;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//取消对指针的引用，因为我们不会更改其持有的地址</font></font></nobr></div>
<div style="position:absolute;top:65210;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//指针变量，但是该地址的内容。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:65224;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* video_address ='X';</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:65253;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//只是为了强调恒星的用途，是恒星的一种模样，例如：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:65267;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">video_address ='X';</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:65281;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//错误地将ASCII代码“ X”存储在指针变量中，</font></font></nobr></div>
<div style="position:absolute;top:65295;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//，以便以后可以将其解释为地址。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:65352;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在C代码中，我们经常看到</font><font style="vertical-align: inherit;">用于字符串的</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量。</font><font style="vertical-align: inherit;">让我们考虑一下为什么</font></font></nobr></div>
<div style="position:absolute;top:65370;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。</font><font style="vertical-align: inherit;">如果我们想存储一个</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么我们知道它们都是固定的</font></font></nobr></div>
<div style="position:absolute;top:65388;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大小的数据类型（即我们知道它们将使用多少个字节），但是字符串是一个数组</font></font></nobr></div>
<div style="position:absolute;top:65406;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据类型（通常为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的类型</font><font style="vertical-align: inherit;">，可以是任意长度。</font><font style="vertical-align: inherit;">因此，由于单一数据类型</font></font></nobr></div>
<div style="position:absolute;top:65424;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法容纳整个字符串，只能包含其中一个元素，我们可以使用指向</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的指针</font><font style="vertical-align: inherit;">，并且</font></font></nobr></div>
<div style="position:absolute;top:65442;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将其设置为字符串第一个字符的内存地址。</font><font style="vertical-align: inherit;">这实际上是什么</font></font></nobr></div>
<div style="position:absolute;top:65460;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在汇编程序中完成了工作，例如</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print string</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们在其中分配了一个字符串</font></font></nobr></div>
<div style="position:absolute;top:65477;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的字符（例如</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ Hello，World”</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）在我们代码中的某个位置，然后打印一个</font></font></nobr></div>
<div style="position:absolute;top:65495;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定的字符串，我们通过</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bx</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寄存器</font><font style="vertical-align: inherit;">传递了第一个字符的地址</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:65513;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们看一个设置字符串变量时编译器将执行的操作的示例。</font></font></nobr></div>
<div style="position:absolute;top:65531;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在图XXX中，我们定义了一个简单的函数，除了分配一个</font></font></nobr></div>
<div style="position:absolute;top:65549;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串到变量。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:65799;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="53"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第53章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:65943;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:65964;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:65964;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">49</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:66025;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无效的</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_function（）{</font></font></font></nobr></div>
<div style="position:absolute;top:66039;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* my_string =“你好”;</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:66054;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:66108;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和以前一样，我们可以分解以得到如图XXX所示的内容。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:66165;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000000</font></font></nobr></div>
<div style="position:absolute;top:66165;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">55</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:66165;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">推ebp</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:66179;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000001</font></font></nobr></div>
<div style="position:absolute;top:66179;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">89E5</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:66179;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ebp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特别是</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:66193;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000003</font></font></nobr></div>
<div style="position:absolute;top:66193;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">83EC10</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:66193;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子esp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字节</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ 0x10</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:66207;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000006</font></font></nobr></div>
<div style="position:absolute;top:66207;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C745FA48656C6C</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:66207;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov dword </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ebp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-0x6]，0x6c6c6548</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:66221;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0000000D</font></font></nobr></div>
<div style="position:absolute;top:66221;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">66C745FE6F00</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:66221;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov字</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ebp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-0x2]，0x6f</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:66236;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000013</font></font></nobr></div>
<div style="position:absolute;top:66236;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C9</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:66236;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">离开</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:66250;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000014</font></font></nobr></div>
<div style="position:absolute;top:66250;left:250"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C3</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:66250;left:387"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退回</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:66304;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，要获取我们的轴承，我们需要寻找</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ret</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令，这标志着</font><font style="vertical-align: inherit;">轴承</font><font style="vertical-align: inherit;">的结束。</font></font></nobr></div>
<div style="position:absolute;top:66322;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能。</font><font style="vertical-align: inherit;">我们看到函数的前两个指令设置了堆栈框架，</font></font></nobr></div>
<div style="position:absolute;top:66340;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">照常。</font><font style="vertical-align: inherit;">下一条指令（我们之前也看到过）</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sub esp，byte + 0x10</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:66358;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在堆栈上分配16个字节来存储我们的局部变量。</font><font style="vertical-align: inherit;">现在，下一条指令</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:66377;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov dword [ebp-0x4]，0xf</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该有一个熟悉的形式，因为它在我们的计算机中存储了一个值</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:66394;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多变的; </font><font style="vertical-align: inherit;">但是为什么它存储数字</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xf</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ---我们没有告诉它这样做，对吗？</font></font></nobr></div>
<div style="position:absolute;top:66411;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储此可疑值后，我们看到函数politley将堆栈还原为</font></font></nobr></div>
<div style="position:absolute;top:66429;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼叫者堆栈帧（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），则返回（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RET</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">但请看，还有五条指令</font></font></nobr></div>
<div style="position:absolute;top:66447;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能结束后！</font><font style="vertical-align: inherit;">您认为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dec eax</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令</font><font style="vertical-align: inherit;">在做什么？</font></font></nobr></div>
<div style="position:absolute;top:66465;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也许它将</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eax</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值减少</font><font style="vertical-align: inherit;">1，但是为什么呢？</font><font style="vertical-align: inherit;">那其余的呢</font></font></nobr></div>
<div style="position:absolute;top:66483;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示？</font></font></nobr></div>
<div style="position:absolute;top:66501;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，我们需要进行完整性检查，并记住：反汇编程序</font></font></nobr></div>
<div style="position:absolute;top:66519;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法区分代码和数据；</font><font style="vertical-align: inherit;">该代码中的某处必须是数据</font></font></nobr></div>
<div style="position:absolute;top:66537;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于我们定义的字符串。</font><font style="vertical-align: inherit;">现在，我们知道我们的功能包括</font></font></nobr></div>
<div style="position:absolute;top:66555;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码，因为这些说明对我们有意义，所以它们以</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ret</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结尾</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果我们现在</font></font></nobr></div>
<div style="position:absolute;top:66573;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设代码的其余部分实际上是我们的数据，则可疑值</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xf</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示</font></font></nobr></div>
<div style="position:absolute;top:66591;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被存储在我们的变量中是有道理的，因为它是从代码开始的偏移量</font></font></nobr></div>
<div style="position:absolute;top:66609;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到数据开始的位置：正在将我们的指针变量设置为数据的地址。</font></font></nobr></div>
<div style="position:absolute;top:66627;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了保证我们的直觉，如果我们在ASCII表中查找字符的值，</font></font></nobr></div>
<div style="position:absolute;top:66645;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'你好'</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们会发现他们是</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x48</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x65</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x6c</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x6c</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x6f</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">现在它</font></font></nobr></div>
<div style="position:absolute;top:66663;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之所以变得清晰，是因为如果我们查看反汇编程序输出的中间列，</font></font></nobr></div>
<div style="position:absolute;top:66680;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看到这些是那些似乎没有出现的奇怪指令的机器代码字节</font></font></nobr></div>
<div style="position:absolute;top:66698;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">讲得通 </font><font style="vertical-align: inherit;">我们还看到最后一个字节是</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x0</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，C会自动将其添加到</font></font></nobr></div>
<div style="position:absolute;top:66716;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串的末尾，因此，就像在我们的汇编例程中</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印字符串一样</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在处理过程中</font></font></nobr></div>
<div style="position:absolute;top:66734;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以轻松确定何时到达字符串末尾。</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:66786;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2执行我们的内核代码</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:66829;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">理论足够了，让我们启动并执行最简单的用C编写的内核。这一步</font></font></nobr></div>
<div style="position:absolute;top:66847;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将使用到目前为止所学的知识，并为加快开发进度铺平道路</font></font></nobr></div>
<div style="position:absolute;top:66865;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的操作系统的功能。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:67061;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="54"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第54章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:67205;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:67226;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:67226;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:67260;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">涉及的步骤如下：</font></font></nobr></div>
<div style="position:absolute;top:67286;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•编写和编译内核代码。</font></font></nobr></div>
<div style="position:absolute;top:67312;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•编写并汇编引导扇区代码</font></font></nobr></div>
<div style="position:absolute;top:67339;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•创建一个内核映像，该映像不仅包括我们的引导扇区，还包括我们的已编译</font></font></nobr></div>
<div style="position:absolute;top:67357;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核代码</font></font></nobr></div>
<div style="position:absolute;top:67383;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•将我们的内核代码加载到内存中</font></font></nobr></div>
<div style="position:absolute;top:67410;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•切换到32位保护模式</font></font></nobr></div>
<div style="position:absolute;top:67436;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•开始执行我们的内核代码</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:67484;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.1编写我们的内核</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:67518;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这不会花很长时间，因为目前我们内核的主要功能还很薄弱</font></font></nobr></div>
<div style="position:absolute;top:67536;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是为了让我们知道它已成功加载并执行。</font><font style="vertical-align: inherit;">我们可以详细说明</font></font></nobr></div>
<div style="position:absolute;top:67554;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核，因此从一开始就使事情变得简单很重要。</font><font style="vertical-align: inherit;">保存图中的代码</font></font></nobr></div>
<div style="position:absolute;top:67572;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XXX进入名为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.c</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的文件</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:67631;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main（）{</font></font></font></nobr></div>
<div style="position:absolute;top:67645;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//创建一个指向char的指针，并将其指向的第一个文本单元格</font></font></nobr></div>
<div style="position:absolute;top:67659;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//视频内存（即屏幕的左上角）</font></font></nobr></div>
<div style="position:absolute;top:67674;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* video_memory =（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> char </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*）0xb8000;</font></font></font></nobr></div>
<div style="position:absolute;top:67688;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//在video_memory指向的地址上，存储字符“ X”</font></font></nobr></div>
<div style="position:absolute;top:67702;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//（即在屏幕的左上角显示“ X”）。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:67716;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* video_memory ='X';</font></font></nobr></div>
<div style="position:absolute;top:67730;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:67786;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将其编译为原始二进制文件，如下所示：</font></font></nobr></div>
<div style="position:absolute;top:67814;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ gcc -ffreestanding -c kernel.c -o kernel.o</font></font></nobr></div>
<div style="position:absolute;top:67832;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ ld -o kernel.bin -Ttext 0x1000 kernel.o --oformat二进制文件</font></font></nobr></div>
<div style="position:absolute;top:67857;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，现在，我们告诉链接器，一旦将代码加载到我们的代码中</font></font></nobr></div>
<div style="position:absolute;top:67875;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存将为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x1000</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此它知道从此起点偏移本地地址引用，</font></font></nobr></div>
<div style="position:absolute;top:67893;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就像我们</font><font style="vertical-align: inherit;">在引导区中</font><font style="vertical-align: inherit;">使用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[org 0x7c00]一样</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为这是BIOS加载和</font></font></nobr></div>
<div style="position:absolute;top:67911;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后开始执行它。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:67958;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.2创建一个引导扇区来引导我们</font></font></nobr></div>
<div style="position:absolute;top:67985;left:233"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:68019;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们现在要写一个引导扇区，该引导扇区必须进行引导（即加载并开始</font></font></nobr></div>
<div style="position:absolute;top:68037;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从磁盘执行）我们的内核。</font><font style="vertical-align: inherit;">由于内核被编译为32位指令，</font></font></nobr></div>
<div style="position:absolute;top:68055;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在执行内核之前，我们将不得不切换到32位保护模式</font></font></nobr></div>
<div style="position:absolute;top:68073;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码。</font><font style="vertical-align: inherit;">我们知道BIOS将仅加载我们的引导扇区（即BIOS的前512个字节）。</font></font></nobr></div>
<div style="position:absolute;top:68091;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘），而不是我们的内核（当计算机启动时），但是在第XXX节中，我们已经看到</font></font></nobr></div>
<div style="position:absolute;top:68109;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何使用BIOS磁盘例程使引导扇区加载其他扇区</font></font></nobr></div>
<div style="position:absolute;top:68127;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从磁盘上，我们隐约意识到，在切换到保护模式后，</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:68323;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="55"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第55章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:68467;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:68488;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:68488;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">51</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:68522;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缺少BIOS将使我们难以使用磁盘：我们将不得不写一张软盘</font></font></nobr></div>
<div style="position:absolute;top:68540;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还是我们自己的硬盘驱动器！</font></font></nobr></div>
<div style="position:absolute;top:68558;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了简化从哪个磁盘和从哪个扇区加载内核代码的问题，</font></font></nobr></div>
<div style="position:absolute;top:68576;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统的引导扇区和内核可以嫁接到一个内核中</font></font></nobr></div>
<div style="position:absolute;top:68594;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映像，可以将其写入启动磁盘的初始扇区，以便启动</font></font></nobr></div>
<div style="position:absolute;top:68612;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扇区代码始终位于内核映像的开头。</font><font style="vertical-align: inherit;">一旦我们编译了引导</font></font></nobr></div>
<div style="position:absolute;top:68630;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节中描述的扇区，我们可以使用以下文件创建内核映像</font></font></nobr></div>
<div style="position:absolute;top:68648;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串联命令：</font></font></nobr></div>
<div style="position:absolute;top:68675;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat boot sect.bin kernel.bin&gt;操作系统映像</font></font></nobr></div>
<div style="position:absolute;top:68701;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图XXX显示了一个引导扇区，它将从包含以下内容的磁盘引导我们的内核</font></font></nobr></div>
<div style="position:absolute;top:68718;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的内核映像</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">os-image</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:68777;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在32位保护模式下引导C内核的引导扇区</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:68792;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">org</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0x7c00]</font></font></nobr></div>
<div style="position:absolute;top:68806;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KERNEL_OFFSET </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EQU</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为0x1000</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:68806;left:372"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">这是我们将内核加载到的内存偏移量</font></font></nobr></div>
<div style="position:absolute;top:68834;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[BOOT_DRIVE]，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dl; </font><font style="vertical-align: inherit;">BIOS将我们的启动驱动器存储在DL中，因此</font></font></nobr></div>
<div style="position:absolute;top:68848;left:349"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">最好记住这一点以备后用。</font></font></nobr></div>
<div style="position:absolute;top:68877;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov bp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x9000</font></font></font></nobr></div>
<div style="position:absolute;top:68877;left:349"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">设置堆栈。</font></font></nobr></div>
<div style="position:absolute;top:68891;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV SP </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> BP</font></font></nobr></div>
<div style="position:absolute;top:68919;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，MSG_REAL_MODE</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">宣布我们开始</font></font></nobr></div>
<div style="position:absolute;top:68933;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼叫</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_string</font></font></font></nobr></div>
<div style="position:absolute;top:68933;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">从16位实模式启动</font></font></nobr></div>
<div style="position:absolute;top:68962;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">load_kernel</font></font></font></nobr></div>
<div style="position:absolute;top:68962;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">加载我们的内核</font></font></nobr></div>
<div style="position:absolute;top:68990;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致电</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">switch_to_pm</font></font></font></nobr></div>
<div style="position:absolute;top:68990;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">切换到保护模式，从</font></font></nobr></div>
<div style="position:absolute;top:69004;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">我们不会回来</font></font></nobr></div>
<div style="position:absolute;top:69033;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></font></nobr></div>
<div style="position:absolute;top:69061;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">包括我们有用的，来之不易的例程</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:69075;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ print / print_string.asm”</font></font></nobr></div>
<div style="position:absolute;top:69090;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ disk / disk_load.asm”</font></font></nobr></div>
<div style="position:absolute;top:69104;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ pm / gdt.asm”</font></font></nobr></div>
<div style="position:absolute;top:69118;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ pm / print_string_pm.asm”</font></font></nobr></div>
<div style="position:absolute;top:69132;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ pm / switch_to_pm.asm”</font></font></nobr></div>
<div style="position:absolute;top:69161;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[位16]</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:69189;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">load_kernel</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:69203;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">load_kernel：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:69217;left:197"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，MSG_LOAD_KERNEL</font></font></font></nobr></div>
<div style="position:absolute;top:69217;left:395"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">打印一条消息说我们正在加载内核</font></font></nobr></div>
<div style="position:absolute;top:69232;left:197"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼叫</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_string</font></font></font></nobr></div>
<div style="position:absolute;top:69260;left:197"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov bx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，KERNEL_OFFSET</font></font></font></nobr></div>
<div style="position:absolute;top:69260;left:395"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">我们disk_load例程的设置参数，因此</font></font></nobr></div>
<div style="position:absolute;top:69274;left:197"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动作dh </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，15</font></font></font></nobr></div>
<div style="position:absolute;top:69274;left:395"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">我们加载了前15个扇区（不包括</font></font></nobr></div>
<div style="position:absolute;top:69288;left:197"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov dl </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，[BOOT_DRIVE]</font></font></font></nobr></div>
<div style="position:absolute;top:69288;left:395"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">引导磁盘（即我们的引导扇区）</font></font></nobr></div>
<div style="position:absolute;top:69303;left:197"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼叫</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disk_load</font></font></font></nobr></div>
<div style="position:absolute;top:69303;left:395"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></nobr></div>
<div style="position:absolute;top:69303;left:418"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核代码）以解决KERNEL_OFFSET</font></font></nobr></div>
<div style="position:absolute;top:69331;left:197"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退回</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:69359;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[位32]</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:69374;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">这是我们切换到并初始化保护模式之后到达的地方。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:69585;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="56"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第56章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:69729;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:69750;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:69750;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">52</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:69802;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BEGIN_PM：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:69831;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov ebx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，MSG_PROT_MODE</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">；</font><font style="vertical-align: inherit;">使用我们的32位打印例程</font></font></nobr></div>
<div style="position:absolute;top:69845;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致电</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_string_pm</font></font></font></nobr></div>
<div style="position:absolute;top:69845;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">宣布我们处于保护模式</font></font></nobr></div>
<div style="position:absolute;top:69873;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致电</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KERNEL_OFFSET</font></font></font></nobr></div>
<div style="position:absolute;top:69873;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">现在跳转到我们加载的地址</font></font></nobr></div>
<div style="position:absolute;top:69887;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">内核代码，假定大括号的位置，</font></font></nobr></div>
<div style="position:absolute;top:69902;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">并交叉手指。</font><font style="vertical-align: inherit;">开始了！</font></font></nobr></div>
<div style="position:absolute;top:69930;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></font></nobr></div>
<div style="position:absolute;top:69930;left:364"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">悬挂。</font></font></nobr></div>
<div style="position:absolute;top:69973;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">全局变量</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:69987;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BOOT_DRIVE</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:69987;left:296"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分贝</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:70001;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSG_REAL_MODE</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:70001;left:296"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“以16位实模式启动”，0</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:70015;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSG_PROT_MODE</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:70015;left:296"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“成功进入32位保护模式”，0</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:70029;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSG_LOAD_KERNEL </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> “正在将内核加载到内存中。”，0</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:70058;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">引导区填充</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:70072;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">倍510-（$-$$）</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:70086;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dw </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xaa55</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:70143;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Bochs中运行此命令之前，请确保Bochs配置文件具有</font></font></nobr></div>
<div style="position:absolute;top:70161;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将启动磁盘设置为您的内核映像文件，如图XXX所示。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:70220;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">floppya：1_44 = os-image，状态=已插入</font></font></nobr></div>
<div style="position:absolute;top:70234;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">靴子：一个</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:70291;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可能想知道的一个问题是，为什么我们要加载多达15个细分</font></font></nobr></div>
<div style="position:absolute;top:70309;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（即512 * 15字节）来自启动磁盘，此时我们的内核映像远小于</font></font></nobr></div>
<div style="position:absolute;top:70327;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这; </font><font style="vertical-align: inherit;">实际上它的大小小于一个扇区，因此要加载1个扇区就可以了</font></font></nobr></div>
<div style="position:absolute;top:70345;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作。</font><font style="vertical-align: inherit;">原因很简单，阅读这些其他扇区不会有任何伤害</font></font></nobr></div>
<div style="position:absolute;top:70363;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从磁盘，即使它们尚未用数据初始化，但在使用时可能会造成伤害</font></font></nobr></div>
<div style="position:absolute;top:70380;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">试图在以后添加时检测到此阶段我们没有读取足够的扇区</font></font></nobr></div>
<div style="position:absolute;top:70398;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从而增加我们的内核代码（计算机）的内存占用空间</font></font></nobr></div>
<div style="position:absolute;top:70416;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会在没有警告的情况下挂起，也许只是在一个</font></font></nobr></div>
<div style="position:absolute;top:70434;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卸载扇区边界---一个丑陋的bug。</font></font></nobr></div>
<div style="position:absolute;top:70452;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">祝贺您在屏幕的左上角显示了“ X”，因为</font></font></nobr></div>
<div style="position:absolute;top:70470;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管对普通计算机用户而言毫无意义，但这意味着</font></font></nobr></div>
<div style="position:absolute;top:70488;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们从哪里开始：我们现在已经引导进入更高级别的语言，并且可以开始</font></font></nobr></div>
<div style="position:absolute;top:70506;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不用担心汇编代码，而更多地关注我们自己将如何</font></font></nobr></div>
<div style="position:absolute;top:70524;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当然，我想开发我们的操作系统，并了解更多有关C的知识；</font><font style="vertical-align: inherit;">但</font></font></nobr></div>
<div style="position:absolute;top:70542;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是学习C的最好方法：将C视作一种高级语言而不是</font></font></nobr></div>
<div style="position:absolute;top:70560;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从更高抽象的角度来看它，例如Java</font></font></nobr></div>
<div style="position:absolute;top:70578;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或脚本语言（例如Python，PHP等）。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:70847;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="57"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第57页</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:70991;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:71012;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:71012;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">53</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:71041;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.3进入内核</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:71076;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从一个非常简单的内核开始绝对是一个好主意，但是通过这样做，我们</font></font></nobr></div>
<div style="position:absolute;top:71094;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">忽略了一个潜在的问题：引导内核时，我们不计后果地跳了进去，然后</font></font></nobr></div>
<div style="position:absolute;top:71111;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此从内核代码的第一条指令开始执行；</font><font style="vertical-align: inherit;">但是我们看到了</font></font></nobr></div>
<div style="position:absolute;top:71129;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XXX节C编译器如何决定将代码和数据放置在任何地方</font></font></nobr></div>
<div style="position:absolute;top:71147;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在输出文件中。</font><font style="vertical-align: inherit;">由于我们的简单内核只有一个功能，因此基于</font></font></nobr></div>
<div style="position:absolute;top:71165;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前关于编译器如何生成机器代码的说法，我们可能会假设</font></font></nobr></div>
<div style="position:absolute;top:71183;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一条机器代码指令是内核入口函数的第一条指令，</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:71202;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但假设我们的内核代码如图XXX所示。</font></font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:71258;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无效</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">some_function（）{</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:71272;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:71300;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main（）{</font></font></font></nobr></div>
<div style="position:absolute;top:71315;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* video_memory = 0xb8000;</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:71329;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* video_memory ='X';</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:71343;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//调用一些函数</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:71357;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">some_function（）;</font></font></nobr></div>
<div style="position:absolute;top:71371;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:71425;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，编译器可能会在预期入口函数的指令之前</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:71445;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主要</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">某些功能组成</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且由于我们的引导程序代码将开始执行</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:71461;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">盲目地从第一条指令开始，它将击中</font><font color="#2b57a3"><font style="vertical-align: inherit;">某个功能</font></font><font style="vertical-align: inherit;">的第一条</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ret</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"></font></font></nobr></div>
<div style="position:absolute;top:71479;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并返回到引导扇区代码，而无需输入</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">问题</font></font></nobr></div>
<div style="position:absolute;top:71497;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就是说，在正确的位置进入我们的内核太依赖于</font></font></nobr></div>
<div style="position:absolute;top:71515;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核源代码中的元素（例如函数）以及编译器的异想天开</font></font></nobr></div>
<div style="position:absolute;top:71533;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和链接器，因此我们需要使其更强大。</font></font></nobr></div>
<div style="position:absolute;top:71551;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">许多操作系统用来正确输入内核的技巧是编写一个</font></font></nobr></div>
<div style="position:absolute;top:71569;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常简单的汇编例程，该例程始终附加到内核计算机的启动位置</font></font></nobr></div>
<div style="position:absolute;top:71587;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码，其唯一目的是调用内核的入口函数。</font><font style="vertical-align: inherit;">原因</font></font></nobr></div>
<div style="position:absolute;top:71605;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之所以使用汇编语言，是因为我们确切地知道它将如何在机器代码中进行翻译，</font></font></nobr></div>
<div style="position:absolute;top:71623;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，我们可以确保第一条指令最终会导致内核的</font></font></nobr></div>
<div style="position:absolute;top:71641;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">达到输入功能。</font></font></nobr></div>
<div style="position:absolute;top:71658;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是链接器如何工作的一个很好的例子，因为我们还没有真正利用过</font></font></nobr></div>
<div style="position:absolute;top:71676;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个重要的工具呢。</font><font style="vertical-align: inherit;">链接器将目标文件作为输入，然后将它们连接在一起，</font></font></nobr></div>
<div style="position:absolute;top:71694;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但会将所有标签解析为正确的地址。</font><font style="vertical-align: inherit;">例如，如果一个目标文件有一个</font></font></nobr></div>
<div style="position:absolute;top:71712;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一段代码调用一个函数，</font><font style="vertical-align: inherit;">另一个对象中定义了</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">某个函数</font></font></font><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:71730;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件，然后将目标文件的代码物理链接到一个文件中之后，</font></font></nobr></div>
<div style="position:absolute;top:71748;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签：code：'some function'将解析为该特定位置的偏移量</font></font></nobr></div>
<div style="position:absolute;top:71766;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例程最终出现在组合代码中。</font></font></nobr></div>
<div style="position:absolute;top:71784;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图XXX显示了一个用于进入内核的简单汇编例程。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:71841;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">确保我们直接跳入内核的入口函数。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:71855;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[位32]</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:71855;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">到目前为止，我们处于保护模式，因此请使用32位指令。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:71869;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[外部主要]</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:71869;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">声明我们将引用外部符号“ main”，</font></font></nobr></div>
<div style="position:absolute;top:71883;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">因此链接器可以替换最终地址</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:72109;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="58"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第58章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:72253;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:72274;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:72274;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">54</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:72326;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致电</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主要</font></font></font></nobr></div>
<div style="position:absolute;top:72326;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在我们的C内核中调用main（）</font></font></nobr></div>
<div style="position:absolute;top:72340;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></font></nobr></div>
<div style="position:absolute;top:72340;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">当我们从内核返回时，永久挂起</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:72397;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以从主线</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用中</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看到，代码只是调用了一个</font></font></nobr></div>
<div style="position:absolute;top:72415;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的名字命名</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此代码中不作为标签存在，因为它是</font></font></nobr></div>
<div style="position:absolute;top:72433;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预期存在于其他目标文件之一中，以便将其解析为</font></font></nobr></div>
<div style="position:absolute;top:72451;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接时的正确地址；</font><font style="vertical-align: inherit;">此期望由指令</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[extern</font></font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:72470;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main] </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，位于文件顶部，如果找不到该标签，则链接器将失败。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:72487;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前我们将程序集编译为原始二进制格式，因为我们希望</font></font></nobr></div>
<div style="position:absolute;top:72505;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将其作为启动扇区代码在CPU上运行，但是对于这段代码来说，它不能独立存在，</font></font></nobr></div>
<div style="position:absolute;top:72522;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有解析该标签，因此我们必须将其编译为目标文件，如下所示：</font></font></nobr></div>
<div style="position:absolute;top:72540;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，保留有关标签必须解析的元信息：</font></font></nobr></div>
<div style="position:absolute;top:72569;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ nasm内核entry.asm -f elf -o内核entry.o</font></font></nobr></div>
<div style="position:absolute;top:72594;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-f elf</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">告诉汇编器输出特定对象的目标文件</font></font></nobr></div>
<div style="position:absolute;top:72612;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式可执行和链接格式（ELF），这是由以下程序输出的默认格式</font></font></nobr></div>
<div style="position:absolute;top:72630;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出C编译器。</font></font></nobr></div>
<div style="position:absolute;top:72648;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，</font><font color="#2b57a3"><font style="vertical-align: inherit;">只需</font></font><font style="vertical-align: inherit;">简单地将</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.o</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件与其自身</font><font style="vertical-align: inherit;">链接</font><font style="vertical-align: inherit;">以创建</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.bin</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:72666;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以将其与</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核entry.o</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接起来</font><font style="vertical-align: inherit;">，如下所示：</font></font></nobr></div>
<div style="position:absolute;top:72694;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ ld -o kernel.bin -Ttext 0x1000内核入口.o kernel.o --oformat二进制文件</font></font></nobr></div>
<div style="position:absolute;top:72720;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接器尊重我们在命令行上提供给它的文件的顺序，例如</font></font></nobr></div>
<div style="position:absolute;top:72738;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确保前面的命令将确保我们的</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核entry.o</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将位于代码之前</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:72757;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.o </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:72774;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和以前一样，我们可以使用以下命令重建内核映像文件：</font></font></nobr></div>
<div style="position:absolute;top:72802;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat boot sect.bin kernel.bin&gt;操作系统映像</font></font></nobr></div>
<div style="position:absolute;top:72827;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们可以在Bochs中对此进行测试，但是可以放心的是，我们的引导块将</font></font></nobr></div>
<div style="position:absolute;top:72845;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到进入我们内核正确入口点的方式。</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:72898;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3使用Make自动化构建</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:72941;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到现在为止，您应该每次都不得不重新键入很多命令的时候就已经受够了</font></font></nobr></div>
<div style="position:absolute;top:72959;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改一段代码，以获取有关您尝试的更正或新想法的反馈。</font></font></nobr></div>
<div style="position:absolute;top:72977;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同样，程序员曾经来过这里，并且已经开发了许多工具</font></font></nobr></div>
<div style="position:absolute;top:72995;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于自动化软件的构建过程。</font><font style="vertical-align: inherit;">在这里，我们将考虑</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这是</font></font></nobr></div>
<div style="position:absolute;top:73013;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其中许多其他构建工具的前身，以及用于构建的工具</font></font></nobr></div>
<div style="position:absolute;top:73031;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他操作系统和应用程序，Linux和Minix。</font><font style="vertical-align: inherit;">的基本原理</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">化妆</font></font></font></nobr></div>
<div style="position:absolute;top:73048;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是我们在配置文件（通常称为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Makefile</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）中指定如何转换一个</font></font></nobr></div>
<div style="position:absolute;top:73066;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件转换为另一个文件，这样一个文件的生成可以描述为取决于</font></font></nobr></div>
<div style="position:absolute;top:73084;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存在一个或多个其他文件。</font><font style="vertical-align: inherit;">例如，我们可以在</font></font></nobr></div>
<div style="position:absolute;top:73102;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Makefile，它将告诉</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确切如何将C文件编译为目标文件：</font></font></nobr></div>
<div style="position:absolute;top:73130;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.o：kernel.c</font></font></nobr></div>
<div style="position:absolute;top:73148;left:265"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc -ffreestanding -c kernel.c -o kernel.o</font></font></nobr></div>
<div style="position:absolute;top:73174;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样做的好处是，我们现在可以在与Makefile相同的目录中键入：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:73371;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="59"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第59章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:73515;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:73536;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:73536;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">55</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:73571;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ make kernel.o</font></font></nobr></div>
<div style="position:absolute;top:73597;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅当</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.o</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不存在或具有</font></font></nobr></div>
<div style="position:absolute;top:73615;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件修改时间比</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.c更早</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是只有当我们添加服务器间</font></font></nobr></div>
<div style="position:absolute;top:73633;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们了解</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依赖规则</font><font style="vertical-align: inherit;">可以真正帮助我们节省时间和不必要的</font></font></nobr></div>
<div style="position:absolute;top:73651;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令执行。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:73710;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃构建内核二进制文件</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:73724;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.bin：kernel_entry.o kernel.o</font></font></nobr></div>
<div style="position:absolute;top:73739;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ld -o kernel.bin -Ttext 0x1000 kernel_entry.o kernel.o --oformat二进制文件</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:73767;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃构建内核目标文件</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:73781;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.o：kernel.c</font></font></nobr></div>
<div style="position:absolute;top:73795;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc -ffreestanding -c kernel.c -o kernel.o</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:73824;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃构建内核入口对象文件。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:73838;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel_entry.o：kernel_entry.asm</font></font></nobr></div>
<div style="position:absolute;top:73852;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nasm kernel_entry.asm -f elf -o kernel_entry.o</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:73909;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们</font><font style="vertical-align: inherit;">使用图XXX中的Makefile</font><font style="vertical-align: inherit;">运行</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make kernel.bin</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将知道</font></font></nobr></div>
<div style="position:absolute;top:73927;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在运行命令生成</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.bin之前</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它必须先构建两个</font></font></nobr></div>
<div style="position:absolute;top:73945;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依赖性，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.o</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核entry.o</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，从他们的源文件，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.c</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:73964;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核entry.asm </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在其运行的命令的以下输出中：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:73991;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nasm内核entry.asm -f elf -o内核entry.o</font></font></nobr></div>
<div style="position:absolute;top:74009;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc -ffreestanding -c kernel.c -o kernel.o</font></font></nobr></div>
<div style="position:absolute;top:74027;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ld -o kernel.bin -Ttext 0x1000内核入口.o kernel.o --oformat二进制文件</font></font></nobr></div>
<div style="position:absolute;top:74052;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，如果</font><font style="vertical-align: inherit;">再次</font><font style="vertical-align: inherit;">运行</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们将看到make报告构建目标</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:74071;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.bin</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是最新的。</font><font style="vertical-align: inherit;">但是，如果我们修改，例如</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.c </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，将其保存，然后运行</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make</font></font></nobr></div>
<div style="position:absolute;top:74089;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.bin </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们将看到</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make</font><font color="#000000"><font style="vertical-align: inherit;">只能运行必要的命令</font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:74116;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc -ffreestanding -c kernel.c -o kernel.o</font></font></nobr></div>
<div style="position:absolute;top:74134;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ld -o kernel.bin -Ttext 0x1000内核入口.o kernel.o --oformat二进制文件</font></font></nobr></div>
<div style="position:absolute;top:74160;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了减少我们Makefile的重复并因此简化维护，</font></font></nobr></div>
<div style="position:absolute;top:74178;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用特殊的makefile变量</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ &lt;</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ @</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ ^</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如图XXX所示。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:74237;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃$ ^被目标的所有依赖文件替换</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:74251;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.bin：kernel_entry.o kernel.o</font></font></nobr></div>
<div style="position:absolute;top:74266;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ld -o kernel.bin -Ttext 0x1000 $ ^ --oformat二进制文件</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:74294;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃$ &lt;是第一个依赖项，$ @是目标文件</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:74308;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.o：kernel.c</font></font></nobr></div>
<div style="position:absolute;top:74322;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc -ffreestanding -c $ &lt;-o </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ @</font></font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:74351;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃与上述规则相同。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:74365;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel_entry.o：kernel_entry.asm</font></font></nobr></div>
<div style="position:absolute;top:74379;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nasm $ &lt;-f elf -o </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ @</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:74633;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="60"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第60话</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:74777;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:74798;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:74798;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">56</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:74832;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定实际上不是真正目标的目标通常很有用，因为它们确实</font></font></nobr></div>
<div style="position:absolute;top:74850;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法生成文件。</font><font style="vertical-align: inherit;">这样的音位目标的常见用法是制定一个</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">干净的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标，因此</font></font></nobr></div>
<div style="position:absolute;top:74868;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们运行</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make clean时</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所有生成的文件将从目录中删除，</font></font></nobr></div>
<div style="position:absolute;top:74886;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅保留源文件，如图XXX所示。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:74945;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">干净的：</font></font></nobr></div>
<div style="position:absolute;top:74959;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rm * .bin * .o</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:75016;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您只想分发目录，则以这种方式清理目录非常有用。</font></font></nobr></div>
<div style="position:absolute;top:75034;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源文件给朋友，将目录置于版本控制下，或者如果您想测试</font></font></nobr></div>
<div style="position:absolute;top:75052;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对makefile的修改将正确地从头开始构建所有目标。</font></font></nobr></div>
<div style="position:absolute;top:75070;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font><font style="vertical-align: inherit;">运行</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make时</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有目标，则将主文件中的第一个目标作为目标。</font></font></nobr></div>
<div style="position:absolute;top:75088;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，因此您通常会</font><font style="vertical-align: inherit;">在Makefile的顶部</font><font style="vertical-align: inherit;">看到一个语音目标，例如</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标</font><font style="vertical-align: inherit;">，如图2所示。</font></font></nobr></div>
<div style="position:absolute;top:75106;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XXX。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:75165;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃默认设为目标。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:75179;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全部：kernel.bin</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:75208;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃$ ^被目标的所有依赖文件替换</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:75222;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.bin：kernel_entry.o kernel.o</font></font></nobr></div>
<div style="position:absolute;top:75236;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ld -o kernel.bin -Ttext 0x1000 $ ^ --oformat二进制文件</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:75265;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃$ &lt;是第一个依赖项，$ @是目标文件</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:75279;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.o：kernel.c</font></font></nobr></div>
<div style="position:absolute;top:75293;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc -ffreestanding -c $ &lt;-o </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ @</font></font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:75321;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃与上述规则相同。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:75336;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel_entry.o：kernel_entry.asm</font></font></nobr></div>
<div style="position:absolute;top:75350;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nasm $ &lt;-f elf -o </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ @</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:75406;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，通过将</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.bin</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为对</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标</font><font style="vertical-align: inherit;">的依赖关系</font><font style="vertical-align: inherit;">，我们确保</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:75425;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.bin</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">及其所有依赖项都是为默认目标构建的。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:75442;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们可以放置所有用于构建内核和可加载内核的命令</font></font></nobr></div>
<div style="position:absolute;top:75460;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映像到有用的makefile中（请参见图XXX），这将使我们能够测试更改或</font></font></nobr></div>
<div style="position:absolute;top:75478;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只需输入</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make run</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即可对Bochs中的代码进行更正</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:75537;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全部：os-image</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:75566;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃运行bochs模拟我们的代码启动。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:75580;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行：全部</font></font></nobr></div>
<div style="position:absolute;top:75594;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bochs</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:75623;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃这是计算机加载的实际磁盘映像，</font></font></nobr></div>
<div style="position:absolute;top:75637;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃这是我们编译的引导扇区和内核的组合</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:75651;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统图像：boot_sect.bin kernel.bin</font></font></nobr></div>
<div style="position:absolute;top:75665;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">猫$ ^&gt;操作系统图像</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:75895;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="61"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第61章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:76039;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:76060;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:76060;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">57</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:76112;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃这从两个目标文件构建内核的二进制文件：</font></font></nobr></div>
<div style="position:absolute;top:76126;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃</font></font></nobr></div>
<div style="position:absolute;top:76126;left:197"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-kernel_entry，它跳转到我们内核中的main（）</font></font></nobr></div>
<div style="position:absolute;top:76141;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃</font></font></nobr></div>
<div style="position:absolute;top:76141;left:197"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-编译的C内核</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:76155;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.bin：kernel_entry.o kernel.o</font></font></nobr></div>
<div style="position:absolute;top:76169;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ld -o kernel.bin -Ttext 0x1000 $ ^ --oformat二进制文件</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:76197;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃构建我们的内核目标文件。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:76212;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.o：kernel.c</font></font></nobr></div>
<div style="position:absolute;top:76226;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc -ffreestanding -c $ &lt;-o </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ @</font></font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:76254;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃构建我们的内核入口对象文件。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:76268;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel_entry.o：kernel_entry.asm</font></font></nobr></div>
<div style="position:absolute;top:76283;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nasm $ &lt;-f elf -o </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ @</font></font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:76311;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃将引导扇区组装为原始机器代码</font></font></nobr></div>
<div style="position:absolute;top:76325;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃</font></font></nobr></div>
<div style="position:absolute;top:76325;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-I选项告诉nasm在哪里可以找到我们有用的程序集</font></font></nobr></div>
<div style="position:absolute;top:76339;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃</font></font></nobr></div>
<div style="position:absolute;top:76339;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们包含在boot_sect.asm中的例程</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:76353;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">boot_sect.bin：boot_sect.asm</font></font></nobr></div>
<div style="position:absolute;top:76368;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nasm $ &lt;-f bin -I'../../16bit/'-o </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ @</font></font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:76410;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃清除所有生成的文件。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:76424;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">干净的：</font></font></nobr></div>
<div style="position:absolute;top:76439;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rm -fr * .bin * .dis * .o os-image * .map</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:76467;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃反汇编我们的内核-可能对调试有用。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:76481;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.dis：kernel.bin</font></font></nobr></div>
<div style="position:absolute;top:76495;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ndisasm -b 32 $ &lt;&gt; </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ @</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:76567;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3.1组织我们的操作系统的代码库</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:76601;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们到达了一个非常简单的C内核，该内核在程序的一角打印了一个“ X”</font></font></nobr></div>
<div style="position:absolute;top:76619;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕。</font><font style="vertical-align: inherit;">内核被编译为32位指令并具有</font></font></nobr></div>
<div style="position:absolute;top:76637;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功地由CPU执行意味着我们已经走了很远；</font><font style="vertical-align: inherit;">但现在是时候</font></font></nobr></div>
<div style="position:absolute;top:76655;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为未来的工作做好准备。</font><font style="vertical-align: inherit;">我们需要建立一个合适的结构</font></font></nobr></div>
<div style="position:absolute;top:76673;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的代码，以及一个makefile，它将使我们能够轻松添加新的源文件</font></font></nobr></div>
<div style="position:absolute;top:76691;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统的新功能，并逐步检查这些增加的内容</font></font></nobr></div>
<div style="position:absolute;top:76709;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与诸如Bochs之类的仿真器一起使用。</font></font></nobr></div>
<div style="position:absolute;top:76727;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与Linux和Minix等内核类似，我们可以将代码库组织到</font></font></nobr></div>
<div style="position:absolute;top:76745;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下文件夹：</font></font></nobr></div>
<div style="position:absolute;top:76771;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">boot</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：与引导和引导扇区有关的所有内容都可以在此处进入，例如</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:76791;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">boot sect.asm</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和我们的启动扇区汇编例程（例如</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print string.asm </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font></nobr></div>
<div style="position:absolute;top:76809;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gdt.asm </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">切换到pm.asm</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等）。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:76833;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：内核的主文件</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.c</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和其他与内核相关的代码，即</font></font></nobr></div>
<div style="position:absolute;top:76852;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是特定于设备驱动程序的将进入此处。</font></font></nobr></div>
<div style="position:absolute;top:76878;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动程序</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：任何特定于硬件的驱动程序代码都将在此处输入。</font></font></nobr></div>
<div style="position:absolute;top:76906;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，在我们的makefile中，而不必指定每个单独的目标文件</font></font></nobr></div>
<div style="position:absolute;top:76924;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们要构建（例如</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel / kernel.o</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drivers / screen.o</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drivers / keyboard.o</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:76942;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等），我们可以使用特殊的通配符声明，如下所示：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:77157;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="62"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第62章</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:77301;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:77322;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:77322;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">58</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:77359;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃自动扩展到现有文件列表</font></font></nobr></div>
<div style="position:absolute;top:77373;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃匹配模式</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:77388;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C_SOURCES = $（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通配符</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核</font><font style="vertical-align: inherit;">/*.c</font><font style="vertical-align: inherit;">驱动程序</font><font style="vertical-align: inherit;">/*.c </font><font style="vertical-align: inherit;">）</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:77420;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后我们可以使用另一个</font><font color="#2b57a3"><font style="vertical-align: inherit;">make</font></font><font style="vertical-align: inherit;">将源文件名转换为对象文件名</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"></font></font></nobr></div>
<div style="position:absolute;top:77438;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明如下：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:77468;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃创建一个要构建的目标文件列表，只需替换即可</font></font></nobr></div>
<div style="position:absolute;top:77483;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃C_SOURCES中文件名的'.c'扩展名带有'.o'</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:77497;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OBJ = $ {C_SOURCES：.c = .o}</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:77529;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们可以将内核目标文件链接在一起，以构建内核二进制文件，如下所示：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:77560;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃将内核目标文件链接到一个二进制文件中，确保</font></font></nobr></div>
<div style="position:absolute;top:77574;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃进入代码在二进制文件的开头。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:77588;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.bin：kernel / kernel_entry.o $ {OBJ}</font></font></nobr></div>
<div style="position:absolute;top:77602;left:265"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ld -o </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ @</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Ttext 0x1000 $ ^ --oformat二进制</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:77635;left:159"><nobr><font style="vertical-align: inherit;"></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的功能</font><font style="vertical-align: inherit;">将与我们动态包含目标文件紧密结合在一起，是</font></font></nobr></div>
<div style="position:absolute;top:77653;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式规则，该规则告诉</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何基于简单的</font><font style="vertical-align: inherit;">规则</font><font style="vertical-align: inherit;">从另一文件类型构建一个文件类型</font></font></nobr></div>
<div style="position:absolute;top:77671;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名的模式机，如下所示：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:77701;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃从'somefile.c'构建'somefile.o'的通用规则</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:77715;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％.o：％。c</font></font></nobr></div>
<div style="position:absolute;top:77729;left:265"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc -ffreestanding -c $ &lt;-o </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ @</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:77762;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">替代方法将是很多重复，如下所示：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:77792;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel / kernel.o：内核/kernel.c</font></font></nobr></div>
<div style="position:absolute;top:77807;left:265"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc -ffreestanding -c $ &lt;-o </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ @</font></font></font></nobr></div>
<div style="position:absolute;top:77835;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drivers / screen.o：drivers / screen.c</font></font></nobr></div>
<div style="position:absolute;top:77849;left:265"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc -ffreestanding -c $ &lt;-o </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ @</font></font></font></nobr></div>
<div style="position:absolute;top:77878;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drivers / keyboard.o：drivers / keyboard.c</font></font></nobr></div>
<div style="position:absolute;top:77892;left:265"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc -ffreestanding -c $ &lt;-o </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ @</font></font></font></nobr></div>
<div style="position:absolute;top:77920;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:77953;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">太好了，既然我们</font><font style="vertical-align: inherit;">充分</font><font style="vertical-align: inherit;">了解了</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么就可以继续开发内核了，</font></font></nobr></div>
<div style="position:absolute;top:77971;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不必一遍又一遍地重新键入很多命令来检查是否存在某些内容</font></font></nobr></div>
<div style="position:absolute;top:77988;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常工作。</font><font style="vertical-align: inherit;">图XXX显示了一个完整的makefile，适用于</font></font></nobr></div>
<div style="position:absolute;top:78006;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与我们的内核一起进步。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:78066;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃使用通配符自动生成源列表。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:78080;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C_SOURCES = $（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通配符</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核</font><font style="vertical-align: inherit;">/*.c</font><font style="vertical-align: inherit;">驱动程序</font><font style="vertical-align: inherit;">/*.c </font><font style="vertical-align: inherit;">）</font></font></nobr></div>
<div style="position:absolute;top:78094;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEADERS = $（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通配符</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核</font><font style="vertical-align: inherit;">/*.h</font><font style="vertical-align: inherit;">驱动程序</font><font style="vertical-align: inherit;">/*.h </font><font style="vertical-align: inherit;">）</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:78122;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃TODO：使源依赖于所有头文件。</font></font></nobr></div>
<div style="position:absolute;top:78151;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃将* .c文件名转换为* .o，以提供要构建的目标文件的列表</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:78165;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OBJ = $ {C_SOURCES：.c = .o}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:78193;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃Defaul建立目标</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:78208;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全部：os-image</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:78419;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="63"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第63章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:78563;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:78584;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:78584;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">59</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:78650;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃运行bochs模拟我们的代码启动。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:78665;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行：全部</font></font></nobr></div>
<div style="position:absolute;top:78679;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bochs</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:78707;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃这是计算机加载的实际磁盘映像</font></font></nobr></div>
<div style="position:absolute;top:78721;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃这是我们编译的引导扇区和内核的组合</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:78736;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统映像：boot / boot_sect.bin kernel.bin</font></font></nobr></div>
<div style="position:absolute;top:78750;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">猫$ ^&gt;操作系统图像</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:78792;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃这从两个目标文件构建内核的二进制文件：</font></font></nobr></div>
<div style="position:absolute;top:78807;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃</font></font></nobr></div>
<div style="position:absolute;top:78807;left:197"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-kernel_entry，它跳转到我们内核中的main（）</font></font></nobr></div>
<div style="position:absolute;top:78821;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃</font></font></nobr></div>
<div style="position:absolute;top:78821;left:197"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-编译的C内核</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:78835;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.bin：kernel / kernel_entry.o $ {OBJ}</font></font></nobr></div>
<div style="position:absolute;top:78849;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ld -o </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ @</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Ttext 0x1000 $ ^ --oformat二进制</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:78877;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃将C代码编译到目标文件的通用规则</font></font></nobr></div>
<div style="position:absolute;top:78892;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃为了简单起见，我们的C文件依赖于所有头文件。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:78906;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％.o：％。c $ {HEADERS}</font></font></nobr></div>
<div style="position:absolute;top:78920;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc -ffreestanding -c $ &lt;-o </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ @</font></font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:78948;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃组装kernel_entry。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:78963;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％.o：％。asm</font></font></nobr></div>
<div style="position:absolute;top:78977;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nasm $ &lt;-f elf -o </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ @</font></font></font></nobr></div>
<div style="position:absolute;top:79005;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％.bin：％.asm</font></font></nobr></div>
<div style="position:absolute;top:79019;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nasm $ &lt;-f bin -I'../../16bit/'-o </font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ @</font></font></font></nobr></div>
<div style="position:absolute;top:79048;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">干净的：</font></font></nobr></div>
<div style="position:absolute;top:79062;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rm -fr * .bin * .dis * .o os-image</font></font></nobr></div>
<div style="position:absolute;top:79076;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rm -fr内核/*.o引导/*.bin驱动程序/*.o</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:79153;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4 C入门</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:79196;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C有一些怪异之处，可能会使新的语言程序员感到不安。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:79243;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4.1预处理程序和指令</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:79278;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在将C文件编译为目标文件之前，预处理器会对其进行扫描以寻找预处理器</font></font></nobr></div>
<div style="position:absolute;top:79295;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令和变量，然后通常用代码（例如宏）替换它们</font></font></nobr></div>
<div style="position:absolute;top:79313;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和常量的值，或完全不包含任何值。</font><font style="vertical-align: inherit;">预处理器对于</font></font></nobr></div>
<div style="position:absolute;top:79331;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编译C代码，但提供一些便利，使代码更加</font></font></nobr></div>
<div style="position:absolute;top:79349;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可管理的。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:79380;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃定义</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PI 3.141592</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:79394;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:79408;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浮点</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">半径= 3.0;</font></font></font></nobr></div>
<div style="position:absolute;top:79423;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浮动</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">周长= 2 *半径* PI;</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:79437;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:79470;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预处理器将输出以下代码，准备进行编译：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:79681;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="64"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第64章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:79825;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:79846;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:79846;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">60</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:79883;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:79897;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浮点</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">半径= 3.0;</font></font></font></nobr></div>
<div style="position:absolute;top:79912;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浮动</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">周长= 2 *半径* 3.141592;</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:79926;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:79959;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预处理器对于输出条件代码也很有用，但在</font></font></nobr></div>
<div style="position:absolute;top:79976;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在运行时做出决定的感觉，例如使用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，而不是在</font></font></nobr></div>
<div style="position:absolute;top:79994;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编译时的感觉。</font><font style="vertical-align: inherit;">例如，考虑以下预处理器指令的使用</font></font></nobr></div>
<div style="position:absolute;top:80012;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于包含或排除调试代码：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:80043;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:80057;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#ifdef</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:80071;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print（“ Some debug message \ n”）;</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:80086;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃万一</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:80100;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:80133;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，如果</font><font style="vertical-align: inherit;">已定义</font><font style="vertical-align: inherit;">了预处理程序变量</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DEBUG</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则将使用以下调试代码：</font></font></nobr></div>
<div style="position:absolute;top:80151;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括; </font><font style="vertical-align: inherit;">否则，不是。</font><font style="vertical-align: inherit;">编译时可以在命令行上定义一个变量</font></font></nobr></div>
<div style="position:absolute;top:80168;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C文件如下：</font></font></nobr></div>
<div style="position:absolute;top:80197;left:203"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ gcc -DDEBUG -c一些文件.c -o一些文件.o</font></font></nobr></div>
<div style="position:absolute;top:80222;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种命令行变量声明通常用于编译时配置。</font></font></nobr></div>
<div style="position:absolute;top:80240;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序（尤其是操作系统）的比率，其中可能包括或不包括</font></font></nobr></div>
<div style="position:absolute;top:80258;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完整的代码部分，也许可以减少内核的内存占用。</font></font></nobr></div>
<div style="position:absolute;top:80276;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嵌入式设备。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:80324;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4.2函数声明和头文件</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:80358;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当编译器触发对函数的调用时，该调用可能会或可能不会在</font></font></nobr></div>
<div style="position:absolute;top:80376;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件被编译时，可能会做出错误的假设并产生错误的计算机</font></font></nobr></div>
<div style="position:absolute;top:80393;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码指令（如果尚未遇到函数返回类型的说明）</font></font></nobr></div>
<div style="position:absolute;top:80411;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和争论。</font><font style="vertical-align: inherit;">回顾第XXX节，编译器必须为以下内容准备堆栈：</font></font></nobr></div>
<div style="position:absolute;top:80429;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递给函数的变量，但是如果堆栈不是函数期望的值，</font></font></nobr></div>
<div style="position:absolute;top:80447;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则堆栈可能会损坏。</font><font style="vertical-align: inherit;">因此，至少</font></font></nobr></div>
<div style="position:absolute;top:80465;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数接口的声明（如果不是整个函数定义的话）在</font></font></nobr></div>
<div style="position:absolute;top:80483;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它被使用。</font><font style="vertical-align: inherit;">此声明被称为函数的原型。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:80543;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">add（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b）{</font></font></font></nobr></div>
<div style="position:absolute;top:80557;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a + b;</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:80571;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:80599;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main（）{</font></font></font></nobr></div>
<div style="position:absolute;top:80614;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//这样就可以了，因为我们的编译器已经看到了完整的</font></font></nobr></div>
<div style="position:absolute;top:80628;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">// add的定义</font></font></nobr></div>
<div style="position:absolute;top:80642;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果= add（5，3）;</font></font></font></nobr></div>
<div style="position:absolute;top:80670;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//这不行，因为编译器不知道返回值</font></font></nobr></div>
<div style="position:absolute;top:80685;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//输入参数或其他有关参数的内容。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:80699;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果=除法（34.3，12.76）;</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:80727;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//这不行，因为我们的编译器一无所知</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:80943;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="65"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第65章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:81087;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章。编写，构建和加载您的</font></font></nobr></div>
<div style="position:absolute;top:81108;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心</font></font></nobr></div>
<div style="position:absolute;top:81108;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">61</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:81160;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//此函数的接口。</font></font></nobr></div>
<div style="position:absolute;top:81174;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出= external_function（5，“ Hello”，4.5）;</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:81189;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:81217;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浮点</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分隔（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> float </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> float </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b）{</font></font></font></nobr></div>
<div style="position:absolute;top:81231;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a / b;</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:81245;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:81302;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以将其固定如下：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:81361;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//这些函数原型通知编译器有关</font></font></nobr></div>
<div style="position:absolute;top:81376;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//函数接口。</font></font></nobr></div>
<div style="position:absolute;top:81390;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浮点数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除法（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> float </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> float </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b）;</font></font></font></nobr></div>
<div style="position:absolute;top:81390;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">// &lt;-注意分号</font></font></nobr></div>
<div style="position:absolute;top:81404;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">external_function（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> char </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*消息，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浮点数</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b）;</font></font></font></nobr></div>
<div style="position:absolute;top:81432;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">add（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b）{</font></font></font></nobr></div>
<div style="position:absolute;top:81447;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a + b;</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:81461;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:81489;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main（）{</font></font></font></nobr></div>
<div style="position:absolute;top:81503;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//这样就可以了，因为我们的编译器已经看到了完整的</font></font></nobr></div>
<div style="position:absolute;top:81518;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">// add的定义</font></font></nobr></div>
<div style="position:absolute;top:81532;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果= add（5，3）;</font></font></font></nobr></div>
<div style="position:absolute;top:81560;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//现在还可以：编译器知道接口。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:81574;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果=除法（34.3，12.76）;</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:81603;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//现在还可以：编译器知道接口。</font></font></nobr></div>
<div style="position:absolute;top:81617;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出= external_function（5，“ Hello”，4.5）;</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:81631;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:81659;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浮点</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分隔（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> float </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> float </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b）{</font></font></font></nobr></div>
<div style="position:absolute;top:81674;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a / b;</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:81688;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:81744;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，由于将从编译到其他目标文件中的代码中调用某些功能，</font></font></nobr></div>
<div style="position:absolute;top:81762;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他们还需要声明这些函数的相同原型，这将导致</font></font></nobr></div>
<div style="position:absolute;top:81780;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">许多重复的原型声明，很难维护。</font><font style="vertical-align: inherit;">为此原因，</font></font></nobr></div>
<div style="position:absolute;top:81798;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">许多C程序都使用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预处理程序指令来插入通用代码，</font></font></nobr></div>
<div style="position:absolute;top:81816;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含编译前所需的原型。</font><font style="vertical-align: inherit;">此通用代码称为</font></font></nobr></div>
<div style="position:absolute;top:81834;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">头文件，我们可以将其视为已编译目标文件的接口，以及</font></font></nobr></div>
<div style="position:absolute;top:81852;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用途如下。</font></font></nobr></div>
<div style="position:absolute;top:81870;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有时，一个头文件可能包含另一个头文件，因此不要重新定义它很重要</font></font></nobr></div>
<div style="position:absolute;top:81888;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同的代码...</font></font></nobr></div>
<div style="position:absolute;top:81914;left:186"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•铸造类型</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:82205;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="66"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第66章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:82516;left:389"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">章</font></font><font style="font-size:35px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></font></nobr></div>
</span></font>
<font size="5" color="#2b57a3" face="Times"><span style="font-size:35px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:82591;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发基本设备</font></font></nobr></div>
<div style="position:absolute;top:82636;left:236"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动程序和文件系统</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:82751;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简介部分。</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:82803;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1硬件输入/输出</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:82847;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过写到屏幕上，我们实际上已经遇到了一种友好的形式，</font></font></nobr></div>
<div style="position:absolute;top:82864;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ware I / O，称为内存映射I / O，将数据直接写入特定对象</font></font></nobr></div>
<div style="position:absolute;top:82882;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主存储器中的地址范围被写入设备的内部存储器缓冲区，但是</font></font></nobr></div>
<div style="position:absolute;top:82900;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在是时候进一步了解CPU和硬件之间的这种交互了。</font></font></nobr></div>
<div style="position:absolute;top:82918;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们以现在流行的TFT显示器为例。</font><font style="vertical-align: inherit;">屏幕表面是</font></font></nobr></div>
<div style="position:absolute;top:82936;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分为背光单元矩阵。</font><font style="vertical-align: inherit;">通过包含一层液晶砂</font></font></nobr></div>
<div style="position:absolute;top:82954;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">夹在偏光膜之间，穿过每个单元的光量可以是</font></font></nobr></div>
<div style="position:absolute;top:82972;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于电场的作用，液晶具有以下特性：</font></font></nobr></div>
<div style="position:absolute;top:82990;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当受到电场作用时，它们的方向可能会一致地改变</font></font></nobr></div>
<div style="position:absolute;top:83008;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方式; </font><font style="vertical-align: inherit;">随着晶体取向的改变，它们改变了光波的方向</font></font></nobr></div>
<div style="position:absolute;top:83026;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">振动，这样一些光将被偏振膜遮挡</font></font></nobr></div>
<div style="position:absolute;top:83044;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕的表面。</font><font style="vertical-align: inherit;">对于彩色显示器，每个单元格进一步分为三个区域，</font></font></nobr></div>
<div style="position:absolute;top:83062;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被红色，蓝色和绿色[？]的滤镜覆盖。</font></font></nobr></div>
<div style="position:absolute;top:83080;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，确保适当的单元格或子单元格颜色是硬件的工作</font></font></nobr></div>
<div style="position:absolute;top:83098;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">区域，使其经受适当的电场，以在</font></font></nobr></div>
<div style="position:absolute;top:83116;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕。</font><font style="vertical-align: inherit;">最好将这方面的硬件留给专业的电子工程师，但在那里</font></font></nobr></div>
<div style="position:absolute;top:83133;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成为控制器芯片，理想情况下具有明确定义的功能，该功能在芯片的</font></font></nobr></div>
<div style="position:absolute;top:83151;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据表，在设备或主板上，CPU可以与之交互以定向</font></font></nobr></div>
<div style="position:absolute;top:83169;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">硬件。</font><font style="vertical-align: inherit;">实际上，出于向后兼容的原因，TFT显示器通常</font></font></nobr></div>
<div style="position:absolute;top:83187;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模拟较旧的CRT显示器，因此可以由主板的标准VGA驱动</font></font></nobr></div>
<div style="position:absolute;top:83205;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制器，该控制器生成一个复杂的模拟信号，该信号会引导电子束进行扫描</font></font></nobr></div>
<div style="position:absolute;top:83223;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">穿过荧光粉涂层的屏幕，由于实际上没有CRT光束可以引导，</font></font></nobr></div>
<div style="position:absolute;top:83241;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TFT监视器巧妙地将此信号解释为数字图像。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:83314;left:436"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">62</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:83467;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="67"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第67章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:83611;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6章开发基本设备驱动程序和组件</font></font></nobr></div>
<div style="position:absolute;top:83632;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件系统</font></font></nobr></div>
<div style="position:absolute;top:83632;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">63</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:83666;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在内部，控制器芯片通常具有几个可以读取，写入或读取的寄存器。</font></font></nobr></div>
<div style="position:absolute;top:83684;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些都由CPU决定，正是这些寄存器的状态告诉控制器要做什么。</font></font></nobr></div>
<div style="position:absolute;top:83702;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（例如，将哪些引脚设置为高电平或低电平以驱动硬件，或者要使用哪些内部功能</font></font></nobr></div>
<div style="position:absolute;top:83720;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">履行）。</font><font style="vertical-align: inherit;">例如，来自英特尔广泛使用的</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">82077AA</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单芯片</font><font style="vertical-align: inherit;">的数据表</font></font></nobr></div>
<div style="position:absolute;top:83738;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">软盘控制器[？]，我们看到有一个</font><font style="vertical-align: inherit;">驱动电机</font><font style="vertical-align: inherit;">的引脚（引脚57，标记为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ME0</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></nobr></div>
<div style="position:absolute;top:83756;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个软盘设备中的磁盘驱动器（因为单个控制器可以驱动多个这样的设备）：</font></font></nobr></div>
<div style="position:absolute;top:83774;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">销钉接通时，电动机旋转；</font><font style="vertical-align: inherit;">关闭时，电动机不旋转。</font><font style="vertical-align: inherit;">的状态</font></font></nobr></div>
<div style="position:absolute;top:83792;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该特定引脚直接链接到控制器内部寄存器的特定位</font></font></nobr></div>
<div style="position:absolute;top:83810;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名为数字输出寄存器（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DOR</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">然后可以通过以下方式设置该寄存器的状态</font></font></nobr></div>
<div style="position:absolute;top:83827;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在芯片的数据上设置适当的位（在本例中为位4）来设置值</font></font></nobr></div>
<div style="position:absolute;top:83845;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标记为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DB0--DB7的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引脚，</font><font style="vertical-align: inherit;">并使用芯片的寄存器选择引脚</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A0--A2</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行选择</font></font></nobr></div>
<div style="position:absolute;top:83863;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DOR</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由其内部地址寄存器</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0×2 </font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:83911;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.1 I / O总线</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:83945;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管从历史上看，CPU会直接与设备控制器对话，</font></font></nobr></div>
<div style="position:absolute;top:83963;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">降低CPU速度，这将需要CPU人为地降低到相同速度</font></font></nobr></div>
<div style="position:absolute;top:83981;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">速度是最慢的设备，因此CPU发出I / O指令更为实用</font></font></nobr></div>
<div style="position:absolute;top:83999;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接连接到高速顶层总线的控制器芯片。</font><font style="vertical-align: inherit;">然后，总线控制器</font></font></nobr></div>
<div style="position:absolute;top:84017;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">负责以兼容的速率将指令中继到特定设备的</font></font></nobr></div>
<div style="position:absolute;top:84034;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制器。</font><font style="vertical-align: inherit;">然后，为了避免顶层总线因较慢的设备而变慢，</font></font></nobr></div>
<div style="position:absolute;top:84052;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以将另一种总线技术的控制器添加为设备，以便我们到达</font></font></nobr></div>
<div style="position:absolute;top:84070;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现代计算机中总线的层次结构[？]。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:84118;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2 I / O编程</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:84152;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所以问题是，我们如何读写设备控制器的寄存器（即</font></font></nobr></div>
<div style="position:absolute;top:84170;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">告诉我们的设备该怎么做）？</font><font style="vertical-align: inherit;">在英特尔架构系统中，寄存器</font></font></nobr></div>
<div style="position:absolute;top:84188;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的设备控制器映射到一个I / O地址空间，该地址空间与主控制器分开</font></font></nobr></div>
<div style="position:absolute;top:84206;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储器地址空间，那么一些变体的I / O指令</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于读取</font></font></nobr></div>
<div style="position:absolute;top:84224;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并将数据写入映射到特定控制器寄存器的I / O地址。</font><font style="vertical-align: inherit;">为了</font></font></nobr></div>
<div style="position:absolute;top:84242;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，前面描述的软盘控制器通常将其</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DOR</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寄存器映射到</font></font></nobr></div>
<div style="position:absolute;top:84259;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I / O地址</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x3F2</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此我们可以使用以下命令打开第一个驱动器的电动机</font></font></nobr></div>
<div style="position:absolute;top:84277;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:84308;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov dx </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，0x3f2</font></font></font></nobr></div>
<div style="position:absolute;top:84308;left:333"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">必须使用DX来存储端口地址</font></font></nobr></div>
<div style="position:absolute;top:84322;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在人</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DX</font></font></nobr></div>
<div style="position:absolute;top:84322;left:333"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">将端口（即DOR）的内容读取到AL</font></font></nobr></div>
<div style="position:absolute;top:84336;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00001000b</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">接通电机位</font></font></nobr></div>
<div style="position:absolute;top:84351;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出DX </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">人</font></font></nobr></div>
<div style="position:absolute;top:84351;left:333"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">更新设备的DOR。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:84383;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在较旧的系统中，例如工业标准架构（ISA）总线，端口ad-</font></font></nobr></div>
<div style="position:absolute;top:84401;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">衣服将静态分配给设备，但使用现代的即插即用总线，</font></font></nobr></div>
<div style="position:absolute;top:84419;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如外围组件互连（PCI），BIOS可以动态分配I / O</font></font></nobr></div>
<div style="position:absolute;top:84437;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引导操作系统之前，请先寻址到大多数设备。</font><font style="vertical-align: inherit;">这样的动态分配</font></font></nobr></div>
<div style="position:absolute;top:84455;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要求设备通过总线传达配置信息以描述</font></font></nobr></div>
<div style="position:absolute;top:84473;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">硬件，例如：需要为寄存器保留多少个I / O端口；</font><font style="vertical-align: inherit;">如何</font></font></nobr></div>
<div style="position:absolute;top:84491;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要大量的内存映射空间；</font><font style="vertical-align: inherit;">以及硬件类型的唯一ID，以允许</font></font></nobr></div>
<div style="position:absolute;top:84509;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适当的驱动程序，稍后由操作系统[？]查找。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:84729;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="68"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第68章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:84873;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6章开发基本设备驱动程序和组件</font></font></nobr></div>
<div style="position:absolute;top:84894;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件系统</font></font></nobr></div>
<div style="position:absolute;top:84894;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:84928;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口I / O的问题在于我们无法在C语言中表达这些低级指令</font></font></nobr></div>
<div style="position:absolute;top:84946;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言，因此我们必须学习一些有关内联汇编的知识：大多数编译器都允许您</font></font></nobr></div>
<div style="position:absolute;top:84964;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过gcc实现将汇编代码段插入到函数主体中</font></font></nobr></div>
<div style="position:absolute;top:84982;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下所示：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:85041;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsigned char </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port_byte_in（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unsigned short </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port）{</font></font></font></nobr></div>
<div style="position:absolute;top:85055;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//一个方便的C包装函数，它从指定的端口读取一个字节</font></font></nobr></div>
<div style="position:absolute;top:85070;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//</font></font></nobr></div>
<div style="position:absolute;top:85070;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ = a”（结果）表示：完成时将AL寄存器放入变量RESULT中</font></font></nobr></div>
<div style="position:absolute;top:85084;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//</font></font></nobr></div>
<div style="position:absolute;top:85084;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ d”（端口）表示：用端口加载EDX</font></font></nobr></div>
<div style="position:absolute;top:85098;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未签名的字符</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果；</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:85112;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__asm __（“ %% dx，%% al”：“ = a”（结果）：“ d”（端口））;</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:85126;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果；</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:85141;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:85197;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，实际的汇编指令</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">%% dx，%% al</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看起来有点奇怪</font></font></nobr></div>
<div style="position:absolute;top:85215;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们，因为gcc采用了不同的汇编语法（称为GAS），因此目标和</font></font></nobr></div>
<div style="position:absolute;top:85233;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相对于我们更熟悉的nasm的语法，目标操作数是相反的</font></font></nobr></div>
<div style="position:absolute;top:85251;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">句法; </font><font style="vertical-align: inherit;">同样，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于表示寄存器，这需要一个难看的</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">%%</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个</font></font></nobr></div>
<div style="position:absolute;top:85269;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C编译器</font><font style="vertical-align: inherit;">的转义字符，因此</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">%%</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示：转义转义字符，因此</font></font></nobr></div>
<div style="position:absolute;top:85287;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它会原样出现在字符串中。</font></font></nobr></div>
<div style="position:absolute;top:85305;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于这些低层端口I / O功能将由</font></font></nobr></div>
<div style="position:absolute;top:85323;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的内核，让我们将它们一起收集到文件</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel / low level.c中</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们可以</font></font></nobr></div>
<div style="position:absolute;top:85341;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义如图XXX。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:85400;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsigned char </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port_byte_in（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unsigned short </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port）{</font></font></font></nobr></div>
<div style="position:absolute;top:85414;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//一个方便的C包装函数，它从指定的端口读取一个字节</font></font></nobr></div>
<div style="position:absolute;top:85429;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//</font></font></nobr></div>
<div style="position:absolute;top:85429;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ = a”（结果）表示：完成时将AL寄存器放入变量RESULT中</font></font></nobr></div>
<div style="position:absolute;top:85443;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//</font></font></nobr></div>
<div style="position:absolute;top:85443;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ d”（端口）表示：用端口加载EDX</font></font></nobr></div>
<div style="position:absolute;top:85457;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未签名的字符</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果；</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:85471;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__asm __（“ %% dx，%% al”：“ = a”（结果）：“ d”（端口））;</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:85485;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果；</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:85500;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:85528;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port_byte_out（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unsigned short </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unsigned char </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data）{</font></font></font></nobr></div>
<div style="position:absolute;top:85542;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//“ a”（数据）的意思是：用数据加载EAX</font></font></nobr></div>
<div style="position:absolute;top:85556;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//“ d”（端口）表示：用端口加载EDX</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:85571;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__asm __（“ out %% al，%% dx”：：“ a”（数据），“ d”（端口））；</font></font></nobr></div>
<div style="position:absolute;top:85585;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:85613;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsigned short </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port_word_in（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unsigned short </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port）{</font></font></font></nobr></div>
<div style="position:absolute;top:85627;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未签名的短期</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果；</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:85641;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__asm __（“在%% dx，%% ax中：” = a“（结果）：” d“（端口））;</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:85656;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果；</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:85670;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:85698;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port_word_out（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unsigned short </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unsigned short </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data）{</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:85712;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__asm __（“ out %% ax，%% dx”：：“ a”（数据），“ d”（端口））；</font></font></nobr></div>
<div style="position:absolute;top:85727;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:85991;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="69"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第69章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:86135;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6章开发基本设备驱动程序和组件</font></font></nobr></div>
<div style="position:absolute;top:86156;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件系统</font></font></nobr></div>
<div style="position:absolute;top:86156;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">65岁</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:86185;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.3直接内存访问</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:86220;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于端口I / O涉及读取或写入单个字节或字，因此传输大</font></font></nobr></div>
<div style="position:absolute;top:86238;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘设备和内存之间的数据量可能会占用大量内存</font></font></nobr></div>
<div style="position:absolute;top:86255;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节省的CPU时间。</font><font style="vertical-align: inherit;">此问题需要CPU通过的方法</font></font></nobr></div>
<div style="position:absolute;top:86273;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这项繁琐的工作交给了其他人，那就是直接内存访问（DMA）控制器[？]。</font></font></nobr></div>
<div style="position:absolute;top:86291;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DMA的一个很好的类比是，一位建筑师想要将一堵墙从</font></font></nobr></div>
<div style="position:absolute;top:86309;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">放置到另一个。</font><font style="vertical-align: inherit;">架构师确实知道该怎么做，但还有其他重要事项</font></font></nobr></div>
<div style="position:absolute;top:86327;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了移动每个积木之外，还需要考虑的其他事情，因此指示建造者移动</font></font></nobr></div>
<div style="position:absolute;top:86345;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一块一块地砌成砖块，并在墙面完工时或在墙面是否完好时提醒（即打断）他</font></font></nobr></div>
<div style="position:absolute;top:86363;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发生了一些错误，导致墙无法完成。</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:86415;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2屏幕驱动</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:86459;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目前为止，我们的内核能够在屏幕的角落打印“ X”，</font></font></nobr></div>
<div style="position:absolute;top:86477;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">足以让我们知道我们的内核已成功加载和执行，</font></font></nobr></div>
<div style="position:absolute;top:86494;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">告诉我们有关计算机上正在发生的事情的很多信息。</font></font></nobr></div>
<div style="position:absolute;top:86512;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们知道可以通过编写字符来在屏幕上显示字符</font></font></nobr></div>
<div style="position:absolute;top:86530;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示缓冲区中地址</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xb8000的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">某个</font><font color="#2b57a3"><font style="vertical-align: inherit;">位置</font></font><font style="vertical-align: inherit;">，但是我们不想保留</font></font></nobr></div>
<div style="position:absolute;top:86548;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不必担心整个内核中的这种低级操作。</font><font style="vertical-align: inherit;">它</font></font></nobr></div>
<div style="position:absolute;top:86566;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们可以创建屏幕的抽象使我们能够做的更好，那将更好</font></font></nobr></div>
<div style="position:absolute;top:86584;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写出</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print（''Hello''）</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，也许还可以</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清除screen（）</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">如果它可以滚动的时候</font></font></nobr></div>
<div style="position:absolute;top:86602;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在最后一条显示行之外打印，这将锦上添花。</font><font style="vertical-align: inherit;">不仅会</font></font></nobr></div>
<div style="position:absolute;top:86620;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种抽象使得在我们的其他代码中更容易显示信息</font></font></nobr></div>
<div style="position:absolute;top:86638;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核，但它将允许我们在以后轻松地将一个显示驱动程序替换为另一个显示驱动程序</font></font></nobr></div>
<div style="position:absolute;top:86656;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期，也许如果某台计算机不支持彩色VGA文本模式，</font></font></nobr></div>
<div style="position:absolute;top:86674;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们目前假设。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:86721;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.1了解显示设备</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:86755;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与我们即将介绍的其他一些硬件相比，显示设备</font></font></nobr></div>
<div style="position:absolute;top:86773;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常简单，因为作为内存映射设备，我们可以在没有</font></font></nobr></div>
<div style="position:absolute;top:86791;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解有关控制消息和硬件I / O的一切。</font><font style="vertical-align: inherit;">但是，一个有用的</font></font></nobr></div>
<div style="position:absolute;top:86809;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要I / O控制（即通过I / O端口）进行操作的屏幕设备是</font></font></nobr></div>
<div style="position:absolute;top:86827;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">光标，该光标闪烁以标记将在其上写入字符的下一个位置</font></font></nobr></div>
<div style="position:absolute;top:86845;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕。</font><font style="vertical-align: inherit;">这对用户很有用，因为它可以吸引用户注意输入提示</font></font></nobr></div>
<div style="position:absolute;top:86863;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一些文本，但是无论光标是可见的还是垂直的，我们都将其用作内部标记</font></font></nobr></div>
<div style="position:absolute;top:86881;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是，这样程序员就不必总是指定坐标的位置</font></font></nobr></div>
<div style="position:absolute;top:86899;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕上将显示一个字符串，例如：如果我们编写</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print（''hello''）</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，每个</font></font></nobr></div>
<div style="position:absolute;top:86917;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符将被写入。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:86964;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.2基本的屏幕驱动程序实现</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:86998;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管我们可以在</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel.c中</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写所有这些代码，</font><font color="#2b57a3"><font style="vertical-align: inherit;">但</font></font><font style="vertical-align: inherit;">其中包含内核的条目</font></font></nobr></div>
<div style="position:absolute;top:87016;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main（）</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，最好将此类功能特定的代码组织到自己的文件中，</font></font></nobr></div>
<div style="position:absolute;top:87034;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以编译并链接到我们的内核代码，效果与</font></font></nobr></div>
<div style="position:absolute;top:87052;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将其全部放入一个文件中。</font><font style="vertical-align: inherit;">让我们创建一个新的驱动程序实现文件</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">screen.c</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:87253;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="70"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第70章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:87397;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6章开发基本设备驱动程序和组件</font></font></nobr></div>
<div style="position:absolute;top:87418;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件系统</font></font></nobr></div>
<div style="position:absolute;top:87418;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">66</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:87452;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动</font><font color="#2b57a3"><font style="vertical-align: inherit;">程序</font></font><font style="vertical-align: inherit;">文件夹</font><font style="vertical-align: inherit;">中的</font><font color="#2b57a3"><font style="vertical-align: inherit;">驱动</font></font><font style="vertical-align: inherit;">程序接口文件</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">screen.h</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">由于我们使用通配符文件</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:87470;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含在我们的makefile中，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">screen.c</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将（与放置在该文件夹中的任何其他C文件一样）</font></font></nobr></div>
<div style="position:absolute;top:87488;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动编译并链接到我们的内核。</font></font></nobr></div>
<div style="position:absolute;top:87506;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，让我们在</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">screen.h中</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义以下常量</font><font style="vertical-align: inherit;">，以使我们的代码更</font></font></nobr></div>
<div style="position:absolute;top:87524;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可读性：</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:87583;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VIDEO_ADDRESS 0xb8000</font></font></font></nobr></div>
<div style="position:absolute;top:87597;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃定义</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAX_ROWS 25</font></font></font></nobr></div>
<div style="position:absolute;top:87612;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃定义</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAX_COLS 80</font></font></font></nobr></div>
<div style="position:absolute;top:87626;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//我们默认的配色方案的属性字节。</font></font></nobr></div>
<div style="position:absolute;top:87640;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃定义</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHITE_ON_BLACK为0x0F</font></font></font></nobr></div>
<div style="position:absolute;top:87668;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//屏幕设备I / O端口</font></font></nobr></div>
<div style="position:absolute;top:87683;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃定义</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REG_SCREEN_CTRL 0x3D4</font></font></font></nobr></div>
<div style="position:absolute;top:87697;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃定义</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REG_SCREEN_DATA 0x3D5</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:87753;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，让我们考虑如何编写一个函数，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出char（...）</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:87771;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在屏幕的特定列和行上播放单个字符。</font><font style="vertical-align: inherit;">我们将使用这个</font></font></nobr></div>
<div style="position:absolute;top:87789;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的司机内部（即私下）行使职能，以便我们的司机在公共场所</font></font></nobr></div>
<div style="position:absolute;top:87807;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口函数（即我们希望使用外部代码的函数）将建立</font></font></nobr></div>
<div style="position:absolute;top:87825;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之上。</font><font style="vertical-align: inherit;">现在，我们知道视频存储只是特定范围的存储广告，</font></font></nobr></div>
<div style="position:absolute;top:87843;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">礼服，其中每个字符单元由两个字节表示，第一个字节为ASCII</font></font></nobr></div>
<div style="position:absolute;top:87861;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符的代码，第二个字节是属性字节，允许我们设置</font></font></nobr></div>
<div style="position:absolute;top:87879;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符单元格的颜色方案。</font><font style="vertical-align: inherit;">图XXX显示了我们如何定义这样一个</font></font></nobr></div>
<div style="position:absolute;top:87897;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数，通过使用我们将定义的其他一些函数：</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get cursor（）</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:87916;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置cursor（）</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取屏幕offset（）</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理scrolling（）</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:87974;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ *在屏幕上的行，行或光标位置打印一个字符* /</font></font></nobr></div>
<div style="position:absolute;top:87988;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_char（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> char</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">col，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> int</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> char </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">attribute_byte）{</font></font></font></nobr></div>
<div style="position:absolute;top:88003;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ *创建一个指向视频内存开始的字节（char）指针* /</font></font></nobr></div>
<div style="position:absolute;top:88017;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsigned char </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* vidmem =（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unsigned char </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*）VIDEO_ADDRESS;</font></font></font></nobr></div>
<div style="position:absolute;top:88045;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ *如果属性字节为零，则采用默认样式。</font><font style="vertical-align: inherit;">* /</font></font></nobr></div>
<div style="position:absolute;top:88059;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（！attribute_byte）{</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:88074;left:205"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">attribute_byte = WHITE_ON_BLACK;</font></font></nobr></div>
<div style="position:absolute;top:88088;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:88116;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ *获取屏幕位置的视频内存偏移量* /</font></font></nobr></div>
<div style="position:absolute;top:88130;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移量；</font></font></font></nobr></div>
<div style="position:absolute;top:88145;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ *如果col和row为非负数，则将它们用于偏移量。</font><font style="vertical-align: inherit;">* /</font></font></nobr></div>
<div style="position:absolute;top:88159;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（col&gt; = 0 &amp;&amp; row&gt; = 0）{</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:88173;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移量= get_screen_offset（col，行）;</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:88187;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ *否则，请使用当前光标位置。</font><font style="vertical-align: inherit;">* /</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:88201;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
<div style="position:absolute;top:88216;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移量= get_cursor（）;</font></font></nobr></div>
<div style="position:absolute;top:88230;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:88258;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//如果看到换行符，请将offset设置为</font></font></nobr></div>
<div style="position:absolute;top:88272;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//当前行，因此它将前进到第一个col</font></font></nobr></div>
<div style="position:absolute;top:88287;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//下一行。</font></font></nobr></div>
<div style="position:absolute;top:88301;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（character =='\ n'）{</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:88515;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="71"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第71章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:88659;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6章开发基本设备驱动程序和组件</font></font></nobr></div>
<div style="position:absolute;top:88680;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件系统</font></font></nobr></div>
<div style="position:absolute;top:88680;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">67</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:88732;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行=偏移量/（2 * MAX_COLS）;</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:88746;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移量= get_screen_offset（79，行）;</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:88761;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//否则，将字符及其属性字节写入</font></font></nobr></div>
<div style="position:absolute;top:88775;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//视频内存在我们计算的偏移量处。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:88789;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
<div style="position:absolute;top:88803;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vidmem [offset] =字符；</font></font></nobr></div>
<div style="position:absolute;top:88817;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vidmem [offset + 1] = attribute_byte;</font></font></nobr></div>
<div style="position:absolute;top:88832;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:88860;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//将偏移量更新为下一个字符单元，即</font></font></nobr></div>
<div style="position:absolute;top:88874;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//当前单元格前两个字节。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:88888;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移量+ = 2;</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:88903;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//进行滚动调整，以便在到达底部时</font></font></nobr></div>
<div style="position:absolute;top:88917;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//屏幕上的。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:88931;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移量= handle_scrolling（偏移量）;</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:88945;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//更新光标在屏幕设备上的位置。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:88959;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set_cursor（offset）;</font></font></nobr></div>
<div style="position:absolute;top:88973;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:89029;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们首先解决这些功能中最简单的一个：</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取屏幕偏移量</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这个功能</font></font></nobr></div>
<div style="position:absolute;top:89047;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会将行和列坐标映射到特定显示字符的内存偏移量</font></font></nobr></div>
<div style="position:absolute;top:89065;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从视频存储器开始的acter单元。</font><font style="vertical-align: inherit;">映射很简单，但是我们必须</font></font></nobr></div>
<div style="position:absolute;top:89083;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请记住，每个单元格包含两个字节。</font><font style="vertical-align: inherit;">例如，如果我想在</font></font></nobr></div>
<div style="position:absolute;top:89101;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示的第3行，第4列，则其字符单元格将位于（十进制）</font></font></nobr></div>
<div style="position:absolute;top:89119;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从起始位置</font><font style="vertical-align: inherit;">偏移</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">488</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（3 * 80（即行宽度）+ 4）* 2 = 488</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></nobr></div>
<div style="position:absolute;top:89137;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视频内存。</font><font style="vertical-align: inherit;">因此，我们的“</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取屏幕偏移”</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能将类似于</font></font></nobr></div>
<div style="position:absolute;top:89155;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图XXX。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:89213;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//这类似于get_cursor，只是现在我们编写</font></font></nobr></div>
<div style="position:absolute;top:89227;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//这些内部设备寄存器的字节。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:89242;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port_byte_out（REG_SCREEN_CTRL，14）;</font></font></nobr></div>
<div style="position:absolute;top:89256;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port_byte_out（REG_SCREEN_DATA，（</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsigned char</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）（偏移&gt;&gt; 8））;</font></font></nobr></div>
<div style="position:absolute;top:89270;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port_byte_out（REG_SCREEN_CTRL，15）;</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:89326;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在让我们看一下游标控制函数，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取cursor（）</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置cursor（）</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:89343;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它将通过一组I / O端口操纵显示控制器的寄存器。</font><font style="vertical-align: inherit;">使用</font></font></nobr></div>
<div style="position:absolute;top:89361;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定的视频设备的I / O端口，用于读取和写入其内部与游标相关的寄存器，</font></font></nobr></div>
<div style="position:absolute;top:89379;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些功能的实现将类似于图XXX。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:89438;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cursor_offset-= 2 * MAX_COLS;</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:89466;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//返回更新后的光标位置。</font></font></nobr></div>
<div style="position:absolute;top:89480;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cursor_offset;</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:89495;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:89523;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_cursor（）{</font></font></font></nobr></div>
<div style="position:absolute;top:89537;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//设备使用其控制寄存器作为索引</font></font></nobr></div>
<div style="position:absolute;top:89551;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//选择其内部寄存器</font></font></nobr></div>
<div style="position:absolute;top:89566;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">// 有兴趣：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:89777;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="72"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第72章</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:89921;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6章开发基本设备驱动程序和组件</font></font></nobr></div>
<div style="position:absolute;top:89942;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件系统</font></font></nobr></div>
<div style="position:absolute;top:89942;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">68</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:89994;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//</font></font></nobr></div>
<div style="position:absolute;top:89994;left:227"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14条：这是游标的偏移量的高字节</font></font></nobr></div>
<div style="position:absolute;top:90008;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//</font></font></nobr></div>
<div style="position:absolute;top:90008;left:227"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第15条：这是光标的偏移量的低字节</font></font></nobr></div>
<div style="position:absolute;top:90023;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//一旦选择了内部寄存器，我们可能会读取或</font></font></nobr></div>
<div style="position:absolute;top:90037;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//在数据寄存器上写一个字节。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:90051;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port_byte_out（REG_SCREEN_CTRL，14）;</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:90065;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移= port_byte_in（REG_SCREEN_DATA）&lt;&lt; 8;</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:90079;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port_byte_out（REG_SCREEN_CTRL，15）;</font></font></nobr></div>
<div style="position:absolute;top:90094;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移量+ = port_byte_in（REG_SCREEN_DATA）;</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:90108;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//由于VGA硬件报告的光标偏移是</font></font></nobr></div>
<div style="position:absolute;top:90122;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//字符数，我们乘以2即可将其转换为</font></font></nobr></div>
<div style="position:absolute;top:90136;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//字符单元格偏移量。</font></font></nobr></div>
<div style="position:absolute;top:90150;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移量* 2；</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:90165;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:90193;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set_cursor（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offset）{</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:90207;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移量== 2;</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:90207;left:296"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//从单元格偏移量转换为char偏移量。</font></font></nobr></div>
<div style="position:absolute;top:90221;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//这类似于get_cursor，只是现在我们编写</font></font></nobr></div>
<div style="position:absolute;top:90235;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//这些内部设备寄存器的字节。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:90292;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所以现在我们有了一个功能，可以让我们在特定位置打印字符</font></font></nobr></div>
<div style="position:absolute;top:90310;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕的位置，并且该功能封装了所有特定的凌乱硬件</font></font></nobr></div>
<div style="position:absolute;top:90328;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">东西。</font><font style="vertical-align: inherit;">通常，我们不想将每个字符打印到屏幕上，而是将整个字符打印到屏幕上。</font></font></nobr></div>
<div style="position:absolute;top:90346;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串，所以让我们创建一个更友好的函数，</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在（...）处打印</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该</font><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">需要一个</font></font></nobr></div>
<div style="position:absolute;top:90364;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指向字符串的第一个字符（即</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的</font><font style="vertical-align: inherit;">指针，</font><font style="vertical-align: inherit;">并输出随后的每个</font><font color="#2b57a3"><font style="vertical-align: inherit;">字符</font></font></font></nobr></div>
<div style="position:absolute;top:90382;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符，从给定的坐标开始，一个接一个。</font><font style="vertical-align: inherit;">如果坐标为</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（-1，-1）</font></font></font></nobr></div>
<div style="position:absolute;top:90400;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递给函数，然后它将从当前光标位置开始打印。</font></font></nobr></div>
<div style="position:absolute;top:90418;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印at（...）</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数将类似于图XXX。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:90477;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_at（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> char </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* message，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">col，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">row）{</font></font></font></nobr></div>
<div style="position:absolute;top:90491;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//如果col和row不为负，则更新光标。</font></font></nobr></div>
<div style="position:absolute;top:90505;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（col&gt; = 0 &amp;&amp; row&gt; = 0）{</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:90520;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set_cursor（get_screen_offset（col，row））;</font></font></nobr></div>
<div style="position:absolute;top:90534;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:90548;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//循环遍历消息的每个字符并打印。</font></font></nobr></div>
<div style="position:absolute;top:90562;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i = 0;</font></font></font></nobr></div>
<div style="position:absolute;top:90576;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（message [i]！= 0）{</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:90591;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_char（消息[i ++]，列，行，WHITE_ON_BLACK）；</font></font></nobr></div>
<div style="position:absolute;top:90605;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:90619;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:90676;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纯粹是为了方便起见，使我们不必</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在（``hello''，</font></font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:90695;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-1，-1）</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们可以定义一个函数</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font><font color="#000000"><font style="vertical-align: inherit;">，该</font></font><font color="#000000"><font style="vertical-align: inherit;">函数</font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅接受一个参数，如图所示</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:90711;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XXX。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:90771;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无效</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> char </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*消息）{</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:90785;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_at（message，-1，-1）;</font></font></nobr></div>
<div style="position:absolute;top:90799;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:91039;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="73"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第73章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:91183;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6章开发基本设备驱动程序和组件</font></font></nobr></div>
<div style="position:absolute;top:91204;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件系统</font></font></nobr></div>
<div style="position:absolute;top:91204;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">69</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:91238;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另一个有用但不太困难的功能是</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clear screen（...）</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它将</font></font></nobr></div>
<div style="position:absolute;top:91256;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过在每个位置写空白字符来整理屏幕。</font><font style="vertical-align: inherit;">数字</font></font></nobr></div>
<div style="position:absolute;top:91274;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XXX显示了我们如何实现这样的功能。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:91332;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clear_screen（）{</font></font></font></nobr></div>
<div style="position:absolute;top:91347;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行= 0;</font></font></font></nobr></div>
<div style="position:absolute;top:91361;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">col = 0;</font></font></font></nobr></div>
<div style="position:absolute;top:91389;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ *循环浏览视频存储器并写入空白字符。</font><font style="vertical-align: inherit;">* /</font></font></nobr></div>
<div style="position:absolute;top:91403;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（row = 0; row &lt;MAX_ROWS; row ++）{</font></font></font></nobr></div>
<div style="position:absolute;top:91418;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（col = 0; col &lt;MAX_COLS; col ++）{</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:91432;left:220"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_char（''，col，row，WHITE_ON_BLACK）;</font></font></nobr></div>
<div style="position:absolute;top:91446;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:91460;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:91489;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//将光标移回左上角。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:91503;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set_cursor（get_screen_offset（0，0））;</font></font></nobr></div>
<div style="position:absolute;top:91517;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:91588;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.3滚动屏幕</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:91622;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您希望屏幕在光标到达底部时自动滚动</font></font></nobr></div>
<div style="position:absolute;top:91640;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在屏幕上，那么您的大脑一定已经退回到更高级的计算机领域。</font></font></nobr></div>
<div style="position:absolute;top:91658;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是可以原谅的，因为屏幕滚动似乎是很自然的事情，因此我们</font></font></nobr></div>
<div style="position:absolute;top:91676;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单地认为是理所当然的；</font><font style="vertical-align: inherit;">但在此级别上，我们可以完全控制</font></font></nobr></div>
<div style="position:absolute;top:91694;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">硬件，因此必须自己实现此功能。</font></font></nobr></div>
<div style="position:absolute;top:91712;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了使屏幕在我们到达底部时看起来可以滚动，我们必须</font></font></nobr></div>
<div style="position:absolute;top:91730;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将每个字符单元格向上移动一行，然后清除最后一行，为</font></font></nobr></div>
<div style="position:absolute;top:91748;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写新行（即原本应该写在该行之外的行）</font></font></nobr></div>
<div style="position:absolute;top:91766;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕的结尾）。</font><font style="vertical-align: inherit;">这意味着第一行将被第二行覆盖，</font></font></nobr></div>
<div style="position:absolute;top:91784;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，第一排将永远丢失，我们不会担心，因为</font></font></nobr></div>
<div style="position:absolute;top:91802;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的目标是允许用户在其计算机上查看最新的活动日志。</font></font></nobr></div>
<div style="position:absolute;top:91820;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现滚动的一种好方法是调用一个函数，我们将其定义为</font></font></nobr></div>
</span></font>
<font size="3" color="#2b57a3" face="Times"><span style="font-size:12px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:91839;left:159"><nobr><font style="vertical-align: inherit;"></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在增加我们的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print char中</font><font color="#000000"><font style="vertical-align: inherit;">的光标位置后立即</font></font><font style="vertical-align: inherit;">处理滚动</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:91855;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的卷</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手柄滚动</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的话，是保证，只要游标的视频</font></font></nobr></div>
<div style="position:absolute;top:91873;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存偏移量增加到屏幕的最后一行之外，并滚动各行</font></font></nobr></div>
<div style="position:absolute;top:91891;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且光标将重新定位在最后一个可见行（即新行）内。</font></font></nobr></div>
<div style="position:absolute;top:91909;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移位一行等同于复制其所有字节-对于80个字节中的每个字节，复制两个字节</font></font></nobr></div>
<div style="position:absolute;top:91927;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一行中的字符单元格---到前一行的地址。</font><font style="vertical-align: inherit;">这是一个完美的操作</font></font></nobr></div>
<div style="position:absolute;top:91945;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将通用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存复制</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能添加到我们的操作系统的机会。</font></font></nobr></div>
<div style="position:absolute;top:91963;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们可能会在操作系统的其他区域中使用此功能，因此我们将其添加到</font></font></nobr></div>
<div style="position:absolute;top:91981;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核/ util.c</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们的</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存复制</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能将获取源地址和</font></font></nobr></div>
<div style="position:absolute;top:91999;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标和要复制的字节数，然后通过循环将每个字节复制为</font></font></nobr></div>
<div style="position:absolute;top:92017;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在图XXX中。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:92075;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ *将字节从一个位置复制到另一位置。</font><font style="vertical-align: inherit;">* /</font></font></nobr></div>
<div style="position:absolute;top:92090;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memory_copy（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> char </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* source，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> char </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* dest，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no_bytes）{</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:92301;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="74"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第74页</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:92445;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6章开发基本设备驱动程序和组件</font></font></nobr></div>
<div style="position:absolute;top:92466;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件系统</font></font></nobr></div>
<div style="position:absolute;top:92466;left:714"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">70</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:92518;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">诠释</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I;</font></font></font></nobr></div>
<div style="position:absolute;top:92532;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（i = 0; i &lt;no_bytes; i ++）{</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:92547;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*（目标+ i）= *（源+ i）;</font></font></nobr></div>
<div style="position:absolute;top:92561;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:92575;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:92632;left:185"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们可以使用</font></font><font color="#2b57a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存复制</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（如图XXX所示）滚动屏幕。</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:92691;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ *前进文本光标，如有必要，滚动视频缓冲区。</font><font style="vertical-align: inherit;">* /</font></font></nobr></div>
<div style="position:absolute;top:92705;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">handle_scrolling（</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> int </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cursor_offset）{</font></font></font></nobr></div>
<div style="position:absolute;top:92734;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//如果光标在屏幕内，请返回原样。</font></font></nobr></div>
<div style="position:absolute;top:92748;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（cursor_offset &lt;MAX_ROWS * MAX_COLS * 2）{</font></font></font></nobr></div>
<div style="position:absolute;top:92762;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cursor_offset;</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:92776;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:92805;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ *将行往后移。</font><font style="vertical-align: inherit;">* /</font></font></nobr></div>
<div style="position:absolute;top:92819;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">诠释</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I;</font></font></font></nobr></div>
<div style="position:absolute;top:92833;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（i = 1; i &lt;MAX_ROWS; i ++）{</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:92847;left:205"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memory_copy（get_screen_offset（0，i）+ VIDEO_ADDRESS，</font></font></nobr></div>
<div style="position:absolute;top:92861;left:296"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_screen_offset（0，i-1）+ VIDEO_ADDRESS，</font></font></nobr></div>
<div style="position:absolute;top:92876;left:296"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAX_COLS * 2</font></font></nobr></div>
<div style="position:absolute;top:92890;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;</font></font></nobr></div>
<div style="position:absolute;top:92904;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:92932;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ *通过将所有字节设置为0来空白最后一行* /</font></font></nobr></div>
<div style="position:absolute;top:92946;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* last_line = get_screen_offset（0，MAX_ROWS-1）+ VIDEO_ADDRESS;</font></font></font></nobr></div>
<div style="position:absolute;top:92961;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（i = 0; i &lt;MAX_COLS * 2; i ++）{</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:92975;left:204"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">last_line [i] = 0;</font></font></nobr></div>
<div style="position:absolute;top:92989;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:93017;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//将偏移量移回第一行，使其现在位于最后一行</font></font></nobr></div>
<div style="position:absolute;top:93032;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//行，而不是离开屏幕边缘。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:93046;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cursor_offset-= 2 * MAX_COLS;</font></font></nobr></div>
</span></font>
<font size="2" color="#2b57a3" face="Times"><span style="font-size:9px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:93074;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//返回更新后的光标位置。</font></font></nobr></div>
<div style="position:absolute;top:93088;left:189"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cursor_offset;</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:93103;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:93179;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3处理中断</font></font></nobr></div>
<div style="position:absolute;top:93230;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4键盘驱动</font></font></nobr></div>
<div style="position:absolute;top:93280;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5硬盘驱动器</font></font></nobr></div>
<div style="position:absolute;top:93331;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.6文件系统</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:93563;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="75"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第75章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:93874;left:389"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">章</font></font><font style="font-size:35px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></font></nobr></div>
</span></font>
<font size="5" color="#2b57a3" face="Times"><span style="font-size:35px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:93951;left:240"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实施过程</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:94066;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.1单次处理</font></font></nobr></div>
<div style="position:absolute;top:94117;left:159"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.2多重处理</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:94672;left:436"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">71</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:94825;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="76"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第76章一更</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:95136;left:389"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">章</font></font><font style="font-size:35px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></font></nobr></div>
</span></font>
<font size="5" color="#2b57a3" face="Times"><span style="font-size:35px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:95211;left:365"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概括</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:95934;left:436"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">72</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:96087;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="77"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第77页</font></font></b></a></font></td></tr></tbody></table></div><font size="5" color="#2b57a3" face="Times"><span style="font-size:35px;font-family:Times;color:#2b57a3">
<div style="position:absolute;top:96449;left:339"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考书目</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:97196;left:436"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">73</font></font></nobr></div>
</span></font>


<script>_addload(function(){_setupIW('com');_csi('en','zh-CN','os-dev.pdf');});</script>
            <script>
              function gtElInit() {
                var lib = new google.translate.TranslateService();
                lib.setCheckVisibility(false);
                lib.translatePage('en', 'zh-CN', function (progress, done, error) {
                  if (progress == 100 || done || error) {
                    document.getElementById("gt-dt-spinner").style.display = "none";
                  }
                });
              }
            </script>
            <script src="./从头开始编写一个简单的操作系统_files/f.txt">
            </script><div id="goog-gt-tt" class="goog-tooltip skiptranslate" dir="ltr" style="visibility: hidden; left: 400px; top: 8492px; display: none;"><div style="padding: 8px;"><div><div class="logo"><img src="./从头开始编写一个简单的操作系统_files/translate_24dp.png" width="20" height="20" alt="Google 翻译"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">原文</h1></div><div class="middle" style="padding: 8px;"><div class="original-text">read and write logical files to a disk), but we have none of that.</div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none; opacity: 0;"></div></div>
          <div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div><span><div class="gmnoprint" style="display: none; z-index: 2147483647;"><img src="./从头开始编写一个简单的操作系统_files/iws_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./从头开始编写一个简单的操作系统_files/iws_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./从头开始编写一个简单的操作系统_files/iws_w.png" style="position: absolute; left: 0px; top: 0px; width: 8px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./从头开始编写一个简单的操作系统_files/iws_e.png" style="position: absolute; left: 0px; top: 0px; width: 8px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./从头开始编写一个简单的操作系统_files/iws_s.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./从头开始编写一个简单的操作系统_files/iws_s.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./从头开始编写一个简单的操作系统_files/iws_c.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><div class="SPRITE_iws_nw" style="overflow: hidden;"></div><div class="SPRITE_iws_ne" style="overflow: hidden;"></div><div class="SPRITE_iws_sw" style="overflow: hidden;"></div><div class="SPRITE_iws_se" style="overflow: hidden;"></div><div class="SPRITE_iws_tap" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_l" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_u" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_ul" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_rd" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_ld" style="overflow: hidden;"></div><div class="SPRITE_iws_tab_dl" style="overflow: hidden; display: none;"></div><div class="SPRITE_iws_tab_dr" style="overflow: hidden; display: none;"></div><div class="SPRITE_iws_tab_l" style="overflow: hidden; display: none;"></div><div class="SPRITE_iws_tab_r" style="overflow: hidden; display: none;"></div></div></span><div id="google-infowindow" class="notranslate"><div class="gmnoprint" style="display: none; z-index: 2147483647;"><img src="./从头开始编写一个简单的操作系统_files/iw_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./从头开始编写一个简单的操作系统_files/iw_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./从头开始编写一个简单的操作系统_files/iw_w.png" style="position: absolute; left: 0px; top: 0px; width: 6px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./从头开始编写一个简单的操作系统_files/iw_e.png" style="position: absolute; left: 0px; top: 0px; width: 6px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./从头开始编写一个简单的操作系统_files/iw_s0.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./从头开始编写一个简单的操作系统_files/iw_s0.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./从头开始编写一个简单的操作系统_files/iw_c.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><div class="SPRITE_iw_nw" style="overflow: hidden;"></div><div class="SPRITE_iw_ne" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_l" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_u" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_ul" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_rd" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_ld" style="overflow: hidden;"></div><div class="SPRITE_iw_sw0" style="overflow: hidden;"></div><div class="SPRITE_iw_se0" style="overflow: hidden;"></div><div class="SPRITE_close" style="overflow: hidden; z-index: 10000; cursor: pointer; visibility: visible;"></div><div class="SPRITE_maximize" style="overflow: hidden; z-index: 10000; visibility: hidden; cursor: pointer; display: none;"></div><div class="SPRITE_restore" style="overflow: hidden; z-index: 10001; visibility: hidden; cursor: pointer; display: none;"></div></div></div><div style="display: none;"><iframe sandbox="" id="google-feedback-frame" name="FEEDBACK_TARGET_IFRAME_NAME" src="./从头开始编写一个简单的操作系统_files/saved_resource.html"></iframe></div></body></html>